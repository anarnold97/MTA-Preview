<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" class="chrometwo"><head><title>Installing and using the Migration Toolkit for Virtualization</title><link rel="stylesheet" type="text/css" href="Common_Content/css/default.css"/><meta name="generator" content="publican v4.3.2"/><meta name="description" content="The Migration Toolkit for Virtualization (MTV) enables you to migrate virtual machines from VMware vSphere, Red Hat Virtualization, or OpenStack to OpenShift Virtualization running on Red Hat OpenShift."/><link rel="next" href="#making-open-source-more-inclusive" title="Making open source more inclusive"/><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><script type="text/javascript" src="Common_Content/scripts/jquery-1.7.1.min.js"> </script><script type="text/javascript" src="Common_Content/scripts/utils.js"> </script><script type="text/javascript" src="Common_Content/scripts/highlight.js/highlight.pack.js"> </script></head><body><div id="chrometwo"><div id="main"><div xml:lang="en-US" class="book" id="idm45442639406800"><div class="titlepage"><div><div class="producttitle"><span class="productname">Migration Toolkit for Virtualization</span> <span class="productnumber">2.7</span></div><div><h1 class="title">Installing and using the Migration Toolkit for Virtualization</h1></div><div><h2 class="subtitle">Migrating from VMware vSphere or Red Hat Virtualization to Red Hat OpenShift Virtualization</h2></div><div><div xml:lang="en-US" class="authorgroup"><div class="author"><h3 class="author"><span class="firstname">Red Hat Modernization and Migration</span> <span class="surname">Documentation Team</span></h3><code class="email"><a class="email" href="mailto:ccs-mms-docs@redhat.com">ccs-mms-docs@redhat.com</a></code></div></div></div><div><a href="#idm45442632070384">Legal Notice</a></div><div><div class="abstract"><p class="title"><strong>Abstract</strong></p><div class="para">
				The Migration Toolkit for Virtualization (MTV) enables you to migrate virtual machines from VMware vSphere, Red Hat Virtualization, or OpenStack to OpenShift Virtualization running on Red Hat OpenShift.
			</div></div></div></div><hr/></div><div class="toc"><ul class="toc"><li><span class="preface"><a href="#making-open-source-more-inclusive">Making open source more inclusive</a></span></li><li><span class="chapter"><a href="#about-mtv_mtv">1. About the Migration Toolkit for Virtualization</a></span><ul><li><span class="section"><a href="#about-cold-warm-migration_mtv">1.1. About cold and warm migration</a></span><ul><li><span class="section"><a href="#cold-migration_mtv">1.1.1. Cold migration</a></span></li><li><span class="section"><a href="#warm-migration_mtv">1.1.2. Warm migration</a></span></li></ul></li></ul></li><li><span class="chapter"><a href="#prerequisites_mtv">2. Prerequisites</a></span><ul><li><span class="section"><a href="#software-requirements_mtv">2.1. Software requirements</a></span></li><li><span class="section"><a href="#about-storage_mtv">2.2. Storage support and default modes</a></span></li><li><span class="section"><a href="#network-prerequisites_mtv">2.3. Network prerequisites</a></span><ul><li><span class="section"><a href="#ports_mtv">2.3.1. Ports</a></span></li></ul></li><li><span class="section"><a href="#source-vm-prerequisites_mtv">2.4. Source virtual machine prerequisites</a></span></li><li><span class="section"><a href="#rhv-prerequisites_mtv">2.5. Red Hat Virtualization prerequisites</a></span></li><li><span class="section"><a href="#openstack-prerequisites_mtv">2.6. OpenStack prerequisites</a></span><ul><li><span class="section"><a href="#additional-authentication-for-osp_mtv">2.6.1. Additional authentication methods for migrations with OpenStack source providers</a></span></li></ul></li><li><span class="section"><a href="#vmware-prerequisites_mtv">2.7. VMware prerequisites</a></span><ul><li><span class="section"><a href="#creating-vddk-image_mtv">2.7.1. Creating a VDDK image</a></span></li><li><span class="section"><a href="#increasing-nfc-memory-vmware-host_mtv">2.7.2. Increasing the NFC service memory of an ESXi host</a></span></li></ul></li><li><span class="section"><a href="#ova-prerequisites_mtv">2.8. Open Virtual Appliance (OVA) prerequisites</a></span></li><li><span class="section"><a href="#compatibility-guidelines_mtv">2.9. Software compatibility guidelines</a></span><ul><li><span class="section"><a href="#openshift-operator-life-cycles">2.9.1. OpenShift Operator Life Cycles</a></span></li></ul></li></ul></li><li><span class="chapter"><a href="#installing-the-operator_mtv">3. Installing and configuring the MTV Operator</a></span><ul><li><span class="section"><a href="#installing-mtv-operator_web">3.1. Installing the MTV Operator by using the Red Hat OpenShift web console</a></span></li><li><span class="section"><a href="#installing-mtv-operator_cli">3.2. Installing the MTV Operator from the command line interface</a></span></li><li><span class="section"><a href="#configuring-mtv-operator_mtv">3.3. Configuring the MTV Operator</a></span></li></ul></li><li><span class="chapter"><a href="#migrating-vms-web-console_mtv">4. Migrating virtual machines by using the Red Hat OpenShift web console</a></span><ul><li><span class="section"><a href="#mtv-ui_mtv">4.1. The MTV user interface</a></span></li><li><span class="section"><a href="#mtv-overview-page_mtv">4.2. The MTV Overview page</a></span><ul><li><span class="section"><a href="#overview-tab_mtv">4.2.1. Overview tab</a></span></li><li><span class="section"><a href="#yaml-tab_mtv">4.2.2. YAML tab</a></span></li><li><span class="section"><a href="#metrics-tab_mtv">4.2.3. Metrics tab</a></span></li></ul></li><li><span class="section"><a href="#mtv-settings_mtv">4.3. Configuring MTV settings</a></span></li><li><span class="section"><a href="#adding-providers">4.4. Adding providers</a></span><ul><li><span class="section"><a href="#adding-source-providers">4.4.1. Adding source providers</a></span></li><li><span class="section"><a href="#adding-destination-providers">4.4.2. Adding destination providers</a></span></li></ul></li><li><span class="section"><a href="#creating-migration-plans-ui">4.5. Creating migration plans</a></span><ul><li><span class="section"><a href="#creating-migration-plan-2-6-3_provider">4.5.1. Creating a migration plan starting with a source provider</a></span></li><li><span class="section"><a href="#creating-migration-plan-2-6-3_vms">4.5.2. Creating a migration plan starting with specific VMs</a></span></li></ul></li><li><span class="section"><a href="#running-migration-plan_mtv">4.6. Running a migration plan</a></span></li><li><span class="section"><a href="#migration-plan-options-ui_mtv">4.7. Migration plan options</a></span></li><li><span class="section"><a href="#canceling-migration-ui_mtv">4.8. Canceling a migration</a></span></li></ul></li><li><span class="chapter"><a href="#migrating-virtual-machines-from-the-command-line_mtv">5. Migrating virtual machines from the command line</a></span><ul><li><span class="section"><a href="#non-admin-permissions_cli">5.1. Permissions needed by non-administrators to work with migration plan components</a></span></li><li><span class="section"><a href="#retrieving-vmware-moref_mtv">5.2. Retrieving a VMware vSphere moRef</a></span></li><li><span class="section"><a href="#migrating-virtual-machines_mtv">5.3. Migrating virtual machines</a></span><ul><li><span class="section"><a href="#new-migrating-virtual-machines-cli_vmware">5.3.1. Migrating from a VMware vSphere source provider</a></span></li><li><span class="section"><a href="#new-migrating-virtual-machines-cli_rhv">5.3.2. Migrating from a Red Hat Virtualization source provider</a></span></li><li><span class="section"><a href="#new-migrating-virtual-machines-cli_ostack">5.3.3. Migrating from an OpenStack source provider</a></span></li><li><span class="section"><a href="#new-migrating-virtual-machines-cli_ova">5.3.4. Migrating from an Open Virtual Appliance (OVA) source provider</a></span></li><li><span class="section"><a href="#new-migrating-virtual-machines-cli_cnv">5.3.5. Migrating from a Red Hat OpenShift Virtualization source provider</a></span></li></ul></li><li><span class="section"><a href="#canceling-migration-cli_mtv">5.4. Canceling a migration</a></span></li></ul></li><li><span class="chapter"><a href="#advanced-migration-options_mtv">6. Advanced migration options</a></span><ul><li><span class="section"><a href="#changing-precopy-intervals_mtv">6.1. Changing precopy intervals for warm migration</a></span></li><li><span class="section"><a href="#creating-custom-rules-for-validation-service">6.2. Creating custom rules for the Validation service</a></span><ul><li><span class="section"><a href="#about-rego-files_mtv">6.2.1. About Rego files</a></span></li><li><span class="section"><a href="#accessing-default-validation-rules_mtv">6.2.2. Checking the default validation rules</a></span></li><li><span class="section"><a href="#creating-validation-rule_mtv">6.2.3. Creating a validation rule</a></span></li><li><span class="section"><a href="#updating-inventory-rules-version_mtv">6.2.4. Updating the inventory rules version</a></span></li></ul></li><li><span class="section"><a href="#retrieving-validation-service-json_mtv">6.3. Retrieving the Inventory service JSON</a></span></li><li><span class="section"><a href="#adding-hooks-migration-plan-using-api">6.4. Adding hooks to a migration plan</a></span><ul><li><span class="section"><a href="#about-api-hooks-in-migration-plans_mtv">6.4.1. API-based hooks for MTV migration plans</a></span></li><li><span class="section"><a href="#adding-hook-crs-migration-plans-api_mtv">6.4.2. Adding Hook CRs to a VM migration by using the MTV API</a></span></li></ul></li></ul></li><li><span class="chapter"><a href="#upgrading-mtv-ui_mtv">7. Upgrading the Migration Toolkit for Virtualization</a></span></li><li><span class="chapter"><a href="#uninstalling-mtv_mtv">8. Uninstalling the Migration Toolkit for Virtualization</a></span><ul><li><span class="section"><a href="#uninstalling-mtv-ui_mtv">8.1. Uninstalling MTV by using the Red Hat OpenShift web console</a></span></li><li><span class="section"><a href="#uninstalling-mtv-cli_mtv">8.2. Uninstalling MTV from the command line interface</a></span></li></ul></li><li><span class="chapter"><a href="#troubleshooting_mtv">9. Troubleshooting</a></span><ul><li><span class="section"><a href="#error-messages_mtv">9.1. Error messages</a></span></li><li><span class="section"><a href="#using-must-gather_mtv">9.2. Using the must-gather tool</a></span></li><li><span class="section"><a href="#architecture_mtv">9.3. Architecture</a></span><ul><li><span class="section"><a href="#mtv-resources-and-services_mtv">9.3.1. MTV custom resources and services</a></span></li><li><span class="section"><a href="#mtv-workflow_mtv">9.3.2. High-level migration workflow</a></span></li><li><span class="section"><a href="#virt-migration-workflow_mtv">9.3.3. Detailed migration workflow</a></span></li></ul></li><li><span class="section"><a href="#logs-and-crs_mtv">9.4. Logs and custom resources</a></span><ul><li><span class="section"><a href="#collected-logs-cr-info_mtv">9.4.1. Collected logs and custom resource information</a></span></li><li><span class="section"><a href="#accessing-logs-ui_mtv">9.4.2. Downloading logs and custom resource information from the web console</a></span></li><li><span class="section"><a href="#accessing-logs-cli_mtv">9.4.3. Accessing logs and custom resource information from the command line interface</a></span></li></ul></li></ul></li></ul></div><section class="preface" id="making-open-source-more-inclusive"><div class="titlepage"><div><div><h1 class="title">Making open source more inclusive</h1></div></div></div><p>
			Red Hat is committed to replacing problematic language in our code, documentation, and web properties. We are beginning with these four terms: master, slave, blacklist, and whitelist. Because of the enormity of this endeavor, these changes will be implemented gradually over several upcoming releases. For more details, see <a class="link" href="https://www.redhat.com/en/blog/making-open-source-more-inclusive-eradicating-problematic-language">our CTO Chris Wright’s message</a>.
		</p></section><section class="chapter" id="about-mtv_mtv"><div class="titlepage"><div><div><h1 class="title">Chapter 1. About the Migration Toolkit for Virtualization</h1></div></div></div><p>
			You can use the Migration Toolkit for Virtualization (MTV) to migrate virtual machines from the following source providers to OpenShift Virtualization destination providers:
		</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
					VMware vSphere
				</li><li class="listitem">
					Red Hat Virtualization (RHV)
				</li><li class="listitem">
					OpenStack
				</li><li class="listitem">
					Open Virtual Appliances (OVAs) that were created by VMware vSphere
				</li><li class="listitem">
					Remote OpenShift Virtualization clusters
				</li></ul></div><div class="itemizedlist"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
					<a class="link" href="https://access.redhat.com/articles/6242511">Performance recommendations for migrating from VMware vSphere to OpenShift Virtualization</a>.
				</li><li class="listitem">
					<a class="link" href="https://access.redhat.com/articles/6380311">Performance recommendations for migrating from Red Hat Virtualization to OpenShift Virtualization</a>.
				</li></ul></div><section class="section" id="about-cold-warm-migration_mtv"><div class="titlepage"><div><div><h2 class="title">1.1. About cold and warm migration</h2></div></div></div><p>
				MTV supports cold migration from:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						VMware vSphere
					</li><li class="listitem">
						Red Hat Virtualization (RHV)
					</li><li class="listitem">
						OpenStack
					</li><li class="listitem">
						Remote OpenShift Virtualization clusters
					</li></ul></div><p>
				MTV supports warm migration from VMware vSphere and from RHV.
			</p><section class="section" id="cold-migration_mtv"><div class="titlepage"><div><div><h3 class="title">1.1.1. Cold migration</h3></div></div></div><p>
					Cold migration is the default migration type. The source virtual machines are shut down while the data is copied.
				</p></section><section class="section" id="warm-migration_mtv"><div class="titlepage"><div><div><h3 class="title">1.1.2. Warm migration</h3></div></div></div><p>
					Most of the data is copied during the <span class="emphasis"><em>precopy</em></span> stage while the source virtual machines (VMs) are running.
				</p><p>
					Then the VMs are shut down and the remaining data is copied during the <span class="emphasis"><em>cutover</em></span> stage.
				</p><div class="formalpara"><p class="title"><strong>Precopy stage</strong></p><p>
						The VMs are not shut down during the precopy stage.
					</p></div><p>
					The VM disks are copied incrementally using <a class="link" href="https://kb.vmware.com/s/article/1020128">changed block tracking (CBT)</a> snapshots. The snapshots are created at one-hour intervals by default. You can change the snapshot interval by updating the <code class="literal">forklift-controller</code> deployment.
				</p><div class="admonition important"><div class="admonition_header">Important</div><div><p>
						You must enable CBT for each source VM and each VM disk.
					</p><p>
						A VM can support up to 28 CBT snapshots. If the source VM has too many CBT snapshots and the <code class="literal">Migration Controller</code> service is not able to create a new snapshot, warm migration might fail. The <code class="literal">Migration Controller</code> service deletes each snapshot when the snapshot is no longer required.
					</p></div></div><p>
					The precopy stage runs until the cutover stage is started manually or is scheduled to start.
				</p><div class="formalpara"><p class="title"><strong>Cutover stage</strong></p><p>
						The VMs are shut down during the cutover stage and the remaining data is migrated. Data stored in RAM is not migrated.
					</p></div><p>
					You can start the cutover stage manually by using the MTV console or you can schedule a cutover time in the <code class="literal">Migration</code> manifest.
				</p></section></section></section><section class="chapter" id="prerequisites_mtv"><div class="titlepage"><div><div><h1 class="title">Chapter 2. Prerequisites</h1></div></div></div><p>
			Review the following prerequisites to ensure that your environment is prepared for migration.
		</p><section class="section" id="software-requirements_mtv"><div class="titlepage"><div><div><h2 class="title">2.1. Software requirements</h2></div></div></div><p>
				You must install <a class="link" href="#compatibility-guidelines_mtv" title="2.9. Software compatibility guidelines">compatible versions</a> of Red Hat OpenShift and OpenShift Virtualization.
			</p></section><section class="section" id="about-storage_mtv"><div class="titlepage"><div><div><h2 class="title">2.2. Storage support and default modes</h2></div></div></div><p>
				MTV uses the following default volume and access modes for supported storage.
			</p><div class="table" id="idm45442640777568"><p class="title"><strong>Table 2.1. Default volume and access modes</strong></p><div class="table-contents"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 33%; " class="col_1"/><col style="width: 33%; " class="col_2"/><col style="width: 33%; " class="col_3"/></colgroup><thead><tr><th align="left" valign="top" id="idm45442640473856" scope="col">Provisioner</th><th align="left" valign="top" id="idm45442640472768" scope="col">Volume mode</th><th align="left" valign="top" id="idm45442640471680" scope="col">Access mode</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm45442640473856">
							<p>
								kubernetes.io/aws-ebs
							</p>
							</td><td align="left" valign="top" headers="idm45442640472768">
							<p>
								Block
							</p>
							</td><td align="left" valign="top" headers="idm45442640471680">
							<p>
								ReadWriteOnce
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm45442640473856">
							<p>
								kubernetes.io/azure-disk
							</p>
							</td><td align="left" valign="top" headers="idm45442640472768">
							<p>
								Block
							</p>
							</td><td align="left" valign="top" headers="idm45442640471680">
							<p>
								ReadWriteOnce
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm45442640473856">
							<p>
								kubernetes.io/azure-file
							</p>
							</td><td align="left" valign="top" headers="idm45442640472768">
							<p>
								Filesystem
							</p>
							</td><td align="left" valign="top" headers="idm45442640471680">
							<p>
								ReadWriteMany
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm45442640473856">
							<p>
								kubernetes.io/cinder
							</p>
							</td><td align="left" valign="top" headers="idm45442640472768">
							<p>
								Block
							</p>
							</td><td align="left" valign="top" headers="idm45442640471680">
							<p>
								ReadWriteOnce
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm45442640473856">
							<p>
								kubernetes.io/gce-pd
							</p>
							</td><td align="left" valign="top" headers="idm45442640472768">
							<p>
								Block
							</p>
							</td><td align="left" valign="top" headers="idm45442640471680">
							<p>
								ReadWriteOnce
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm45442640473856">
							<p>
								kubernetes.io/hostpath-provisioner
							</p>
							</td><td align="left" valign="top" headers="idm45442640472768">
							<p>
								Filesystem
							</p>
							</td><td align="left" valign="top" headers="idm45442640471680">
							<p>
								ReadWriteOnce
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm45442640473856">
							<p>
								manila.csi.openstack.org
							</p>
							</td><td align="left" valign="top" headers="idm45442640472768">
							<p>
								Filesystem
							</p>
							</td><td align="left" valign="top" headers="idm45442640471680">
							<p>
								ReadWriteMany
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm45442640473856">
							<p>
								openshift-storage.cephfs.csi.ceph.com
							</p>
							</td><td align="left" valign="top" headers="idm45442640472768">
							<p>
								Filesystem
							</p>
							</td><td align="left" valign="top" headers="idm45442640471680">
							<p>
								ReadWriteMany
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm45442640473856">
							<p>
								openshift-storage.rbd.csi.ceph.com
							</p>
							</td><td align="left" valign="top" headers="idm45442640472768">
							<p>
								Block
							</p>
							</td><td align="left" valign="top" headers="idm45442640471680">
							<p>
								ReadWriteOnce
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm45442640473856">
							<p>
								kubernetes.io/rbd
							</p>
							</td><td align="left" valign="top" headers="idm45442640472768">
							<p>
								Block
							</p>
							</td><td align="left" valign="top" headers="idm45442640471680">
							<p>
								ReadWriteOnce
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm45442640473856">
							<p>
								kubernetes.io/vsphere-volume
							</p>
							</td><td align="left" valign="top" headers="idm45442640472768">
							<p>
								Block
							</p>
							</td><td align="left" valign="top" headers="idm45442640471680">
							<p>
								ReadWriteOnce
							</p>
							</td></tr></tbody></table></div></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					If the OpenShift Virtualization storage does not support <a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.14/html/storage/dynamic-provisioning">dynamic provisioning</a>, you must apply the following settings:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
							<code class="literal">Filesystem</code> volume mode
						</p><p class="simpara">
							<code class="literal">Filesystem</code> volume mode is slower than <code class="literal">Block</code> volume mode.
						</p></li><li class="listitem"><p class="simpara">
							<code class="literal">ReadWriteOnce</code> access mode
						</p><p class="simpara">
							<code class="literal">ReadWriteOnce</code> access mode does not support live virtual machine migration.
						</p></li></ul></div><p>
					See <a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.14/html/virtualization/virtual-machines#virt-customizing-storage-profile_virt-creating-data-volumes">Enabling a statically-provisioned storage class</a> for details on editing the storage profile.
				</p></div></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					If your migration uses block storage and persistent volumes created with an EXT4 file system, increase the file system overhead in CDI to be more than 10%. The default overhead that is assumed by CDI does not completely include the reserved place for the root partition. If you do not increase the file system overhead in CDI by this amount, your migration might fail.
				</p></div></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					When migrating from OpenStack or running a cold-migration from RHV to the OCP cluster that MTV is deployed on, the migration allocates persistent volumes without CDI. In these cases, you might need to adjust the file system overhead.
				</p><p>
					If the configured file system overhead, which has a default value of 10%, is too low, the disk transfer will fail due to lack of space. In such a case, you would want to increase the file system overhead.
				</p><p>
					In some cases, however, you might want to decrease the file system overhead to reduce storage consumption.
				</p><p>
					You can change the file system overhead by changing the value of the <code class="literal">controller_filesystem_overhead</code> in the <code class="literal">spec</code> portion of the <code class="literal">forklift-controller</code> CR, as described in <a class="link" href="#configuring-mtv-operator_mtv" title="3.3. Configuring the MTV Operator">Configuring the MTV Operator</a>.
				</p></div></div></section><section class="section" id="network-prerequisites_mtv"><div class="titlepage"><div><div><h2 class="title">2.3. Network prerequisites</h2></div></div></div><p>
				The following prerequisites apply to all migrations:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						IP addresses, VLANs, and other network configuration settings must not be changed before or during migration. The MAC addresses of the virtual machines are preserved during migration.
					</li><li class="listitem">
						The network connections between the source environment, the OpenShift Virtualization cluster, and the replication repository must be reliable and uninterrupted.
					</li><li class="listitem">
						If you are mapping more than one source and destination network, you must create a <a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.14/html/virtualization/virtual-machines#virt-creating-network-attachment-definition">network attachment definition</a> for each additional destination network.
					</li></ul></div><section class="section" id="ports_mtv"><div class="titlepage"><div><div><h3 class="title">2.3.1. Ports</h3></div></div></div><p>
					The firewalls must enable traffic over the following ports:
				</p><div class="table" id="idm45442638388448"><p class="title"><strong>Table 2.2. Network ports required for migrating from VMware vSphere</strong></p><div class="table-contents"><table class="gt-4-cols lt-7-rows"><colgroup><col style="width: 17%; " class="col_1"/><col style="width: 17%; " class="col_2"/><col style="width: 17%; " class="col_3"/><col style="width: 17%; " class="col_4"/><col style="width: 33%; " class="col_5"/></colgroup><thead><tr><th align="left" valign="top" id="idm45442639269504" scope="col">Port</th><th align="left" valign="top" id="idm45442639268416" scope="col">Protocol</th><th align="left" valign="top" id="idm45442638381376" scope="col">Source</th><th align="left" valign="top" id="idm45442638380288" scope="col">Destination</th><th align="left" valign="top" id="idm45442638379200" scope="col">Purpose</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm45442639269504">
								<p>
									443
								</p>
								</td><td align="left" valign="top" headers="idm45442639268416">
								<p>
									TCP
								</p>
								</td><td align="left" valign="top" headers="idm45442638381376">
								<p>
									OpenShift nodes
								</p>
								</td><td align="left" valign="top" headers="idm45442638380288">
								<p>
									VMware vCenter
								</p>
								</td><td align="left" valign="top" headers="idm45442638379200">
								<p>
									VMware provider inventory
								</p>
								<p>
									Disk transfer authentication
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm45442639269504">
								<p>
									443
								</p>
								</td><td align="left" valign="top" headers="idm45442639268416">
								<p>
									TCP
								</p>
								</td><td align="left" valign="top" headers="idm45442638381376">
								<p>
									OpenShift nodes
								</p>
								</td><td align="left" valign="top" headers="idm45442638380288">
								<p>
									VMware ESXi hosts
								</p>
								</td><td align="left" valign="top" headers="idm45442638379200">
								<p>
									Disk transfer authentication
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm45442639269504">
								<p>
									902
								</p>
								</td><td align="left" valign="top" headers="idm45442639268416">
								<p>
									TCP
								</p>
								</td><td align="left" valign="top" headers="idm45442638381376">
								<p>
									OpenShift nodes
								</p>
								</td><td align="left" valign="top" headers="idm45442638380288">
								<p>
									VMware ESXi hosts
								</p>
								</td><td align="left" valign="top" headers="idm45442638379200">
								<p>
									Disk transfer data copy
								</p>
								</td></tr></tbody></table></div></div><div class="table" id="idm45442640298464"><p class="title"><strong>Table 2.3. Network ports required for migrating from Red Hat Virtualization</strong></p><div class="table-contents"><table class="gt-4-cols lt-7-rows"><colgroup><col style="width: 17%; " class="col_1"/><col style="width: 17%; " class="col_2"/><col style="width: 17%; " class="col_3"/><col style="width: 17%; " class="col_4"/><col style="width: 33%; " class="col_5"/></colgroup><thead><tr><th align="left" valign="top" id="idm45442638896160" scope="col">Port</th><th align="left" valign="top" id="idm45442638895072" scope="col">Protocol</th><th align="left" valign="top" id="idm45442638893984" scope="col">Source</th><th align="left" valign="top" id="idm45442638652144" scope="col">Destination</th><th align="left" valign="top" id="idm45442638651168" scope="col">Purpose</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm45442638896160">
								<p>
									443
								</p>
								</td><td align="left" valign="top" headers="idm45442638895072">
								<p>
									TCP
								</p>
								</td><td align="left" valign="top" headers="idm45442638893984">
								<p>
									OpenShift nodes
								</p>
								</td><td align="left" valign="top" headers="idm45442638652144">
								<p>
									RHV Engine
								</p>
								</td><td align="left" valign="top" headers="idm45442638651168">
								<p>
									RHV provider inventory
								</p>
								<p>
									Disk transfer authentication
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm45442638896160">
								<p>
									443
								</p>
								</td><td align="left" valign="top" headers="idm45442638895072">
								<p>
									TCP
								</p>
								</td><td align="left" valign="top" headers="idm45442638893984">
								<p>
									OpenShift nodes
								</p>
								</td><td align="left" valign="top" headers="idm45442638652144">
								<p>
									RHV hosts
								</p>
								</td><td align="left" valign="top" headers="idm45442638651168">
								<p>
									Disk transfer authentication
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm45442638896160">
								<p>
									54322
								</p>
								</td><td align="left" valign="top" headers="idm45442638895072">
								<p>
									TCP
								</p>
								</td><td align="left" valign="top" headers="idm45442638893984">
								<p>
									OpenShift nodes
								</p>
								</td><td align="left" valign="top" headers="idm45442638652144">
								<p>
									RHV hosts
								</p>
								</td><td align="left" valign="top" headers="idm45442638651168">
								<p>
									Disk transfer data copy
								</p>
								</td></tr></tbody></table></div></div></section></section><section class="section" id="source-vm-prerequisites_mtv"><div class="titlepage"><div><div><h2 class="title">2.4. Source virtual machine prerequisites</h2></div></div></div><p>
				The following prerequisites apply to all migrations:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						ISO/CDROM disks must be unmounted.
					</li><li class="listitem">
						Each NIC must contain one IPv4 and/or one IPv6 address.
					</li><li class="listitem">
						The VM operating system must be certified and supported for use as a <a class="link" href="https://access.redhat.com/articles/973163#ocpvirt">guest operating system with OpenShift Virtualization</a>.
					</li><li class="listitem">
						VM names must contain only lowercase letters (<code class="literal">a-z</code>), numbers (<code class="literal">0-9</code>), or hyphens (<code class="literal">-</code>), up to a maximum of 253 characters. The first and last characters must be alphanumeric. The name must not contain uppercase letters, spaces, periods (<code class="literal">.</code>), or special characters.
					</li><li class="listitem"><p class="simpara">
						VM names must not duplicate the name of a VM in the OpenShift Virtualization environment.
					</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
							Migration Toolkit for Virtualization automatically assigns a new name to a VM that does not comply with the rules.
						</p><p>
							Migration Toolkit for Virtualization makes the following changes when it automatically generates a new VM name:
						</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
									Excluded characters are removed.
								</li><li class="listitem">
									Uppercase letters are switched to lowercase letters.
								</li><li class="listitem">
									Any underscore (<code class="literal">_</code>) is changed to a dash (<code class="literal">-</code>).
								</li></ul></div><p>
							This feature allows a migration to proceed smoothly even if someone entered a VM name that does not follow the rules.
						</p></div></div></li></ul></div></section><section class="section" id="rhv-prerequisites_mtv"><div class="titlepage"><div><div><h2 class="title">2.5. Red Hat Virtualization prerequisites</h2></div></div></div><p>
				The following prerequisites apply to Red Hat Virtualization migrations:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						To create a source provider, you must have at least the <code class="literal">UserRole</code> and <code class="literal">ReadOnlyAdmin</code> roles assigned to you. These are the minimum required permissions, however, any other administrator or superuser permissions will also work.
					</li></ul></div><div class="admonition important"><div class="admonition_header">Important</div><div><p>
					You must keep the <code class="literal">UserRole</code> and <code class="literal">ReadOnlyAdmin</code> roles until the virtual machines of the source provider have been migrated. Otherwise, the migration will fail.
				</p></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						To migrate virtual machines:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem"><p class="simpara">
								You must have one of the following:
							</p><div class="itemizedlist"><ul class="itemizedlist" type="square"><li class="listitem">
										RHV admin permissions. These permissions allow you to migrate any virtual machine in the system.
									</li><li class="listitem">
										<code class="literal">DiskCreator</code> and <code class="literal">UserVmManager</code> permissions on every virtual machine you want to migrate.
									</li></ul></div></li><li class="listitem">
								You must use a <a class="link" href="#compatibility-guidelines_mtv" title="2.9. Software compatibility guidelines">compatible version</a> of Red Hat Virtualization.
							</li><li class="listitem"><p class="simpara">
								You must have the Manager CA certificate, unless it was replaced by a third-party certificate, in which case, specify the Manager Apache CA certificate.
							</p><p class="simpara">
								You can obtain the Manager CA certificate by navigating to <a class="link" href="https://&lt;engine_host&gt;/ovirt-engine/services/pki-resource?resource=ca-certificate&amp;format=X509-PEM-CA">https://&lt;engine_host&gt;/ovirt-engine/services/pki-resource?resource=ca-certificate&amp;format=X509-PEM-CA</a> in a browser.
							</p></li><li class="listitem">
								If you are migrating a virtual machine with a direct LUN disk, ensure that the nodes in the OpenShift Virtualization destination cluster that the VM is expected to run on can access the backend storage.
							</li></ul></div></li></ul></div><div class="admonition note"><div class="admonition_header">Note</div><div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							Unlike disk images that <span class="emphasis"><em>are copied</em></span> from a source provider to a target provider, LUNs are <span class="emphasis"><em>detached</em></span>, <span class="emphasis"><em>but not removed</em></span>, from virtual machines in the source provider and then attached to the virtual machines (VMs) that are created in the target provider.
						</li><li class="listitem">
							LUNs are not removed from the source provider during the migration in case fallback to the source provider is required. However, before re-attaching the LUNs to VMs in the source provider, ensure that the LUNs are not used by VMs on the target environment at the same time, which might lead to data corruption.
						</li></ul></div></div></div></section><section class="section" id="openstack-prerequisites_mtv"><div class="titlepage"><div><div><h2 class="title">2.6. OpenStack prerequisites</h2></div></div></div><p>
				The following prerequisites apply to OpenStack migrations:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						You must use a <a class="link" href="#compatibility-guidelines_mtv" title="2.9. Software compatibility guidelines">compatible version</a> of OpenStack.
					</li></ul></div><section class="section" id="additional-authentication-for-osp_mtv"><div class="titlepage"><div><div><h3 class="title">2.6.1. Additional authentication methods for migrations with OpenStack source providers</h3></div></div></div><p>
					MTV versions 2.6 and later support the following authentication methods for migrations with OpenStack source providers in addition to the standard username and password credential set:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							Token authentication
						</li><li class="listitem">
							Application credential authentication
						</li></ul></div><p>
					You can use these methods to migrate virtual machines with OpenStack source providers using the CLI the same way you migrate other virtual machines, except for how you prepare the <code class="literal">Secret</code> manifest.
				</p><section class="section" id="openstack-token-authentication_ostack"><div class="titlepage"><div><div><h4 class="title">2.6.1.1. Using token authentication with an OpenStack source provider</h4></div></div></div><p>
						You can use token authentication, instead of username and password authentication, when you create an OpenStack source provider.
					</p><p>
						MTV supports both of the following types of token authentication:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								Token with user ID
							</li><li class="listitem">
								Token with user name
							</li></ul></div><p>
						For each type of token authentication, you need to use data from OpenStack to create a <code class="literal">Secret</code> manifest.
					</p><div class="formalpara"><p class="title"><strong>Prerequisites</strong></p><p>
							Have an OpenStack account.
						</p></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
								In the dashboard of the OpenStack web console, click <span class="strong strong"><strong>Project &gt; API Access</strong></span>.
							</li><li class="listitem"><p class="simpara">
								Expand <span class="strong strong"><strong>Download OpenStack RC file</strong></span> and click <span class="strong strong"><strong>OpenStack RC file</strong></span>.
							</p><p class="simpara">
								The file that is downloaded, referred to here as <code class="literal">&lt;openstack_rc_file&gt;</code>, includes the following fields used for token authentication:
							</p><pre class="programlisting language-terminal">OS_AUTH_URL
OS_PROJECT_ID
OS_PROJECT_NAME
OS_DOMAIN_NAME
OS_USERNAME</pre></li><li class="listitem"><p class="simpara">
								To get the data needed for token authentication, run the following command:
							</p><pre class="programlisting language-terminal">$ openstack token issue</pre><p class="simpara">
								The output, referred to here as <code class="literal">&lt;openstack_token_output&gt;</code>, includes the <code class="literal">token</code>, <code class="literal">userID</code>, and <code class="literal">projectID</code> that you need for authentication using a token with user ID.
							</p></li><li class="listitem"><p class="simpara">
								Create a <code class="literal">Secret</code> manifest similar to the following:
							</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
										For authentication using a token with user ID:
									</p><pre class="programlisting language-yaml">cat &lt;&lt; EOF | oc apply -f -
apiVersion: v1
kind: Secret
metadata:
  name: openstack-secret-tokenid
  namespace: openshift-mtv
  labels:
    createdForProviderType: openstack
type: Opaque
stringData:
  authType: token
  token: &lt;token_from_openstack_token_output&gt;
  projectID: &lt;projectID_from_openstack_token_output&gt;
  userID: &lt;userID_from_openstack_token_output&gt;
  url: &lt;OS_AUTH_URL_from_openstack_rc_file&gt;
EOF</pre></li><li class="listitem"><p class="simpara">
										For authentication using a token with user name:
									</p><pre class="programlisting language-yaml">cat &lt;&lt; EOF | oc apply -f -
apiVersion: v1
kind: Secret
metadata:
  name: openstack-secret-tokenname
  namespace: openshift-mtv
  labels:
    createdForProviderType: openstack
type: Opaque
stringData:
  authType: token
  token: &lt;token_from_openstack_token_output&gt;
  domainName: &lt;OS_DOMAIN_NAME_from_openstack_rc_file&gt;
  projectName: &lt;OS_PROJECT_NAME_from_openstack_rc_file&gt;
  username: &lt;OS_USERNAME_from_openstack_rc_file&gt;
  url: &lt;OS_AUTH_URL_from_openstack_rc_file&gt;
EOF</pre></li></ul></div></li><li class="listitem">
								Continue migrating your virtual machine according to the procedure in <a class="link" href="#new-migrating-virtual-machines-cli_ostack" title="5.3.3. Migrating from an OpenStack source provider">Migrating virtual machines</a>, starting with step 2, "Create a <code class="literal">Provider</code> manifest for the source provider."
							</li></ol></div></section><section class="section" id="openstack-application-credential-authentication_ostack"><div class="titlepage"><div><div><h4 class="title">2.6.1.2. Using application credential authentication with an OpenStack source provider</h4></div></div></div><p>
						You can use application credential authentication, instead of username and password authentication, when you create an OpenStack source provider.
					</p><p>
						MTV supports both of the following types of application credential authentication:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								Application credential ID
							</li><li class="listitem">
								Application credential name
							</li></ul></div><p>
						For each type of application credential authentication, you need to use data from OpenStack to create a <code class="literal">Secret</code> manifest.
					</p><div class="formalpara"><p class="title"><strong>Prerequisites</strong></p><p>
							You have an OpenStack account.
						</p></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
								In the dashboard of the OpenStack web console, click <span class="strong strong"><strong>Project</strong></span> &gt; <span class="strong strong"><strong>API Access</strong></span>.
							</li><li class="listitem"><p class="simpara">
								Expand <span class="strong strong"><strong>Download OpenStack RC file</strong></span> and click <span class="strong strong"><strong>OpenStack RC file</strong></span>.
							</p><p class="simpara">
								The file that is downloaded, referred to here as <code class="literal">&lt;openstack_rc_file&gt;</code>, includes the following fields used for application credential authentication:
							</p><pre class="programlisting language-terminal">OS_AUTH_URL
OS_PROJECT_ID
OS_PROJECT_NAME
OS_DOMAIN_NAME
OS_USERNAME</pre></li><li class="listitem"><p class="simpara">
								To get the data needed for application credential authentication, run the following command:
							</p><pre class="programlisting language-terminal">$ openstack application credential create --role member --role reader --secret redhat forklift</pre><p class="simpara">
								The output, referred to here as <code class="literal">&lt;openstack_credential_output&gt;</code>, includes:
							</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
										The <code class="literal">id</code> and <code class="literal">secret</code> that you need for authentication using an application credential ID
									</li><li class="listitem">
										The <code class="literal">name</code> and <code class="literal">secret</code> that you need for authentication using an application credential name
									</li></ul></div></li><li class="listitem"><p class="simpara">
								Create a <code class="literal">Secret</code> manifest similar to the following:
							</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
										For authentication using the application credential ID:
									</p><pre class="programlisting language-yaml">cat &lt;&lt; EOF | oc apply -f -
apiVersion: v1
kind: Secret
metadata:
  name: openstack-secret-appid
  namespace: openshift-mtv
  labels:
    createdForProviderType: openstack
type: Opaque
stringData:
  authType: applicationcredential
  applicationCredentialID: &lt;id_from_openstack_credential_output&gt;
  applicationCredentialSecret: &lt;secret_from_openstack_credential_output&gt;
  url: &lt;OS_AUTH_URL_from_openstack_rc_file&gt;
EOF</pre></li><li class="listitem"><p class="simpara">
										For authentication using the application credential name:
									</p><pre class="programlisting language-yaml">cat &lt;&lt; EOF | oc apply -f -
apiVersion: v1
kind: Secret
metadata:
  name: openstack-secret-appname
  namespace: openshift-mtv
  labels:
    createdForProviderType: openstack
type: Opaque
stringData:
  authType: applicationcredential
  applicationCredentialName: &lt;name_from_openstack_credential_output&gt;
  applicationCredentialSecret: &lt;secret_from_openstack_credential_output&gt;
  domainName: &lt;OS_DOMAIN_NAME_from_openstack_rc_file&gt;
  username: &lt;OS_USERNAME_from_openstack_rc_file&gt;
  url: &lt;OS_AUTH_URL_from_openstack_rc_file&gt;
EOF</pre></li></ul></div></li><li class="listitem">
								Continue migrating your virtual machine according to the procedure in <a class="link" href="#new-migrating-virtual-machines-cli_ostack" title="5.3.3. Migrating from an OpenStack source provider">Migrating virtual machines</a>, starting with step 2, "Create a <code class="literal">Provider</code> manifest for the source provider."
							</li></ol></div></section></section></section><section class="section" id="vmware-prerequisites_mtv"><div class="titlepage"><div><div><h2 class="title">2.7. VMware prerequisites</h2></div></div></div><p>
				It is strongly recommended to create a VDDK image to accelerate migrations. For more information, see <a class="link" href="#creating-vddk-image_mtv" title="2.7.1. Creating a VDDK image">Creating a VDDK image</a>.
			</p><p>
				The following prerequisites apply to VMware migrations:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						You must use a <a class="link" href="#compatibility-guidelines_mtv" title="2.9. Software compatibility guidelines">compatible version</a> of VMware vSphere.
					</li><li class="listitem">
						You must be logged in as a user with at least the minimal set of <a class="link" href="#vmware-privileges_mtv" title="VMware privileges">VMware privileges</a>.
					</li><li class="listitem">
						To access the virtual machine using a pre-migration hook, <a class="link" href="https://www.vmware.com/support/ws5/doc/new_guest_tools_ws.html">VMware Tools</a> must be installed on the source virtual machine.
					</li><li class="listitem">
						The VM operating system must be certified and supported for use as a <a class="link" href="https://access.redhat.com/articles/973163#ocpvirt">guest operating system with OpenShift Virtualization</a> <span class="emphasis"><em>and</em></span> for <a class="link" href="https://access.redhat.com/articles/1351473">conversion to KVM with <code class="literal">virt-v2v</code></a>.
					</li><li class="listitem">
						If you are running a warm migration, you must enable <a class="link" href="https://kb.vmware.com/s/article/1020128">changed block tracking (CBT)</a> on the VMs and on the VM disks.
					</li><li class="listitem">
						If you are migrating more than 10 VMs from an ESXi host in the same migration plan, you must increase the NFC service memory of the host.
					</li><li class="listitem">
						It is strongly recommended to disable hibernation because Migration Toolkit for Virtualization (MTV) does not support migrating hibernated VMs.
					</li></ul></div><div class="admonition important"><div class="admonition_header">Important</div><div><p>
					In the event of a power outage, data might be lost for a VM with disabled hibernation. However, if hibernation is not disabled, migration will fail
				</p></div></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					Neither MTV nor OpenShift Virtualization support conversion of Btrfs for migrating VMs from VMWare.
				</p></div></div><h4 id="vmware-privileges_mtv">VMware privileges</h4><p>
				The following minimal set of VMware privileges is required to migrate virtual machines to OpenShift Virtualization with the Migration Toolkit for Virtualization (MTV).
			</p><div class="table" id="idm45442638222912"><p class="title"><strong>Table 2.4. VMware privileges</strong></p><div class="table-contents"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 50%; " class="col_1"/><col style="width: 50%; " class="col_2"/></colgroup><thead><tr><th align="left" valign="top" id="idm45442639021424" scope="col">Privilege</th><th align="left" valign="top" id="idm45442639020336" scope="col">Description</th></tr></thead><tbody><tr><td colspan="2" align="left" valign="top" headers="idm45442639021424 idm45442639020336">
							<p>
								<code class="literal">Virtual machine.Interaction</code> privileges:
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm45442639021424">
							<p>
								<code class="literal">Virtual machine.Interaction.Power Off</code>
							</p>
							</td><td align="left" valign="top" headers="idm45442639020336">
							<p>
								Allows powering off a powered-on virtual machine. This operation powers down the guest operating system.
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm45442639021424">
							<p>
								<code class="literal">Virtual machine.Interaction.Power On</code>
							</p>
							</td><td align="left" valign="top" headers="idm45442639020336">
							<p>
								Allows powering on a powered-off virtual machine and resuming a suspended virtual machine.
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm45442639021424">
							<p>
								<code class="literal">Virtual machine.Guest operating system management by VIX API</code>
							</p>
							</td><td align="left" valign="top" headers="idm45442639020336">
							<p>
								Allows managing a virtual machine by the VMware VIX API.
							</p>
							</td></tr><tr><td colspan="2" align="left" valign="top" headers="idm45442639021424 idm45442639020336">
							<p>
								<code class="literal">Virtual machine.Provisioning</code> privileges:
							</p>
							<div class="admonition note"><div class="admonition_header">Note</div><div><p>
									All <code class="literal">Virtual machine.Provisioning</code> privileges are required.
								</p></div></div>
							</td></tr><tr><td align="left" valign="top" headers="idm45442639021424">
							<p>
								<code class="literal">Virtual machine.Provisioning.Allow disk access</code>
							</p>
							</td><td align="left" valign="top" headers="idm45442639020336">
							<p>
								Allows opening a disk on a virtual machine for random read and write access. Used mostly for remote disk mounting.
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm45442639021424">
							<p>
								<code class="literal">Virtual machine.Provisioning.Allow file access</code>
							</p>
							</td><td align="left" valign="top" headers="idm45442639020336">
							<p>
								Allows operations on files associated with a virtual machine, including VMX, disks, logs, and NVRAM.
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm45442639021424">
							<p>
								<code class="literal">Virtual machine.Provisioning.Allow read-only disk access</code>
							</p>
							</td><td align="left" valign="top" headers="idm45442639020336">
							<p>
								Allows opening a disk on a virtual machine for random read access. Used mostly for remote disk mounting.
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm45442639021424">
							<p>
								<code class="literal">Virtual machine.Provisioning.Allow virtual machine download</code>
							</p>
							</td><td align="left" valign="top" headers="idm45442639020336">
							<p>
								Allows read operations on files associated with a virtual machine, including VMX, disks, logs, and NVRAM.
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm45442639021424">
							<p>
								<code class="literal">Virtual machine.Provisioning.Allow virtual machine files upload</code>
							</p>
							</td><td align="left" valign="top" headers="idm45442639020336">
							<p>
								Allows write operations on files associated with a virtual machine, including VMX, disks, logs, and NVRAM.
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm45442639021424">
							<p>
								<code class="literal">Virtual machine.Provisioning.Clone template</code>
							</p>
							</td><td align="left" valign="top" headers="idm45442639020336">
							<p>
								Allows cloning of a template.
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm45442639021424">
							<p>
								<code class="literal">Virtual machine.Provisioning.Clone virtual machine</code>
							</p>
							</td><td align="left" valign="top" headers="idm45442639020336">
							<p>
								Allows cloning of an existing virtual machine and allocation of resources.
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm45442639021424">
							<p>
								<code class="literal">Virtual machine.Provisioning.Create template from virtual machine</code>
							</p>
							</td><td align="left" valign="top" headers="idm45442639020336">
							<p>
								Allows creation of a new template from a virtual machine.
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm45442639021424">
							<p>
								<code class="literal">Virtual machine.Provisioning.Customize guest</code>
							</p>
							</td><td align="left" valign="top" headers="idm45442639020336">
							<p>
								Allows customization of a virtual machine’s guest operating system without moving the virtual machine.
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm45442639021424">
							<p>
								<code class="literal">Virtual machine.Provisioning.Deploy template</code>
							</p>
							</td><td align="left" valign="top" headers="idm45442639020336">
							<p>
								Allows deployment of a virtual machine from a template.
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm45442639021424">
							<p>
								<code class="literal">Virtual machine.Provisioning.Mark as template</code>
							</p>
							</td><td align="left" valign="top" headers="idm45442639020336">
							<p>
								Allows marking an existing powered-off virtual machine as a template.
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm45442639021424">
							<p>
								<code class="literal">Virtual machine.Provisioning.Mark as virtual machine</code>
							</p>
							</td><td align="left" valign="top" headers="idm45442639020336">
							<p>
								Allows marking an existing template as a virtual machine.
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm45442639021424">
							<p>
								<code class="literal">Virtual machine.Provisioning.Modify customization specification</code>
							</p>
							</td><td align="left" valign="top" headers="idm45442639020336">
							<p>
								Allows creation, modification, or deletion of customization specifications.
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm45442639021424">
							<p>
								<code class="literal">Virtual machine.Provisioning.Promote disks</code>
							</p>
							</td><td align="left" valign="top" headers="idm45442639020336">
							<p>
								Allows promote operations on a virtual machine’s disks.
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm45442639021424">
							<p>
								<code class="literal">Virtual machine.Provisioning.Read customization specifications</code>
							</p>
							</td><td align="left" valign="top" headers="idm45442639020336">
							<p>
								Allows reading a customization specification.
							</p>
							</td></tr><tr><td colspan="2" align="left" valign="top" headers="idm45442639021424 idm45442639020336">
							<p>
								<code class="literal">Virtual machine.Snapshot management</code> privileges:
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm45442639021424">
							<p>
								<code class="literal">Virtual machine.Snapshot management.Create snapshot</code>
							</p>
							</td><td align="left" valign="top" headers="idm45442639020336">
							<p>
								Allows creation of a snapshot from the virtual machine’s current state.
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm45442639021424">
							<p>
								<code class="literal">Virtual machine.Snapshot management.Remove Snapshot</code>
							</p>
							</td><td align="left" valign="top" headers="idm45442639020336">
							<p>
								Allows removal of a snapshot from the snapshot history.
							</p>
							</td></tr><tr><td colspan="2" align="left" valign="top" headers="idm45442639021424 idm45442639020336">
							<p>
								<code class="literal">Datastore</code> privileges:
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm45442639021424">
							<p>
								<code class="literal">Datastore.Browse datastore</code>
							</p>
							</td><td align="left" valign="top" headers="idm45442639020336">
							<p>
								Allows exploring the contents of a datastore.
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm45442639021424">
							<p>
								<code class="literal">Datastore.Low level file operations</code>
							</p>
							</td><td align="left" valign="top" headers="idm45442639020336">
							<p>
								Allows performing low-level file operations - read, write, delete, and rename - in a datastore.
							</p>
							</td></tr><tr><td colspan="2" align="left" valign="top" headers="idm45442639021424 idm45442639020336">
							<p>
								<code class="literal">Sessions</code> privileges:
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm45442639021424">
							<p>
								<code class="literal">Sessions.Validate session</code>
							</p>
							</td><td align="left" valign="top" headers="idm45442639020336">
							<p>
								Allows verification of the validity of a session.
							</p>
							</td></tr><tr><td colspan="2" align="left" valign="top" headers="idm45442639021424 idm45442639020336">
							<p>
								<code class="literal">Cryptographic</code> privileges:
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm45442639021424">
							<p>
								<code class="literal">Cryptographic.Decrypt</code>
							</p>
							</td><td align="left" valign="top" headers="idm45442639020336">
							<p>
								Allows decryption of an encrypted virtual machine.
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm45442639021424">
							<p>
								<code class="literal">Cryptographic.Direct access</code>
							</p>
							</td><td align="left" valign="top" headers="idm45442639020336">
							<p>
								Allows access to encrypted resources.
							</p>
							</td></tr></tbody></table></div></div><section class="section" id="creating-vddk-image_mtv"><div class="titlepage"><div><div><h3 class="title">2.7.1. Creating a VDDK image</h3></div></div></div><p>
					The Migration Toolkit for Virtualization (MTV) can use the VMware Virtual Disk Development Kit (VDDK) SDK to accelerate transferring virtual disks from VMware vSphere.
				</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
						Creating a VDDK image, although optional, is highly recommended.
					</p></div></div><p>
					To make use of this feature, you download the VMware Virtual Disk Development Kit (VDDK), build a VDDK image, and push the VDDK image to your image registry.
				</p><p>
					The VDDK package contains symbolic links, therefore, the procedure of creating a VDDK image must be performed on a file system that preserves symbolic links (symlinks).
				</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
						Storing the VDDK image in a public registry might violate the VMware license terms.
					</p></div></div><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
							<a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.14/html/registry/setting-up-and-configuring-the-registry#configuring-registry-storage-baremetal">Red Hat OpenShift image registry</a>.
						</li><li class="listitem">
							<code class="literal">podman</code> installed.
						</li><li class="listitem">
							You are working on a file system that preserves symbolic links (symlinks).
						</li><li class="listitem">
							If you are using an external registry, OpenShift Virtualization must be able to access it.
						</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Create and navigate to a temporary directory:
						</p><pre class="programlisting language-terminal">$ mkdir /tmp/&lt;dir_name&gt; &amp;&amp; cd /tmp/&lt;dir_name&gt;</pre></li><li class="listitem">
							In a browser, navigate to the <a class="link" href="https://developer.vmware.com/web/sdk/8.0/vddk">VMware VDDK version 8 download page</a>.
						</li><li class="listitem">
							Select version 8.0.1 and click <span class="strong strong"><strong>Download</strong></span>.
						</li></ol></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
						In order to migrate to OpenShift Virtualization 4.12, download VDDK version 7.0.3.2 from the <a class="link" href="https://developer.vmware.com/web/sdk/7.0/vddk">VMware VDDK version 7 download page</a>.
					</p></div></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
							Save the VDDK archive file in the temporary directory.
						</li><li class="listitem"><p class="simpara">
							Extract the VDDK archive:
						</p><pre class="programlisting language-terminal">$ tar -xzf VMware-vix-disklib-&lt;version&gt;.x86_64.tar.gz</pre></li><li class="listitem"><p class="simpara">
							Create a <code class="literal">Dockerfile</code>:
						</p><pre class="programlisting language-terminal">$ cat &gt; Dockerfile &lt;&lt;EOF
FROM registry.access.redhat.com/ubi8/ubi-minimal
USER 1001
COPY vmware-vix-disklib-distrib /vmware-vix-disklib-distrib
RUN mkdir -p /opt
ENTRYPOINT ["cp", "-r", "/vmware-vix-disklib-distrib", "/opt"]
EOF</pre></li><li class="listitem"><p class="simpara">
							Build the VDDK image:
						</p><pre class="programlisting language-terminal">$ podman build . -t &lt;registry_route_or_server_path&gt;/vddk:&lt;tag&gt;</pre></li><li class="listitem"><p class="simpara">
							Push the VDDK image to the registry:
						</p><pre class="programlisting language-terminal">$ podman push &lt;registry_route_or_server_path&gt;/vddk:&lt;tag&gt;</pre></li><li class="listitem">
							Ensure that the image is accessible to your OpenShift Virtualization environment.
						</li></ol></div></section><section class="section" id="increasing-nfc-memory-vmware-host_mtv"><div class="titlepage"><div><div><h3 class="title">2.7.2. Increasing the NFC service memory of an ESXi host</h3></div></div></div><p>
					If you are migrating more than 10 VMs from an ESXi host in the same migration plan, you must increase the NFC service memory of the host. Otherwise, the migration will fail because the NFC service memory is limited to 10 parallel connections.
				</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
							Log in to the ESXi host as root.
						</li><li class="listitem"><p class="simpara">
							Change the value of <code class="literal">maxMemory</code> to <code class="literal">1000000000</code> in <code class="literal">/etc/vmware/hostd/config.xml</code>:
						</p><pre class="programlisting language-xml">...
      &lt;nfcsvc&gt;
         &lt;path&gt;libnfcsvc.so&lt;/path&gt;
         &lt;enabled&gt;true&lt;/enabled&gt;
         &lt;maxMemory&gt;1000000000&lt;/maxMemory&gt;
         &lt;maxStreamMemory&gt;10485760&lt;/maxStreamMemory&gt;
      &lt;/nfcsvc&gt;
...</pre></li><li class="listitem"><p class="simpara">
							Restart <code class="literal">hostd</code>:
						</p><pre class="programlisting language-terminal"># /etc/init.d/hostd restart</pre><p class="simpara">
							You do not need to reboot the host.
						</p></li></ol></div></section></section><section class="section" id="ova-prerequisites_mtv"><div class="titlepage"><div><div><h2 class="title">2.8. Open Virtual Appliance (OVA) prerequisites</h2></div></div></div><p>
				The following prerequisites apply to Open Virtual Appliance (OVA) file migrations:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						All OVA files are created by VMware vSphere.
					</li></ul></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					Migration of OVA files that were not created by VMware vSphere but are compatible with vSphere might succeed. However, migration of such files is not supported by MTV. MTV supports only OVA files created by VMware vSphere.
				</p></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						The OVA files are in one or more folders under an NFS shared directory in one of the following structures:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem"><p class="simpara">
								In one or more compressed Open Virtualization Format (OVF) packages that hold all the VM information.
							</p><p class="simpara">
								The filename of each compressed package <span class="strong strong"><strong>must</strong></span> have the <code class="literal">.ova</code> extension. Several compressed packages can be stored in the same folder.
							</p><p class="simpara">
								When this structure is used, MTV scans the root folder and the first-level subfolders for compressed packages.
							</p><p class="simpara">
								For example, if the NFS share is, <code class="literal">/nfs</code>, then:<br/> The folder <code class="literal">/nfs</code> is scanned.<br/> The folder <code class="literal">/nfs/subfolder1</code> is scanned.<br/> But, <code class="literal">/nfs/subfolder1/subfolder2</code> is not scanned.
							</p></li><li class="listitem"><p class="simpara">
								In extracted OVF packages.
							</p><p class="simpara">
								When this structure is used, MTV scans the root folder, first-level subfolders, and second-level subfolders for extracted OVF packages. However, there can be only one <code class="literal">.ovf</code> file in a folder. Otherwise, the migration will fail.
							</p><p class="simpara">
								For example, if the NFS share is, <code class="literal">/nfs</code>, then:<br/> The OVF file <code class="literal">/nfs/vm.ovf</code> is scanned.<br/> The OVF file <code class="literal">/nfs/subfolder1/vm.ovf</code> is scanned.<br/> The OVF file <code class="literal">/nfs/subfolder1/subfolder2/vm.ovf</code> is scanned.<br/> But, the OVF file <code class="literal">/nfs/subfolder1/subfolder2/subfolder3/vm.ovf</code> is not scanned.
							</p></li></ul></div></li></ul></div></section><section class="section" id="compatibility-guidelines_mtv"><div class="titlepage"><div><div><h2 class="title">2.9. Software compatibility guidelines</h2></div></div></div><p>
				You must install compatible software versions.
			</p><div class="table" id="idm45442638487936"><p class="title"><strong>Table 2.5. Compatible software versions</strong></p><div class="table-contents"><table class="gt-4-cols lt-7-rows"><colgroup><col style="width: 17%; " class="col_1"/><col style="width: 17%; " class="col_2"/><col style="width: 17%; " class="col_3"/><col style="width: 17%; " class="col_4"/><col style="width: 17%; " class="col_5"/><col style="width: 17%; " class="col_6"/></colgroup><thead><tr><th align="left" valign="top" id="idm45442631738848" scope="col">Migration Toolkit for Virtualization</th><th align="left" valign="top" id="idm45442631737792" scope="col">Red Hat OpenShift</th><th align="left" valign="top" id="idm45442631736704" scope="col">OpenShift Virtualization</th><th align="left" valign="top" id="idm45442631735600" scope="col">VMware vSphere</th><th align="left" valign="top" id="idm45442631734512" scope="col">Red Hat Virtualization</th><th align="left" valign="top" id="idm45442637884096" scope="col">OpenStack</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm45442631738848">
							<p>
								2.7.0
							</p>
							</td><td align="left" valign="top" headers="idm45442631737792">
							<p>
								4.14 or later
							</p>
							</td><td align="left" valign="top" headers="idm45442631736704">
							<p>
								4.14 or later
							</p>
							</td><td align="left" valign="top" headers="idm45442631735600">
							<p>
								6.5 or later
							</p>
							</td><td align="left" valign="top" headers="idm45442631734512">
							<p>
								4.4 SP1 or later
							</p>
							</td><td align="left" valign="top" headers="idm45442637884096">
							<p>
								16.1 or later
							</p>
							</td></tr></tbody></table></div></div><div class="admonition note"><div class="admonition_header">Migration from Red Hat Virtualization 4.3</div><div><p>
					MTV 2.7 was tested only with Red Hat Virtualization (RHV) 4.4 SP1. Migration from Red Hat Virtualization (RHV) 4.3 has not been tested with MTV 2.7. While not supported, basic migrations from RHV 4.3 are expected to work.
				</p><p>
					As RHV 4.3 lacks the improvements that were introduced in RHV 4.4 for MTV, and new features were not tested with RHV 4.3, migrations from RHV 4.3 may not function at the same level as migrations from RHV 4.4, with some functionality may be missing.
				</p><p>
					Therefore, it is recommended to upgrade RHV to the supported version above before the migration to OpenShift Virtualization.
				</p><p>
					However, migrations from RHV 4.3.11 were tested with MTV 2.3, and may work in practice in many environments using MTV 2.7. In this case, we advise upgrading Red Hat Virtualization Manager (RHVM) to the previously mentioned supported version before the migration to OpenShift Virtualization.
				</p></div></div><section class="section" id="openshift-operator-life-cycles"><div class="titlepage"><div><div><h3 class="title">2.9.1. OpenShift Operator Life Cycles</h3></div></div></div><p>
					For more information about the software maintenance Life Cycle classifications for Operators shipped by Red Hat for use with OpenShift Container Platform, see <a class="link" href="https://access.redhat.com/support/policy/updates/openshift_operators#platform-agnostic">OpenShift Operator Life Cycles</a>.
				</p></section></section></section><section class="chapter" id="installing-the-operator_mtv"><div class="titlepage"><div><div><h1 class="title">Chapter 3. Installing and configuring the MTV Operator</h1></div></div></div><p>
			You can install the MTV Operator by using the Red Hat OpenShift web console or the command line interface (CLI).
		</p><p>
			In Migration Toolkit for Virtualization (MTV) version 2.4 and later, the MTV Operator includes the MTV plugin for the Red Hat OpenShift web console.
		</p><p>
			After you install the MTV Operator by using either the Red Hat OpenShift web console or the CLI, you can configure the Operator.
		</p><section class="section" id="installing-mtv-operator_web"><div class="titlepage"><div><div><h2 class="title">3.1. Installing the MTV Operator by using the Red Hat OpenShift web console</h2></div></div></div><p>
				You can install the MTV Operator by using the Red Hat OpenShift web console.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						Red Hat OpenShift 4.14 or later installed.
					</li><li class="listitem">
						OpenShift Virtualization Operator installed on an OpenShift migration target cluster.
					</li><li class="listitem">
						You must be logged in as a user with <code class="literal">cluster-admin</code> permissions.
					</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
						In the Red Hat OpenShift web console, click <span class="strong strong"><strong>Operators</strong></span> → <span class="strong strong"><strong>OperatorHub</strong></span>.
					</li><li class="listitem">
						Use the <span class="strong strong"><strong>Filter by keyword</strong></span> field to search for <span class="strong strong"><strong>mtv-operator</strong></span>.
					</li><li class="listitem">
						Click <span class="strong strong"><strong>Migration Toolkit for Virtualization Operator</strong></span> and then click <span class="strong strong"><strong>Install</strong></span>.
					</li><li class="listitem">
						Click <span class="strong strong"><strong>Create ForkliftController</strong></span> when the button becomes active.
					</li><li class="listitem"><p class="simpara">
						Click <span class="strong strong"><strong>Create</strong></span>.
					</p><p class="simpara">
						Your ForkliftController appears in the list that is displayed.
					</p></li><li class="listitem">
						Click <span class="strong strong"><strong>Workloads</strong></span> → <span class="strong strong"><strong>Pods</strong></span> to verify that the MTV pods are running.
					</li><li class="listitem"><p class="simpara">
						Click <span class="strong strong"><strong>Operators</strong></span> → <span class="strong strong"><strong>Installed Operators</strong></span> to verify that <span class="strong strong"><strong>Migration Toolkit for Virtualization Operator</strong></span> appears in the <span class="strong strong"><strong>openshift-mtv</strong></span> project with the status <span class="strong strong"><strong>Succeeded</strong></span>.
					</p><p class="simpara">
						When the plugin is ready you will be prompted to reload the page. The <span class="strong strong"><strong>Migration</strong></span> menu item is automatically added to the navigation bar, displayed on the left of the Red Hat OpenShift web console.
					</p></li></ol></div></section><section class="section" id="installing-mtv-operator_cli"><div class="titlepage"><div><div><h2 class="title">3.2. Installing the MTV Operator from the command line interface</h2></div></div></div><p>
				You can install the MTV Operator from the command line interface (CLI).
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						Red Hat OpenShift 4.14 or later installed.
					</li><li class="listitem">
						OpenShift Virtualization Operator installed on an OpenShift migration target cluster.
					</li><li class="listitem">
						You must be logged in as a user with <code class="literal">cluster-admin</code> permissions.
					</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Create the openshift-mtv project:
					</p><pre class="programlisting language-terminal">$ cat &lt;&lt; EOF | oc apply -f -
apiVersion: project.openshift.io/v1
kind: Project
metadata:
  name: openshift-mtv
EOF</pre></li><li class="listitem"><p class="simpara">
						Create an <code class="literal">OperatorGroup</code> CR called <code class="literal">migration</code>:
					</p><pre class="programlisting language-terminal">$ cat &lt;&lt; EOF | oc apply -f -
apiVersion: operators.coreos.com/v1
kind: OperatorGroup
metadata:
  name: migration
  namespace: openshift-mtv
spec:
  targetNamespaces:
    - openshift-mtv
EOF</pre></li><li class="listitem"><p class="simpara">
						Create a <code class="literal">Subscription</code> CR for the Operator:
					</p><pre class="programlisting language-terminal">$ cat &lt;&lt; EOF | oc apply -f -
apiVersion: operators.coreos.com/v1alpha1
kind: Subscription
metadata:
  name: mtv-operator
  namespace: openshift-mtv
spec:
  channel: release-v2.7
  installPlanApproval: Automatic
  name: mtv-operator
  source: redhat-operators
  sourceNamespace: openshift-marketplace
  startingCSV: "mtv-operator.v2.7.0"
EOF</pre></li><li class="listitem"><p class="simpara">
						Create a <code class="literal">ForkliftController</code> CR:
					</p><pre class="programlisting language-terminal">$ cat &lt;&lt; EOF | oc apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: ForkliftController
metadata:
  name: forklift-controller
  namespace: openshift-mtv
spec:
  olm_managed: true
EOF</pre></li><li class="listitem"><p class="simpara">
						Verify that the MTV pods are running:
					</p><pre class="programlisting language-terminal">$ oc get pods -n openshift-mtv</pre><div class="formalpara"><p class="title"><strong>Example output</strong></p><p>
							
<pre class="screen">NAME                                                    READY   STATUS    RESTARTS   AGE
forklift-api-bb45b8db4-cpzlg                            1/1     Running   0          6m34s
forklift-controller-7649db6845-zd25p                    2/2     Running   0          6m38s
forklift-must-gather-api-78fb4bcdf6-h2r4m               1/1     Running   0          6m28s
forklift-operator-59c87cfbdc-pmkfc                      1/1     Running   0          28m
forklift-ui-plugin-5c5564f6d6-zpd85                     1/1     Running   0          6m24s
forklift-validation-7d84c74c6f-fj9xg                    1/1     Running   0          6m30s
forklift-volume-populator-controller-85d5cb64b6-mrlmc   1/1     Running   0          6m36s</pre>
						</p></div></li></ol></div></section><section class="section" id="configuring-mtv-operator_mtv"><div class="titlepage"><div><div><h2 class="title">3.3. Configuring the MTV Operator</h2></div></div></div><p>
				You can configure all of the following settings of the MTV Operator by modifying the <code class="literal">ForkliftController</code> CR, or in the <span class="strong strong"><strong>Settings</strong></span> section of the <span class="strong strong"><strong>Overview</strong></span> page, unless otherwise indicated.
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						Maximum number of virtual machines (VMs) per plan that can be migrated simultaneously.
					</li><li class="listitem">
						How long <code class="literal">must gather</code> reports are retained before being automatically deleted.
					</li><li class="listitem">
						CPU limit allocated to the main controller container.
					</li><li class="listitem">
						Memory limit allocated to the main controller container.
					</li><li class="listitem">
						Interval at which a new snapshot is requested before initiating a warm migration.
					</li><li class="listitem">
						Frequency with which the system checks the status of snapshot creation or removal during a warm migration.
					</li><li class="listitem">
						Percentage of space in persistent volumes allocated as file system overhead when the <code class="literal">storageclass</code> is <code class="literal">filesystem</code> (<code class="literal">ForkliftController</code> CR only).
					</li><li class="listitem">
						Fixed amount of additional space allocated in persistent block volumes. This setting is applicable for any <code class="literal">storageclass</code> that is block-based (<code class="literal">ForkliftController</code> CR only).
					</li><li class="listitem">
						Configuration map of operating systems to preferences for vSphere source providers (<code class="literal">ForkliftController</code> CR only).
					</li><li class="listitem">
						Configuration map of operating systems to preferences for Red Hat Virtualization (RHV) source providers (<code class="literal">ForkliftController</code> CR only).
					</li></ul></div><p>
				The procedure for configuring these settings using the user interface is presented in <a class="link" href="#mtv-overview-page_mtv" title="4.2. The MTV Overview page">Configuring MTV settings</a>. The procedure for configuring these settings by modifying the <code class="literal">ForkliftController</code> CR is presented following.
			</p><div class="itemizedlist"><p class="title"><strong>Procedure</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						Change a parameter’s value in the <code class="literal">spec</code> portion of the <code class="literal">ForkliftController</code> CR by adding the label and value as follows:
					</li></ul></div><pre class="screen">spec:
  label: value <span id="CO1-1"/><span class="callout">1</span></pre><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO1-1"><span class="callout">1</span></a> </dt><dd><div class="para">
						Labels you can configure using the CLI are shown in the table that follows, along with a description of each label and its default value.
					</div></dd></dl></div><div class="table" id="idm45442638434160"><p class="title"><strong>Table 3.1. MTV Operator labels</strong></p><div class="table-contents"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 33%; " class="col_1"/><col style="width: 33%; " class="col_2"/><col style="width: 33%; " class="col_3"/></colgroup><thead><tr><th align="left" valign="top" id="idm45442633551184" scope="col">Label</th><th align="left" valign="top" id="idm45442633550096" scope="col">Description</th><th align="left" valign="top" id="idm45442633549008" scope="col">Default value</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm45442633551184">
							<p>
								<code class="literal">controller_max_vm_inflight</code>
							</p>
							</td><td align="left" valign="top" headers="idm45442633550096">
							<p>
								The maximum number of VMs per plan that can be migrated simultaneously.
							</p>
							</td><td align="left" valign="top" headers="idm45442633549008">
							<p>
								<code class="literal">20</code>
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm45442633551184">
							<p>
								<code class="literal">must_gather_api_cleanup_max_age</code>
							</p>
							</td><td align="left" valign="top" headers="idm45442633550096">
							<p>
								The duration in hours for retaining <code class="literal">must gather</code> reports before they are automatically deleted.
							</p>
							</td><td align="left" valign="top" headers="idm45442633549008">
							<p>
								<code class="literal">-1</code> (disabled)
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm45442633551184">
							<p>
								<code class="literal">controller_container_limits_cpu</code>
							</p>
							</td><td align="left" valign="top" headers="idm45442633550096">
							<p>
								The CPU limit allocated to the main controller container.
							</p>
							</td><td align="left" valign="top" headers="idm45442633549008">
							<p>
								<code class="literal">500m</code>
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm45442633551184">
							<p>
								<code class="literal">controller_container_limits_memory</code>
							</p>
							</td><td align="left" valign="top" headers="idm45442633550096">
							<p>
								The memory limit allocated to the main controller container.
							</p>
							</td><td align="left" valign="top" headers="idm45442633549008">
							<p>
								<code class="literal">800Mi</code>
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm45442633551184">
							<p>
								<code class="literal">controller_precopy_interval</code>
							</p>
							</td><td align="left" valign="top" headers="idm45442633550096">
							<p>
								The interval in minutes at which a new snapshot is requested before initiating a warm migration.
							</p>
							</td><td align="left" valign="top" headers="idm45442633549008">
							<p>
								<code class="literal">60</code>
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm45442633551184">
							<p>
								<code class="literal">controller_snapshot_status_check_rate_seconds</code>
							</p>
							</td><td align="left" valign="top" headers="idm45442633550096">
							<p>
								The frequency in seconds with which the system checks the status of snapshot creation or removal during a warm migration.
							</p>
							</td><td align="left" valign="top" headers="idm45442633549008">
							<p>
								<code class="literal">10</code>
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm45442633551184">
							<p>
								<code class="literal">controller_filesystem_overhead</code>
							</p>
							</td><td align="left" valign="top" headers="idm45442633550096">
							<p>
								Percentage of space in persistent volumes allocated as file system overhead when the <code class="literal">storageclass</code> is <code class="literal">filesystem</code>.
							</p>
							<p>
								<code class="literal">ForkliftController</code> CR only.
							</p>
							</td><td align="left" valign="top" headers="idm45442633549008">
							<p>
								<code class="literal">10</code>
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm45442633551184">
							<p>
								<code class="literal">controller_block_overhead</code>
							</p>
							</td><td align="left" valign="top" headers="idm45442633550096">
							<p>
								Fixed amount of additional space allocated in persistent block volumes. This setting is applicable for any <code class="literal">storageclass</code> that is block-based. It can be used when data, such as encryption headers, is written to the persistent volumes in addition to the content of the virtual disk.
							</p>
							<p>
								<code class="literal">ForkliftController</code> CR only.
							</p>
							</td><td align="left" valign="top" headers="idm45442633549008">
							<p>
								<code class="literal">0</code>
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm45442633551184">
							<p>
								<code class="literal">vsphere_osmap_configmap_name</code>
							</p>
							</td><td align="left" valign="top" headers="idm45442633550096">
							<p>
								Configuration map for vSphere source providers. This configuration map maps the operating system of the incoming VM to a OpenShift Virtualization preference name. This configuration map needs to be in the namespace where the MTV Operator is deployed.
							</p>
							<p>
								To see the list of preferences in your OpenShift Virtualization environment, open the OpenShift web console and click <span class="strong strong"><strong>Virtualization</strong></span> → <span class="strong strong"><strong>Preferences</strong></span>.
							</p>
							<p>
								You can add values to the configuration map when this label has the default value, <code class="literal">forklift-vsphere-osmap.</code> In order to override or delete values, specify a configuration map that is different from <code class="literal">forklift-vsphere-osmap</code>.
							</p>
							<p>
								<code class="literal">ForkliftController</code> CR only.
							</p>
							</td><td align="left" valign="top" headers="idm45442633549008">
							<p>
								<code class="literal">forklift-vsphere-osmap</code>
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm45442633551184">
							<p>
								<code class="literal">ovirt_osmap_configmap_name</code>
							</p>
							</td><td align="left" valign="top" headers="idm45442633550096">
							<p>
								Configuration map for RHV source providers. This configuration map maps the operating system of the incoming VM to a OpenShift Virtualization preference name. This configuration map needs to be in the namespace where the MTV Operator is deployed.
							</p>
							<p>
								To see the list of preferences in your OpenShift Virtualization environment, open the OpenShift web console and click <span class="strong strong"><strong>Virtualization</strong></span> → <span class="strong strong"><strong>Preferences</strong></span>.
							</p>
							<p>
								You can add values to the configuration map when this label has the default value, <code class="literal">forklift-ovirt-osmap.</code> In order to override or delete values, specify a configuration map that is different from <code class="literal">forklift-ovirt-osmap</code>.
							</p>
							<p>
								<code class="literal">ForkliftController</code> CR only.
							</p>
							</td><td align="left" valign="top" headers="idm45442633549008">
							<p>
								<code class="literal">forklift-ovirt-osmap</code>
							</p>
							</td></tr></tbody></table></div></div></section></section><section class="chapter" id="migrating-vms-web-console_mtv"><div class="titlepage"><div><div><h1 class="title">Chapter 4. Migrating virtual machines by using the Red Hat OpenShift web console</h1></div></div></div><p>
			You can migrate virtual machines (VMs) by using the Red Hat OpenShift web console to:
		</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
					<a class="link" href="#adding-source-providers" title="4.4.1. Adding source providers">Create source providers</a>
				</li><li class="listitem">
					<a class="link" href="#adding-destination-providers" title="4.4.2. Adding destination providers">Create destination providers</a>
				</li><li class="listitem">
					<a class="link" href="#creating-migration-plans-ui" title="4.5. Creating migration plans">Create migration plans</a>
				</li></ol></div><div class="admonition important"><div class="admonition_header">Important</div><div><p>
				You must ensure that all <a class="link" href="#prerequisites_mtv" title="Chapter 2. Prerequisites">prerequisites</a> are met.
			</p><p>
				VMware only: You must have the minimal set of <a class="link" href="#vmware-privileges_mtv" title="VMware privileges">VMware privileges</a>.
			</p><p>
				VMware only: Creating a <a class="link" href="#creating-vddk-image_mtv" title="2.7.1. Creating a VDDK image">VMware Virtual Disk Development Kit (VDDK)</a> image will increase migration speed.
			</p></div></div><section class="section" id="mtv-ui_mtv"><div class="titlepage"><div><div><h2 class="title">4.1. The MTV user interface</h2></div></div></div><p>
				The Migration Toolkit for Virtualization (MTV) user interface is integrated into the OpenShift web console.
			</p><p>
				In the left-hand panel, you can choose a page related to a component of the migration progress, for example, <span class="strong strong"><strong>Providers for Migration</strong></span>, or, if you are an administrator, you can choose <span class="strong strong"><strong>Overview</strong></span>, which contains information about migrations and lets you configure MTV settings.
			</p><div class="figure" id="idm45442638557056"><p class="title"><strong>Figure 4.1. MTV extension interface</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/modules/images/mtv-ui.png" alt="MTV user interface"/></div></div></div><p>
				In pages related to components, you can click on the <span class="strong strong"><strong>Projects</strong></span> list, which is in the upper-left portion of the page, and see which projects (namespaces) you are allowed to work with.
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						If you are an administrator, you can see all projects.
					</li><li class="listitem">
						If you are a non-administrator, you can see only the projects that you have permissions to work with.
					</li></ul></div></section><section class="section" id="mtv-overview-page_mtv"><div class="titlepage"><div><div><h2 class="title">4.2. The MTV Overview page</h2></div></div></div><p>
				The Migration Toolkit for Virtualization (MTV) <span class="strong strong"><strong>Overview</strong></span> page displays system-wide information about migrations and a list of <span class="strong strong"><strong>Settings</strong></span> you can change.
			</p><p>
				If you have Administrator privileges, you can access the <span class="strong strong"><strong>Overview</strong></span> page by clicking <span class="strong strong"><strong>Migration</strong></span> → <span class="strong strong"><strong>Overview</strong></span> in the Red Hat OpenShift web console.
			</p><p>
				The <span class="strong strong"><strong>Overview</strong></span> page has 3 tabs:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						Overview
					</li><li class="listitem">
						YAML
					</li><li class="listitem">
						Metrics
					</li></ul></div><section class="section" id="overview-tab_mtv"><div class="titlepage"><div><div><h3 class="title">4.2.1. Overview tab</h3></div></div></div><p>
					The <span class="strong strong"><strong>Overview</strong></span> tab lets you see:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							Operator: The namespace on which the MTV Operator is deployed and the status of the Operator
						</li><li class="listitem">
							Pods: The name, status, and creation time of each pod that was deployed by the MTV Operator
						</li><li class="listitem"><p class="simpara">
							Conditions: Status of the MTV Operator:
						</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
									Failure: Last failure. <code class="literal">False</code> indicates no failure since deployment.
								</li><li class="listitem">
									Running: Whether the Operator is currently running and waiting for the next reconciliation.
								</li><li class="listitem">
									Successful: Last successful reconciliation.
								</li></ul></div></li></ul></div></section><section class="section" id="yaml-tab_mtv"><div class="titlepage"><div><div><h3 class="title">4.2.2. YAML tab</h3></div></div></div><p>
					The custom resource ForkliftController that defines the operation of the MTV Operator. You can modify the custom resource from this tab.
				</p></section><section class="section" id="metrics-tab_mtv"><div class="titlepage"><div><div><h3 class="title">4.2.3. Metrics tab</h3></div></div></div><p>
					The <span class="strong strong"><strong>Metrics</strong></span> tab lets you see:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
							Migrations: The number of migrations performed using MTV:
						</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
									Total
								</li><li class="listitem">
									Running
								</li><li class="listitem">
									Failed
								</li><li class="listitem">
									Succeeded
								</li><li class="listitem">
									Canceled
								</li></ul></div></li><li class="listitem"><p class="simpara">
							Virtual Machine Migrations: The number of VMs migrated using MTV:
						</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
									Total
								</li><li class="listitem">
									Running
								</li><li class="listitem">
									Failed
								</li><li class="listitem">
									Succeeded
								</li><li class="listitem">
									Canceled
								</li></ul></div></li></ul></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
						Since a single migration might involve many virtual machines, the number of migrations performed using MTV might vary significantly from the number of virtual machines that have been migrated using MTV.
					</p></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							Chart showing the number of running, failed, and succeeded migrations performed using MTV for each of the last 7 days
						</li><li class="listitem">
							Chart showing the number of running, failed, and succeeded virtual machine migrations performed using MTV for each of the last 7 days
						</li></ul></div></section></section><section class="section" id="mtv-settings_mtv"><div class="titlepage"><div><div><h2 class="title">4.3. Configuring MTV settings</h2></div></div></div><p>
				If you have Administrator privileges, you can access the <span class="strong strong"><strong>Overview</strong></span> page and change the following settings in it:
			</p><div class="table" id="idm45442631780784"><p class="title"><strong>Table 4.1. MTV settings</strong></p><div class="table-contents"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 33%; " class="col_1"/><col style="width: 33%; " class="col_2"/><col style="width: 33%; " class="col_3"/></colgroup><thead><tr><th align="left" valign="top" id="idm45442631775024" scope="col">Setting</th><th align="left" valign="top" id="idm45442638269120" scope="col">Description</th><th align="left" valign="top" id="idm45442638268032" scope="col">Default value</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm45442631775024">
							<p>
								Max concurrent virtual machine migrations
							</p>
							</td><td align="left" valign="top" headers="idm45442638269120">
							<p>
								The maximum number of VMs per plan that can be migrated simultaneously
							</p>
							</td><td align="left" valign="top" headers="idm45442638268032">
							<p>
								20
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm45442631775024">
							<p>
								Must gather cleanup after (hours)
							</p>
							</td><td align="left" valign="top" headers="idm45442638269120">
							<p>
								The duration for retaining <code class="literal">must gather</code> reports before they are automatically deleted
							</p>
							</td><td align="left" valign="top" headers="idm45442638268032">
							<p>
								Disabled
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm45442631775024">
							<p>
								Controller main container CPU limit
							</p>
							</td><td align="left" valign="top" headers="idm45442638269120">
							<p>
								The CPU limit allocated to the main controller container
							</p>
							</td><td align="left" valign="top" headers="idm45442638268032">
							<p>
								500 m
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm45442631775024">
							<p>
								Controller main container Memory limit
							</p>
							</td><td align="left" valign="top" headers="idm45442638269120">
							<p>
								The memory limit allocated to the main controller container
							</p>
							</td><td align="left" valign="top" headers="idm45442638268032">
							<p>
								800 Mi
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm45442631775024">
							<p>
								Precopy internal (minutes)
							</p>
							</td><td align="left" valign="top" headers="idm45442638269120">
							<p>
								The interval at which a new snapshot is requested before initiating a warm migration
							</p>
							</td><td align="left" valign="top" headers="idm45442638268032">
							<p>
								60
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm45442631775024">
							<p>
								Snapshot polling interval (seconds)
							</p>
							</td><td align="left" valign="top" headers="idm45442638269120">
							<p>
								The frequency with which the system checks the status of snapshot creation or removal during a warm migration
							</p>
							</td><td align="left" valign="top" headers="idm45442638268032">
							<p>
								10
							</p>
							</td></tr></tbody></table></div></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
						In the Red Hat OpenShift web console, click <span class="strong strong"><strong>Migration</strong></span> → <span class="strong strong"><strong>Overview</strong></span>. The <span class="strong strong"><strong>Settings</strong></span> list is on the right-hand side of the page.
					</li><li class="listitem">
						In the <span class="strong strong"><strong>Settings</strong></span> list, click the Edit icon of the setting you want to change.
					</li><li class="listitem">
						Choose a setting from the list.
					</li><li class="listitem">
						Click <span class="strong strong"><strong>Save</strong></span>.
					</li></ol></div></section><section class="section" id="adding-providers"><div class="titlepage"><div><div><h2 class="title">4.4. Adding providers</h2></div></div></div><p>
				You can add source providers and destination providers for a virtual machine migration by using the Red Hat OpenShift web console.
			</p><section class="section" id="adding-source-providers"><div class="titlepage"><div><div><h3 class="title">4.4.1. Adding source providers</h3></div></div></div><p>
					You can use MTV to migrate VMs from the following source providers:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							VMware vSphere
						</li><li class="listitem">
							Red Hat Virtualization
						</li><li class="listitem">
							OpenStack
						</li><li class="listitem">
							Open Virtual Appliances (OVAs) that were created by VMware vSphere
						</li><li class="listitem">
							OpenShift Virtualization
						</li></ul></div><p>
					You can add a source provider by using the Red Hat OpenShift web console.
				</p><section class="section" id="adding-source-provider_vmware"><div class="titlepage"><div><div><h4 class="title">4.4.1.1. Adding a VMware vSphere source provider</h4></div></div></div><p>
						You can migrate VMware vSphere VMs from VMware vCenter or from a VMWare ESX/ESXi server. In MTV versions 2.6 and later, you can migrate directly from an ESX/ESXi server, without going through vCenter, by specifying the SDK endpoint to that of an ESX/ESXi server.
					</p><div class="admonition important"><div class="admonition_header">Important</div><div><p>
							EMS enforcement is disabled for migrations with VMware vSphere source providers in order to enable migrations from versions of vSphere that are supported by Migration Toolkit for Virtualization but do not comply with the 2023 FIPS requirements. Therefore, users should consider whether migrations from vSphere source providers risk their compliance with FIPS. Supported versions of vSphere are specified in <a class="link" href="#compatibility-guidelines_mtv" title="2.9. Software compatibility guidelines">Software compatibility guidelines</a>.
						</p></div></div><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
								It is strongly recommended to create a VMware Virtual Disk Development Kit (VDDK) image in a secure registry that is accessible to all clusters. A VDDK image accelerates migration. For more information, see <a class="link" href="#creating-vddk-image_mtv" title="2.7.1. Creating a VDDK image">Creating a VDDK image</a>.
							</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
								In the Red Hat OpenShift web console, click <span class="strong strong"><strong>Migration</strong></span> → <span class="strong strong"><strong>Providers for virtualization</strong></span>.
							</li><li class="listitem">
								Click <span class="strong strong"><strong>Create Provider</strong></span>.
							</li><li class="listitem">
								Click <span class="strong strong"><strong>vSphere</strong></span>.
							</li><li class="listitem">
								Specify the following fields:
							</li></ol></div><p>
						<span class="strong strong"><strong>Provider Details</strong></span>
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								<span class="strong strong"><strong>Provider resource name</strong></span>: Name of the source provider.
							</li><li class="listitem">
								<span class="strong strong"><strong>Endpoint type</strong></span>: Select the vSphere provider endpoint type. Options: <span class="strong strong"><strong>vCenter</strong></span> or <span class="strong strong"><strong>ESXi</strong></span>. You can migrate virtual machines from vCenter, an ESX/ESXi server that is not managed by vCenter, or from an ESX/ESXi server that is managed by vCenter but does not go through vCenter.
							</li><li class="listitem">
								<span class="strong strong"><strong>URL</strong></span>: URL of the SDK endpoint of the vCenter on which the source VM is mounted. Ensure that the URL includes the <code class="literal">sdk</code> path, usually <code class="literal">/sdk</code>. For example, <code class="literal">https://vCenter-host-example.com/sdk</code>. If a certificate for FQDN is specified, the value of this field needs to match the FQDN in the certificate.
							</li><li class="listitem">
								<span class="strong strong"><strong>VDDK init image</strong></span>: <code class="literal">VDDKInitImage</code> path. It is strongly recommended to create a VDDK init image to accelerate migrations. For more information, see <a class="link" href="#creating-vddk-image_mtv" title="2.7.1. Creating a VDDK image">Creating a VDDK image</a>.
							</li></ul></div><p>
						<span class="strong strong"><strong>Provider details</strong></span>
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								<span class="strong strong"><strong>Username</strong></span>: vCenter user or ESXi user. For example, <code class="literal">user@vsphere.local</code>.
							</li><li class="listitem"><p class="simpara">
								<span class="strong strong"><strong>Password</strong></span>: vCenter user password or ESXi user password.
							</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
										Choose one of the following options for validating CA certificates:
									</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
												<span class="strong strong"><strong>Use a custom CA certificate</strong></span>: Migrate after validating a custom CA certificate.
											</li><li class="listitem">
												<span class="strong strong"><strong>Use the system CA certificate</strong></span>: Migrate after validating the system CA certificate.
											</li><li class="listitem"><p class="simpara">
												<span class="strong strong"><strong>Skip certificate validation</strong></span> : Migrate without validating a CA certificate.
											</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
														To use a custom CA certificate, leave the <span class="strong strong"><strong>Skip certificate validation</strong></span> switch toggled to left, and <span class="emphasis"><em>either</em></span> drag the CA certificate to the text box <span class="emphasis"><em>or</em></span> browse for it and click <span class="strong strong"><strong>Select</strong></span>.
													</li><li class="listitem">
														To use the system CA certificate, leave the <span class="strong strong"><strong>Skip certificate validation</strong></span> switch toggled to the left, and leave the <span class="strong strong"><strong>CA certificate</strong></span> text box empty.
													</li><li class="listitem">
														To skip certificate validation, toggle the <span class="strong strong"><strong>Skip certificate validation</strong></span> switch to the right.
													</li></ol></div></li></ul></div></li><li class="listitem"><p class="simpara">
										Optional: Ask MTV to fetch a custom CA certificate from the provider’s API endpoint URL.
									</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
												Click <span class="strong strong"><strong>Fetch certificate from URL</strong></span>. The <span class="strong strong"><strong>Verify certificate</strong></span> window opens.
											</li><li class="listitem"><p class="simpara">
												If the details are correct, select the <span class="strong strong"><strong>I trust the authenticity of this certificate</strong></span> checkbox, and then, click <span class="strong strong"><strong>Confirm</strong></span>. If not, click <span class="strong strong"><strong>Cancel</strong></span>, and then, enter the correct certificate information manually.
											</p><p class="simpara">
												Once confirmed, the CA certificate will be used to validate subsequent communication with the API endpoint.
											</p></li></ol></div></li><li class="listitem"><p class="simpara">
										Click <span class="strong strong"><strong>Create provider</strong></span> to add and save the provider.
									</p><p class="simpara">
										The provider appears in the list of providers.
									</p></li></ol></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
									It might take a few minutes for the provider to have the status <code class="literal">Ready</code>.
								</p></div></div></li></ul></div><section class="section" id="selecting-migration-network-for-vmware-source-provider_vmware"><div class="titlepage"><div><div><h5 class="title">4.4.1.1.1. Selecting a migration network for a VMware source provider</h5></div></div></div><p>
							You can select a migration network in the Red Hat OpenShift web console for a source provider to reduce risk to the source environment and to improve performance.
						</p><p>
							Using the default network for migration can result in poor performance because the network might not have sufficient bandwidth. This situation can have a negative effect on the source platform because the disk transfer operation might saturate the network.
						</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
								You can also control the network from which disks are transferred from a host by using the Network File Copy (NFC) service in vSphere.
							</p></div></div><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
									The migration network must have sufficient throughput, minimum speed of 10 Gbps, for disk transfer.
								</li><li class="listitem"><p class="simpara">
									The migration network must be accessible to the OpenShift Virtualization nodes through the default gateway.
								</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
										The source virtual disks are copied by a pod that is connected to the pod network of the target namespace.
									</p></div></div></li><li class="listitem">
									The migration network should have jumbo frames enabled.
								</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
									In the Red Hat OpenShift web console, click <span class="strong strong"><strong>Migration</strong></span> → <span class="strong strong"><strong>Providers for virtualization</strong></span>.
								</li><li class="listitem">
									Click the host number in the <span class="strong strong"><strong>Hosts</strong></span> column beside a provider to view a list of hosts.
								</li><li class="listitem">
									Select one or more hosts and click <span class="strong strong"><strong>Select migration network</strong></span>.
								</li><li class="listitem"><p class="simpara">
									Specify the following fields:
								</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
											<span class="strong strong"><strong>Network</strong></span>: Network name
										</li><li class="listitem">
											<span class="strong strong"><strong>ESXi host admin username</strong></span>: For example, <code class="literal">root</code>
										</li><li class="listitem">
											<span class="strong strong"><strong>ESXi host admin password</strong></span>: Password
										</li></ul></div></li><li class="listitem">
									Click <span class="strong strong"><strong>Save</strong></span>.
								</li><li class="listitem"><p class="simpara">
									Verify that the status of each host is <span class="strong strong"><strong>Ready</strong></span>.
								</p><p class="simpara">
									If a host status is not <span class="strong strong"><strong>Ready</strong></span>, the host might be unreachable on the migration network or the credentials might be incorrect. You can modify the host configuration and save the changes.
								</p></li></ol></div></section></section><section class="section" id="adding-source-provider_rhv"><div class="titlepage"><div><div><h4 class="title">4.4.1.2. Adding a Red Hat Virtualization source provider</h4></div></div></div><p>
						You can add a Red Hat Virtualization source provider by using the Red Hat OpenShift web console.
					</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
								Manager CA certificate, unless it was replaced by a third-party certificate, in which case, specify the Manager Apache CA certificate
							</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
								In the Red Hat OpenShift web console, click <span class="strong strong"><strong>Migration</strong></span> → <span class="strong strong"><strong>Providers for virtualization</strong></span>.
							</li><li class="listitem">
								Click <span class="strong strong"><strong>Create Provider</strong></span>.
							</li><li class="listitem">
								Click <span class="strong strong"><strong>Red Hat Virtualization</strong></span>
							</li><li class="listitem"><p class="simpara">
								Specify the following fields:
							</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
										<span class="strong strong"><strong>Provider resource name</strong></span>: Name of the source provider.
									</li><li class="listitem">
										<span class="strong strong"><strong>URL</strong></span>: URL of the API endpoint of the Red Hat Virtualization Manager (RHVM) on which the source VM is mounted. Ensure that the URL includes the path leading to the RHVM API server, usually <code class="literal">/ovirt-engine/api</code>. For example, <code class="literal">https://rhv-host-example.com/ovirt-engine/api</code>.
									</li><li class="listitem">
										<span class="strong strong"><strong>Username</strong></span>: Username.
									</li><li class="listitem">
										<span class="strong strong"><strong>Password</strong></span>: Password.
									</li></ul></div></li><li class="listitem"><p class="simpara">
								Choose one of the following options for validating CA certificates:
							</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
										<span class="strong strong"><strong>Use a custom CA certificate</strong></span>: Migrate after validating a custom CA certificate.
									</li><li class="listitem">
										<span class="strong strong"><strong>Use the system CA certificate</strong></span>: Migrate after validating the system CA certificate.
									</li><li class="listitem"><p class="simpara">
										<span class="strong strong"><strong>Skip certificate validation</strong></span> : Migrate without validating a CA certificate.
									</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
												To use a custom CA certificate, leave the <span class="strong strong"><strong>Skip certificate validation</strong></span> switch toggled to left, and <span class="emphasis"><em>either</em></span> drag the CA certificate to the text box <span class="emphasis"><em>or</em></span> browse for it and click <span class="strong strong"><strong>Select</strong></span>.
											</li><li class="listitem">
												To use the system CA certificate, leave the <span class="strong strong"><strong>Skip certificate validation</strong></span> switch toggled to the left, and leave the <span class="strong strong"><strong>CA certificate</strong></span> text box empty.
											</li><li class="listitem">
												To skip certificate validation, toggle the <span class="strong strong"><strong>Skip certificate validation</strong></span> switch to the right.
											</li></ol></div></li></ul></div></li><li class="listitem"><p class="simpara">
								Optional: Ask MTV to fetch a custom CA certificate from the provider’s API endpoint URL.
							</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
										Click <span class="strong strong"><strong>Fetch certificate from URL</strong></span>. The <span class="strong strong"><strong>Verify certificate</strong></span> window opens.
									</li><li class="listitem"><p class="simpara">
										If the details are correct, select the <span class="strong strong"><strong>I trust the authenticity of this certificate</strong></span> checkbox, and then, click <span class="strong strong"><strong>Confirm</strong></span>. If not, click <span class="strong strong"><strong>Cancel</strong></span>, and then, enter the correct certificate information manually.
									</p><p class="simpara">
										Once confirmed, the CA certificate will be used to validate subsequent communication with the API endpoint.
									</p></li></ol></div></li><li class="listitem"><p class="simpara">
								Click <span class="strong strong"><strong>Create provider</strong></span> to add and save the provider.
							</p><p class="simpara">
								The provider appears in the list of providers.
							</p></li></ol></div></section><section class="section" id="adding-source-provider_ostack"><div class="titlepage"><div><div><h4 class="title">4.4.1.3. Adding an OpenStack source provider</h4></div></div></div><p>
						You can add an OpenStack source provider by using the Red Hat OpenShift web console.
					</p><div class="admonition important"><div class="admonition_header">Important</div><div><p>
							When you migrate an image-based VM from an OpenStack provider, a snapshot is created for the image that is attached to the source VM and the data from the snapshot is copied over to the target VM. This means that the target VM will have the same state as that of the source VM at the time the snapshot was created.
						</p></div></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
								In the Red Hat OpenShift web console, click <span class="strong strong"><strong>Migration</strong></span> → <span class="strong strong"><strong>Providers for virtualization</strong></span>.
							</li><li class="listitem">
								Click <span class="strong strong"><strong>Create Provider</strong></span>.
							</li><li class="listitem">
								Click <span class="strong strong"><strong>OpenStack</strong></span>.
							</li><li class="listitem"><p class="simpara">
								Specify the following fields:
							</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
										<span class="strong strong"><strong>Provider resource name</strong></span>: Name of the source provider.
									</li><li class="listitem">
										<span class="strong strong"><strong>URL</strong></span>: URL of the OpenStack Identity (Keystone) endpoint. For example, <code class="literal">http://controller:5000/v3</code>.
									</li><li class="listitem"><p class="simpara">
										<span class="strong strong"><strong>Authentication type</strong></span>: Choose one of the following methods of authentication and supply the information related to your choice. For example, if you choose <span class="strong strong"><strong>Application credential ID</strong></span> as the authentication type, the <span class="strong strong"><strong>Application credential ID</strong></span> and the <span class="strong strong"><strong>Application credential secret</strong></span> fields become active, and you need to supply the ID and the secret.
									</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem"><p class="simpara">
												<span class="strong strong"><strong>Application credential ID</strong></span>
											</p><div class="itemizedlist"><ul class="itemizedlist" type="square"><li class="listitem">
														<span class="strong strong"><strong>Application credential ID</strong></span>: OpenStack application credential ID
													</li><li class="listitem">
														<span class="strong strong"><strong>Application credential secret</strong></span>: OpenStack <a class="link" href="https://github.com/kubev2v/forklift-documentation/pull/402pplication">https://github.com/kubev2v/forklift-documentation/pull/402pplication</a> credential <code class="literal">Secret</code>
													</li></ul></div></li><li class="listitem"><p class="simpara">
												<span class="strong strong"><strong>Application credential name</strong></span>
											</p><div class="itemizedlist"><ul class="itemizedlist" type="square"><li class="listitem">
														<span class="strong strong"><strong>Application credential name</strong></span>: OpenStack application credential name
													</li><li class="listitem">
														<span class="strong strong"><strong>Application credential secret</strong></span>: : OpenStack application credential <code class="literal">Secret</code>
													</li><li class="listitem">
														<span class="strong strong"><strong>Username</strong></span>: OpenStack username
													</li><li class="listitem">
														<span class="strong strong"><strong>Domain</strong></span>: OpenStack domain name
													</li></ul></div></li><li class="listitem"><p class="simpara">
												<span class="strong strong"><strong>Token with user ID</strong></span>
											</p><div class="itemizedlist"><ul class="itemizedlist" type="square"><li class="listitem">
														<span class="strong strong"><strong>Token</strong></span>: OpenStack token
													</li><li class="listitem">
														<span class="strong strong"><strong>User ID</strong></span>: OpenStack user ID
													</li><li class="listitem">
														<span class="strong strong"><strong>Project ID</strong></span>: OpenStack project ID
													</li></ul></div></li><li class="listitem"><p class="simpara">
												<span class="strong strong"><strong>Token with user Name</strong></span>
											</p><div class="itemizedlist"><ul class="itemizedlist" type="square"><li class="listitem">
														<span class="strong strong"><strong>Token</strong></span>: OpenStack token
													</li><li class="listitem">
														<span class="strong strong"><strong>Username</strong></span>: OpenStack username
													</li><li class="listitem">
														<span class="strong strong"><strong>Project</strong></span>: OpenStack project
													</li><li class="listitem">
														<span class="strong strong"><strong>Domain name</strong></span>: OpenStack domain name
													</li></ul></div></li><li class="listitem"><p class="simpara">
												<span class="strong strong"><strong>Password</strong></span>
											</p><div class="itemizedlist"><ul class="itemizedlist" type="square"><li class="listitem">
														<span class="strong strong"><strong>Username</strong></span>: OpenStack username
													</li><li class="listitem">
														<span class="strong strong"><strong>Password</strong></span>: OpenStack password
													</li><li class="listitem">
														<span class="strong strong"><strong>Project</strong></span>: OpenStack project
													</li><li class="listitem">
														<span class="strong strong"><strong>Domain</strong></span>: OpenStack domain name
													</li></ul></div></li></ul></div></li></ul></div></li><li class="listitem"><p class="simpara">
								Choose one of the following options for validating CA certificates:
							</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
										<span class="strong strong"><strong>Use a custom CA certificate</strong></span>: Migrate after validating a custom CA certificate.
									</li><li class="listitem">
										<span class="strong strong"><strong>Use the system CA certificate</strong></span>: Migrate after validating the system CA certificate.
									</li><li class="listitem"><p class="simpara">
										<span class="strong strong"><strong>Skip certificate validation</strong></span> : Migrate without validating a CA certificate.
									</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
												To use a custom CA certificate, leave the <span class="strong strong"><strong>Skip certificate validation</strong></span> switch toggled to left, and <span class="emphasis"><em>either</em></span> drag the CA certificate to the text box <span class="emphasis"><em>or</em></span> browse for it and click <span class="strong strong"><strong>Select</strong></span>.
											</li><li class="listitem">
												To use the system CA certificate, leave the <span class="strong strong"><strong>Skip certificate validation</strong></span> switch toggled to the left, and leave the <span class="strong strong"><strong>CA certificate</strong></span> text box empty.
											</li><li class="listitem">
												To skip certificate validation, toggle the <span class="strong strong"><strong>Skip certificate validation</strong></span> switch to the right.
											</li></ol></div></li></ul></div></li><li class="listitem"><p class="simpara">
								Optional: Ask MTV to fetch a custom CA certificate from the provider’s API endpoint URL.
							</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
										Click <span class="strong strong"><strong>Fetch certificate from URL</strong></span>. The <span class="strong strong"><strong>Verify certificate</strong></span> window opens.
									</li><li class="listitem"><p class="simpara">
										If the details are correct, select the <span class="strong strong"><strong>I trust the authenticity of this certificate</strong></span> checkbox, and then, click <span class="strong strong"><strong>Confirm</strong></span>. If not, click <span class="strong strong"><strong>Cancel</strong></span>, and then, enter the correct certificate information manually.
									</p><p class="simpara">
										Once confirmed, the CA certificate will be used to validate subsequent communication with the API endpoint.
									</p></li></ol></div></li><li class="listitem"><p class="simpara">
								Click <span class="strong strong"><strong>Create provider</strong></span> to add and save the provider.
							</p><p class="simpara">
								The provider appears in the list of providers.
							</p></li></ol></div></section><section class="section" id="adding-source-provider_ova"><div class="titlepage"><div><div><h4 class="title">4.4.1.4. Adding an Open Virtual Appliance (OVA) source provider</h4></div></div></div><p>
						You can add Open Virtual Appliance (OVA) files that were created by VMware vSphere as a source provider by using the Red Hat OpenShift web console.
					</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
								In the Red Hat OpenShift web console, click <span class="strong strong"><strong>Migration</strong></span> → <span class="strong strong"><strong>Providers for virtualization</strong></span>.
							</li><li class="listitem">
								Click <span class="strong strong"><strong>Create Provider</strong></span>.
							</li><li class="listitem">
								Click <span class="strong strong"><strong>Open Virtual Appliance (OVA)</strong></span>.
							</li><li class="listitem"><p class="simpara">
								Specify the following fields:
							</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
										<span class="strong strong"><strong>Provider resource name</strong></span>: Name of the source provider
									</li><li class="listitem">
										<span class="strong strong"><strong>URL</strong></span>: URL of the NFS file share that serves the OVA
									</li></ul></div></li><li class="listitem"><p class="simpara">
								Click <span class="strong strong"><strong>Create provider</strong></span> to add and save the provider.
							</p><p class="simpara">
								The provider appears in the list of providers.
							</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
									An error message might appear that states that an error has occurred. You can ignore this message.
								</p></div></div></li></ol></div></section><section class="section" id="adding-source-provider_cnv"><div class="titlepage"><div><div><h4 class="title">4.4.1.5. Adding a Red Hat OpenShift Virtualization source provider</h4></div></div></div><p>
						You can use a Red Hat OpenShift Virtualization provider as both a source provider and destination provider.
					</p><p>
						Specifically, the host cluster that is automatically added as a OpenShift Virtualization provider can be used as both a source provider and a destination provider.
					</p><p>
						You can migrate VMs from the cluster that MTV is deployed on to another cluster, or from a remote cluster to the cluster that MTV is deployed on.
					</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
							The Red Hat OpenShift cluster version of the source provider must be 4.13 or later.
						</p></div></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
								In the Red Hat OpenShift web console, click <span class="strong strong"><strong>Migration</strong></span> → <span class="strong strong"><strong>Providers for virtualization</strong></span>.
							</li><li class="listitem">
								Click <span class="strong strong"><strong>Create Provider</strong></span>.
							</li><li class="listitem">
								Click <span class="strong strong"><strong>OpenShift Virtualization</strong></span>.
							</li><li class="listitem"><p class="simpara">
								Specify the following fields:
							</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
										<span class="strong strong"><strong>Provider resource name</strong></span>: Name of the source provider
									</li><li class="listitem">
										<span class="strong strong"><strong>URL</strong></span>: URL of the endpoint of the API server
									</li><li class="listitem"><p class="simpara">
										<span class="strong strong"><strong>Service account bearer token</strong></span>: Token for a service account with <code class="literal">cluster-admin</code> privileges
									</p><p class="simpara">
										If both <span class="strong strong"><strong>URL</strong></span> and <span class="strong strong"><strong>Service account bearer token</strong></span> are left blank, the local OpenShift cluster is used.
									</p></li></ul></div></li><li class="listitem"><p class="simpara">
								Choose one of the following options for validating CA certificates:
							</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
										<span class="strong strong"><strong>Use a custom CA certificate</strong></span>: Migrate after validating a custom CA certificate.
									</li><li class="listitem">
										<span class="strong strong"><strong>Use the system CA certificate</strong></span>: Migrate after validating the system CA certificate.
									</li><li class="listitem"><p class="simpara">
										<span class="strong strong"><strong>Skip certificate validation</strong></span> : Migrate without validating a CA certificate.
									</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
												To use a custom CA certificate, leave the <span class="strong strong"><strong>Skip certificate validation</strong></span> switch toggled to left, and <span class="emphasis"><em>either</em></span> drag the CA certificate to the text box <span class="emphasis"><em>or</em></span> browse for it and click <span class="strong strong"><strong>Select</strong></span>.
											</li><li class="listitem">
												To use the system CA certificate, leave the <span class="strong strong"><strong>Skip certificate validation</strong></span> switch toggled to the left, and leave the <span class="strong strong"><strong>CA certificate</strong></span> text box empty.
											</li><li class="listitem">
												To skip certificate validation, toggle the <span class="strong strong"><strong>Skip certificate validation</strong></span> switch to the right.
											</li></ol></div></li></ul></div></li><li class="listitem"><p class="simpara">
								Optional: Ask MTV to fetch a custom CA certificate from the provider’s API endpoint URL.
							</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
										Click <span class="strong strong"><strong>Fetch certificate from URL</strong></span>. The <span class="strong strong"><strong>Verify certificate</strong></span> window opens.
									</li><li class="listitem"><p class="simpara">
										If the details are correct, select the <span class="strong strong"><strong>I trust the authenticity of this certificate</strong></span> checkbox, and then, click <span class="strong strong"><strong>Confirm</strong></span>. If not, click <span class="strong strong"><strong>Cancel</strong></span>, and then, enter the correct certificate information manually.
									</p><p class="simpara">
										Once confirmed, the CA certificate will be used to validate subsequent communication with the API endpoint.
									</p></li></ol></div></li><li class="listitem"><p class="simpara">
								Click <span class="strong strong"><strong>Create provider</strong></span> to add and save the provider.
							</p><p class="simpara">
								The provider appears in the list of providers.
							</p></li></ol></div></section></section><section class="section" id="adding-destination-providers"><div class="titlepage"><div><div><h3 class="title">4.4.2. Adding destination providers</h3></div></div></div><p>
					You can add a OpenShift Virtualization destination provider by using the Red Hat OpenShift web console.
				</p><section class="section" id="adding-source-provider_cnv2"><div class="titlepage"><div><div><h4 class="title">4.4.2.1. Adding an OpenShift Virtualization destination provider</h4></div></div></div><p>
						You can use a Red Hat OpenShift Virtualization provider as both a source provider and destination provider.
					</p><p>
						Specifically, the host cluster that is automatically added as a OpenShift Virtualization provider can be used as both a source provider and a destination provider.
					</p><p>
						You can also add another OpenShift Virtualization destination provider to the Red Hat OpenShift web console in addition to the default OpenShift Virtualization destination provider, which is the cluster where you installed MTV.
					</p><p>
						You can migrate VMs from the cluster that MTV is deployed on to another cluster, or from a remote cluster to the cluster that MTV is deployed on.
					</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
								You must have an OpenShift Virtualization <a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.14/html/authentication_and_authorization/using-service-accounts">service account token</a> with <code class="literal">cluster-admin</code> privileges.
							</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
								In the Red Hat OpenShift web console, click <span class="strong strong"><strong>Migration</strong></span> → <span class="strong strong"><strong>Providers for virtualization</strong></span>.
							</li><li class="listitem">
								Click <span class="strong strong"><strong>Create Provider</strong></span>.
							</li><li class="listitem">
								Click <span class="strong strong"><strong>OpenShift Virtualization</strong></span>.
							</li><li class="listitem"><p class="simpara">
								Specify the following fields:
							</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
										<span class="strong strong"><strong>Provider resource name</strong></span>: Name of the source provider
									</li><li class="listitem">
										<span class="strong strong"><strong>URL</strong></span>: URL of the endpoint of the API server
									</li><li class="listitem"><p class="simpara">
										<span class="strong strong"><strong>Service account bearer token</strong></span>: Token for a service account with <code class="literal">cluster-admin</code> privileges
									</p><p class="simpara">
										If both <span class="strong strong"><strong>URL</strong></span> and <span class="strong strong"><strong>Service account bearer token</strong></span> are left blank, the local OpenShift cluster is used.
									</p></li></ul></div></li><li class="listitem"><p class="simpara">
								Choose one of the following options for validating CA certificates:
							</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
										<span class="strong strong"><strong>Use a custom CA certificate</strong></span>: Migrate after validating a custom CA certificate.
									</li><li class="listitem">
										<span class="strong strong"><strong>Use the system CA certificate</strong></span>: Migrate after validating the system CA certificate.
									</li><li class="listitem"><p class="simpara">
										<span class="strong strong"><strong>Skip certificate validation</strong></span> : Migrate without validating a CA certificate.
									</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
												To use a custom CA certificate, leave the <span class="strong strong"><strong>Skip certificate validation</strong></span> switch toggled to left, and <span class="emphasis"><em>either</em></span> drag the CA certificate to the text box <span class="emphasis"><em>or</em></span> browse for it and click <span class="strong strong"><strong>Select</strong></span>.
											</li><li class="listitem">
												To use the system CA certificate, leave the <span class="strong strong"><strong>Skip certificate validation</strong></span> switch toggled to the left, and leave the <span class="strong strong"><strong>CA certificate</strong></span> text box empty.
											</li><li class="listitem">
												To skip certificate validation, toggle the <span class="strong strong"><strong>Skip certificate validation</strong></span> switch to the right.
											</li></ol></div></li></ul></div></li><li class="listitem"><p class="simpara">
								Optional: Ask MTV to fetch a custom CA certificate from the provider’s API endpoint URL.
							</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
										Click <span class="strong strong"><strong>Fetch certificate from URL</strong></span>. The <span class="strong strong"><strong>Verify certificate</strong></span> window opens.
									</li><li class="listitem"><p class="simpara">
										If the details are correct, select the <span class="strong strong"><strong>I trust the authenticity of this certificate</strong></span> checkbox, and then, click <span class="strong strong"><strong>Confirm</strong></span>. If not, click <span class="strong strong"><strong>Cancel</strong></span>, and then, enter the correct certificate information manually.
									</p><p class="simpara">
										Once confirmed, the CA certificate will be used to validate subsequent communication with the API endpoint.
									</p></li></ol></div></li><li class="listitem"><p class="simpara">
								Click <span class="strong strong"><strong>Create provider</strong></span> to add and save the provider.
							</p><p class="simpara">
								The provider appears in the list of providers.
							</p></li></ol></div></section><section class="section" id="selecting-migration-network-for-virt-provider_mtv"><div class="titlepage"><div><div><h4 class="title">4.4.2.2. Selecting a migration network for an OpenShift Virtualization provider</h4></div></div></div><p>
						You can select a default migration network for an OpenShift Virtualization provider in the Red Hat OpenShift web console to improve performance. The default migration network is used to transfer disks to the namespaces in which it is configured.
					</p><p>
						If you do not select a migration network, the default migration network is the <code class="literal">pod</code> network, which might not be optimal for disk transfer.
					</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
							You can override the default migration network of the provider by selecting a different network when you create a migration plan.
						</p></div></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
								In the Red Hat OpenShift web console, click <span class="strong strong"><strong>Migration</strong></span> → <span class="strong strong"><strong>Providers for virtualization</strong></span>.
							</li><li class="listitem">
								On the right side of the provider, select <span class="strong strong"><strong>Select migration network</strong></span> from the Options menu 
								<span class="inlinemediaobject"><img src="images/modules/images/kebab.png" height="20" alt="kebab"/></span>
								.
							</li><li class="listitem">
								Select a network from the list of available networks and click <span class="strong strong"><strong>Select</strong></span>.
							</li></ol></div></section></section></section><section class="section" id="creating-migration-plans-ui"><div class="titlepage"><div><div><h2 class="title">4.5. Creating migration plans</h2></div></div></div><p>
				You can create a migration plan by using the Red Hat OpenShift web console to specify a source provider, the virtual machines (VMs) you want to migrate, and other plan details.
			</p><p>
				For your convenience, there are two procedures to create migration plans, starting with either a source provider or with specific VMs:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						To start with a source provider, see <a class="link" href="#creating-migration-plan-2-6-3_provider" title="4.5.1. Creating a migration plan starting with a source provider">Creating a migration plan starting with a source provider</a>.
					</li><li class="listitem">
						To start with specific VMs, see <a class="link" href="#creating-migration-plan-2-6-3_vms" title="4.5.2. Creating a migration plan starting with specific VMs">Creating a migration plan starting with specific VMs</a>.
					</li></ul></div><div class="admonition warning"><div class="admonition_header">Warning</div><div><p>
					Virtual machines with guest initiated storage connections, such as Internet Small Computer Systems Interface (iSCSI) connections or Network File System (NFS) mounts, are not handled by MTV and could require additional planning before or reconfiguration after the migration.
				</p><p>
					This is to ensure that no issues arise due to the addition or newly migrated VM accessing this storage.
				</p></div></div><section class="section" id="creating-migration-plan-2-6-3_provider"><div class="titlepage"><div><div><h3 class="title">4.5.1. Creating a migration plan starting with a source provider</h3></div></div></div><p>
					You can create a migration plan based on a source provider, starting on the <span class="strong strong"><strong>Plans for virtualization</strong></span> page. Note the specific options for migrations from VMware or RHV providers.
				</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							In the Red Hat OpenShift web console, click <span class="strong strong"><strong>Plans for virtualization</strong></span> and then click <span class="strong strong"><strong>Create Plan</strong></span>.
						</p><p class="simpara">
							The <span class="strong strong"><strong>Create migration plan</strong></span> wizard opens to the <span class="strong strong"><strong>Select source provider</strong></span> interface.
						</p></li><li class="listitem"><p class="simpara">
							Select the source provider of the VMs you want to migrate.
						</p><p class="simpara">
							The <span class="strong strong"><strong>Select virtual machines</strong></span> interface opens.
						</p></li><li class="listitem"><p class="simpara">
							Select the VMs you want to migrate and click <span class="strong strong"><strong>Next</strong></span>.
						</p><p class="simpara">
							The <span class="strong strong"><strong>Create migration plan</strong></span> pane opens. It displays the source provider’s name and suggestions for a target provider and namespace, a network map, and a storage map.
						</p></li><li class="listitem">
							Enter the <span class="strong strong"><strong>Plan name</strong></span>.
						</li><li class="listitem">
							Make any needed changes to the editable items.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Add mapping</strong></span> to edit a suggested network mapping or a storage mapping, or to add one or more additional mappings.
						</li><li class="listitem"><p class="simpara">
							Click <span class="strong strong"><strong>Create migration plan</strong></span>.
						</p><p class="simpara">
							MTV validates the migration plan and the <span class="strong strong"><strong>Plan details</strong></span> page opens, indicating whether the plan is ready for use or contains an error. The details of the plan are listed, and you can edit the items you filled in on the previous page. If you make any changes, MTV validates the plan again.
						</p></li><li class="listitem"><p class="simpara">
							VMware source providers only (All optional):
						</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
									<span class="strong strong"><strong>Preserving static IPs of VMs</strong></span>: By default, virtual network interface controllers (vNICs) change during the migration process. This results in vNICs that are set with a static IP in vSphere losing their IP. To avoid this by preserving static IPs of VMs, click the Edit icon next to <span class="strong strong"><strong>Preserve static IPs</strong></span> and toggle the <span class="strong strong"><strong>Whether to preserve the static IPs</strong></span> switch in the window that opens. Then click <span class="strong strong"><strong>Save</strong></span>.
								</p><p class="simpara">
									MTV then issues a warning message about any VMs with a Windows operating system for which vNIC properties are missing. To retrieve any missing vNIC properties, run those VMs in vSphere in order for the vNIC properties to be reported to MTV.
								</p></li><li class="listitem">
									<span class="strong strong"><strong>Entering a list of decryption passphrases for disks encrypted using Linux Unified Key Setup (LUKS)</strong></span>: To enter a list of decryption passphrases for LUKS-encrypted devices, in the <span class="strong strong"><strong>Settings</strong></span> section, click the Edit icon next to <span class="strong strong"><strong>Disk decryption passphrases</strong></span>, enter the passphrases, and then click <span class="strong strong"><strong>Save</strong></span>. You do not need to enter the passphrases in a specific order - for each LUKS-encrypted device, MTV tries each passphrase until one unlocks the device.
								</li><li class="listitem"><p class="simpara">
									<span class="strong strong"><strong>Specifying a root device</strong></span>: Applies to multi-boot VM migrations only. By default, MTV uses the first bootable device detected as the root device.
								</p><p class="simpara">
									To specify a different root device, in the <span class="strong strong"><strong>Settings</strong></span> section, click the Edit icon next to <span class="strong strong"><strong>Root device</strong></span> and choose a device from the list of commonly-used options, or enter a device in the text box.
								</p><p class="simpara">
									MTV uses the following format for disk location: <code class="literal">/dev/sd&lt;disk_identifier&gt;&lt;disk_partition&gt;</code>. For example, if the second disk is the root device and the operating system is on the disk’s second partition, the format would be: <code class="literal">/dev/sdb2</code>. After you enter the boot device, click <span class="strong strong"><strong>Save</strong></span>.
								</p><p class="simpara">
									If the conversion fails because the boot device provided is incorrect, it is possible to get the correct information by looking at the conversion pod logs.
								</p></li></ul></div></li><li class="listitem"><p class="simpara">
							RHV source providers only (Optional):
						</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
									<span class="strong strong"><strong>Preserving the CPU model of VMs that are migrated from RHV</strong></span>: Generally, the CPU model (type) for RHV VMs is set at the cluster level, but it can be set at the VM level, which is called a custom CPU model. By default, MTV sets the CPU model on the destination cluster as follows: MTV preserves custom CPU settings for VMs that have them, but, for VMs without custom CPU settings, MTV does not set the CPU model. Instead, the CPU model is later set by OpenShift Virtualization.
								</p><p class="simpara">
									To preserve the cluster-level CPU model of your RHV VMs, in the <span class="strong strong"><strong>Settings</strong></span> section, click the Edit icon next to <span class="strong strong"><strong>Preserve CPU model</strong></span>. Toggle the <span class="strong strong"><strong>Whether to preserve the CPU model</strong></span> switch, and then click <span class="strong strong"><strong>Save</strong></span>.
								</p></li></ul></div></li><li class="listitem"><p class="simpara">
							If the plan is valid,
						</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
									You can run the plan now by clicking <span class="strong strong"><strong>Start migration</strong></span>.
								</li><li class="listitem">
									You can run the plan later by selecting it on the <span class="strong strong"><strong>Plans for virtualization</strong></span> page and following the procedure in <a class="link" href="#running-migration-plan_mtv" title="4.6. Running a migration plan">Running a migration plan</a>.
								</li></ol></div></li></ol></div></section><section class="section" id="creating-migration-plan-2-6-3_vms"><div class="titlepage"><div><div><h3 class="title">4.5.2. Creating a migration plan starting with specific VMs</h3></div></div></div><p>
					You can create a migration plan based on specific VMs, starting on the <span class="strong strong"><strong>Providers for virtualization</strong></span> page. Note the specific options for migrations from VMware or RHV providers.
				</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
							In the Red Hat OpenShift web console, click <span class="strong strong"><strong>Providers for virtualization</strong></span>.
						</li><li class="listitem"><p class="simpara">
							In the row of the appropriate source provider, click <span class="strong strong"><strong>VMs</strong></span>.
						</p><p class="simpara">
							The <span class="strong strong"><strong>Virtual Machines</strong></span> tab opens.
						</p></li><li class="listitem"><p class="simpara">
							Select the VMs you want to migrate and click <span class="strong strong"><strong>Create migration plan</strong></span>.
						</p><p class="simpara">
							The <span class="strong strong"><strong>Create migration plan</strong></span> pane opens. It displays the source provider’s name and suggestions for a target provider and namespace, a network map, and a storage map.
						</p></li><li class="listitem">
							Enter the <span class="strong strong"><strong>Plan name</strong></span>.
						</li><li class="listitem">
							Make any needed changes to the editable items.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Add mapping</strong></span> to edit a suggested network mapping or a storage mapping, or to add one or more additional mappings.
						</li><li class="listitem"><p class="simpara">
							Click <span class="strong strong"><strong>Create migration plan</strong></span>.
						</p><p class="simpara">
							MTV validates the migration plan and the <span class="strong strong"><strong>Plan details</strong></span> page opens, indicating whether the plan is ready for use or contains an error. The details of the plan are listed, and you can edit the items you filled in on the previous page. If you make any changes, MTV validates the plan again.
						</p></li><li class="listitem"><p class="simpara">
							VMware source providers only (All optional):
						</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
									<span class="strong strong"><strong>Preserving static IPs of VMs</strong></span>: By default, virtual network interface controllers (vNICs) change during the migration process. This results in vNICs that are set with a static IP in vSphere losing their IP. To avoid this by preserving static IPs of VMs, click the Edit icon next to <span class="strong strong"><strong>Preserve static IPs</strong></span> and toggle the <span class="strong strong"><strong>Whether to preserve the static IPs</strong></span> switch in the window that opens. Then click <span class="strong strong"><strong>Save</strong></span>.
								</p><p class="simpara">
									MTV then issues a warning message about any VMs with a Windows operating system for which vNIC properties are missing. To retrieve any missing vNIC properties, run those VMs in vSphere in order for the vNIC properties to be reported to MTV.
								</p></li><li class="listitem">
									<span class="strong strong"><strong>Entering a list of decryption passphrases for disks encrypted using Linux Unified Key Setup (LUKS)</strong></span>: To enter a list of decryption passphrases for LUKS-encrypted devices, in the <span class="strong strong"><strong>Settings</strong></span> section, click the Edit icon next to <span class="strong strong"><strong>Disk decryption passphrases</strong></span>, enter the passphrases, and then click <span class="strong strong"><strong>Save</strong></span>. You do not need to enter the passphrases in a specific order - for each LUKS-encrypted device, MTV tries each passphrase until one unlocks the device.
								</li><li class="listitem"><p class="simpara">
									<span class="strong strong"><strong>Specifying a root device</strong></span>: Applies to multi-boot VM migrations only. By default, MTV uses the first bootable device detected as the root device.
								</p><p class="simpara">
									To specify a different root device, in the <span class="strong strong"><strong>Settings</strong></span> section, click the Edit icon next to <span class="strong strong"><strong>Root device</strong></span> and choose a device from the list of commonly-used options, or enter a device in the text box.
								</p><p class="simpara">
									MTV uses the following format for disk location: <code class="literal">/dev/sd&lt;disk_identifier&gt;&lt;disk_partition&gt;</code>. For example, if the second disk is the root device and the operating system is on the disk’s second partition, the format would be: <code class="literal">/dev/sdb2</code>. After you enter the boot device, click <span class="strong strong"><strong>Save</strong></span>.
								</p><p class="simpara">
									If the conversion fails because the boot device provided is incorrect, it is possible to get the correct information by looking at the conversion pod logs.
								</p></li></ul></div></li><li class="listitem"><p class="simpara">
							RHV source providers only (Optional):
						</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
									<span class="strong strong"><strong>Preserving the CPU model of VMs that are migrated from RHV</strong></span>: Generally, the CPU model (type) for RHV VMs is set at the cluster level, but it can be set at the VM level, which is called a custom CPU model. By default, MTV sets the CPU model on the destination cluster as follows: MTV preserves custom CPU settings for VMs that have them, but, for VMs without custom CPU settings, MTV does not set the CPU model. Instead, the CPU model is later set by OpenShift Virtualization.
								</p><p class="simpara">
									To preserve the cluster-level CPU model of your RHV VMs, in the <span class="strong strong"><strong>Settings</strong></span> section, click the Edit icon next to <span class="strong strong"><strong>Preserve CPU model</strong></span>. Toggle the <span class="strong strong"><strong>Whether to preserve the CPU model</strong></span> switch, and then click <span class="strong strong"><strong>Save</strong></span>.
								</p></li></ul></div></li><li class="listitem"><p class="simpara">
							If the plan is valid,
						</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
									You can run the plan now by clicking <span class="strong strong"><strong>Start migration</strong></span>.
								</li><li class="listitem">
									You can run the plan later by selecting it on the <span class="strong strong"><strong>Plans for virtualization</strong></span> page and following the procedure in <a class="link" href="#running-migration-plan_mtv" title="4.6. Running a migration plan">Running a migration plan</a>.
								</li></ol></div></li></ol></div></section></section><section class="section" id="running-migration-plan_mtv"><div class="titlepage"><div><div><h2 class="title">4.6. Running a migration plan</h2></div></div></div><p>
				You can run a migration plan and view its progress in the Red Hat OpenShift web console.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						Valid migration plan.
					</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						In the Red Hat OpenShift web console, click <span class="strong strong"><strong>Migration</strong></span> → <span class="strong strong"><strong>Plans for virtualization</strong></span>.
					</p><p class="simpara">
						The <span class="strong strong"><strong>Plans</strong></span> list displays the source and target providers, the number of virtual machines (VMs) being migrated, the status, and the description of each plan.
					</p></li><li class="listitem">
						Click <span class="strong strong"><strong>Start</strong></span> beside a migration plan to start the migration.
					</li><li class="listitem"><p class="simpara">
						Click <span class="strong strong"><strong>Start</strong></span> in the confirmation window that opens.
					</p><p class="simpara">
						The <span class="strong strong"><strong>Migration details by VM</strong></span> screen opens, displaying the migration’s progress
					</p><p class="simpara">
						Warm migration only:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								The precopy stage starts.
							</li><li class="listitem">
								Click <span class="strong strong"><strong>Cutover</strong></span> to complete the migration.
							</li></ul></div></li><li class="listitem"><p class="simpara">
						If the migration fails:
					</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
								Click <span class="strong strong"><strong>Get logs</strong></span> to retrieve the migration logs.
							</li><li class="listitem">
								Click <span class="strong strong"><strong>Get logs</strong></span> in the confirmation window that opens.
							</li><li class="listitem">
								Wait until <span class="strong strong"><strong>Get logs</strong></span> changes to <span class="strong strong"><strong>Download logs</strong></span> and then click the button to download the logs.
							</li></ol></div></li><li class="listitem"><p class="simpara">
						Click a migration’s <span class="strong strong"><strong>Status</strong></span>, whether it failed or succeeded or is still ongoing, to view the details of the migration.
					</p><p class="simpara">
						The <span class="strong strong"><strong>Migration details by VM</strong></span> screen opens, displaying the start and end times of the migration, the amount of data copied, and a progress pipeline for each VM being migrated.
					</p></li><li class="listitem">
						Expand an individual VM to view its steps and the elapsed time and state of each step.
					</li></ol></div></section><section class="section" id="migration-plan-options-ui_mtv"><div class="titlepage"><div><div><h2 class="title">4.7. Migration plan options</h2></div></div></div><p>
				On the <span class="strong strong"><strong>Plans for virtualization</strong></span> page of the Red Hat OpenShift web console, you can click the Options menu 
				<span class="inlinemediaobject"><img src="images/modules/images/kebab.png" height="20" alt="kebab"/></span>
				 beside a migration plan to access the following options:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						<span class="strong strong"><strong>Get logs</strong></span>: Retrieves the logs of a migration. When you click <span class="strong strong"><strong>Get logs</strong></span>, a confirmation window opens. After you click <span class="strong strong"><strong>Get logs</strong></span> in the window, wait until <span class="strong strong"><strong>Get logs</strong></span> changes to <span class="strong strong"><strong>Download logs</strong></span> and then click the button to download the logs.
					</li><li class="listitem">
						<span class="strong strong"><strong>Edit</strong></span>: Edit the details of a migration plan. You cannot edit a migration plan while it is running or after it has completed successfully.
					</li><li class="listitem"><p class="simpara">
						<span class="strong strong"><strong>Duplicate</strong></span>: Create a new migration plan with the same virtual machines (VMs), parameters, mappings, and hooks as an existing plan. You can use this feature for the following tasks:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
								Migrate VMs to a different namespace.
							</li><li class="listitem">
								Edit an archived migration plan.
							</li><li class="listitem">
								Edit a migration plan with a different status, for example, failed, canceled, running, critical, or ready.
							</li></ul></div></li><li class="listitem"><p class="simpara">
						<span class="strong strong"><strong>Archive</strong></span>: Delete the logs, history, and metadata of a migration plan. The plan cannot be edited or restarted. It can only be viewed.
					</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
							The <span class="strong strong"><strong>Archive</strong></span> option is irreversible. However, you can duplicate an archived plan.
						</p></div></div></li><li class="listitem"><p class="simpara">
						<span class="strong strong"><strong>Delete</strong></span>: Permanently remove a migration plan. You cannot delete a running migration plan.
					</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
							The <span class="strong strong"><strong>Delete</strong></span> option is irreversible.
						</p><p>
							Deleting a migration plan does not remove temporary resources such as <code class="literal">importer</code> pods, <code class="literal">conversion</code> pods, config maps, secrets, failed VMs, and data volumes. (<a class="link" href="https://bugzilla.redhat.com/show_bug.cgi?id=2018974"><span class="strong strong"><strong>BZ#2018974</strong></span></a>) You must archive a migration plan before deleting it in order to clean up the temporary resources.
						</p></div></div></li><li class="listitem">
						<span class="strong strong"><strong>View details</strong></span>: Display the details of a migration plan.
					</li><li class="listitem">
						<span class="strong strong"><strong>Restart</strong></span>: Restart a failed or canceled migration plan.
					</li><li class="listitem">
						<span class="strong strong"><strong>Cancel scheduled cutover</strong></span>: Cancel a scheduled cutover migration for a warm migration plan.
					</li></ul></div></section><section class="section" id="canceling-migration-ui_mtv"><div class="titlepage"><div><div><h2 class="title">4.8. Canceling a migration</h2></div></div></div><p>
				You can cancel the migration of some or all virtual machines (VMs) while a migration plan is in progress by using the Red Hat OpenShift web console.
			</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
						In the Red Hat OpenShift web console, click <span class="strong strong"><strong>Plans for virtualization</strong></span>.
					</li><li class="listitem">
						Click the name of a running migration plan to view the migration details.
					</li><li class="listitem">
						Select one or more VMs and click <span class="strong strong"><strong>Cancel</strong></span>.
					</li><li class="listitem"><p class="simpara">
						Click <span class="strong strong"><strong>Yes, cancel</strong></span> to confirm the cancellation.
					</p><p class="simpara">
						In the <span class="strong strong"><strong>Migration details by VM</strong></span> list, the status of the canceled VMs is <span class="strong strong"><strong>Canceled</strong></span>. The unmigrated and the migrated virtual machines are not affected.
					</p></li></ol></div><p>
				You can restart a canceled migration by clicking <span class="strong strong"><strong>Restart</strong></span> beside the migration plan on the <span class="strong strong"><strong>Migration plans</strong></span> page.
			</p></section></section><section class="chapter" id="migrating-virtual-machines-from-the-command-line_mtv"><div class="titlepage"><div><div><h1 class="title">Chapter 5. Migrating virtual machines from the command line</h1></div></div></div><p>
			You can migrate virtual machines to OpenShift Virtualization from the command line.
		</p><div class="admonition important"><div class="admonition_header">Important</div><div><p>
				You must ensure that all <a class="link" href="#prerequisites_mtv" title="Chapter 2. Prerequisites">prerequisites</a> are met.
			</p></div></div><section class="section" id="non-admin-permissions_cli"><div class="titlepage"><div><div><h2 class="title">5.1. Permissions needed by non-administrators to work with migration plan components</h2></div></div></div><p>
				If you are an administrator, you can work with all components of migration plans (for example, providers, network mappings, and migration plans).
			</p><p>
				By default, non-administrators have limited ability to work with migration plans and their components. As an administrator, you can modify their roles to allow them full access to all components, or you can give them limited permissions.
			</p><p>
				For example, administrators can assign non-administrators one or more of the following cluster roles for migration plans:
			</p><div class="table" id="idm45442632380864"><p class="title"><strong>Table 5.1. Example migration plan roles and their privileges</strong></p><div class="table-contents"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 50%; " class="col_1"/><col style="width: 50%; " class="col_2"/></colgroup><thead><tr><th align="left" valign="top" id="idm45442632376000" scope="col">Role</th><th align="left" valign="top" id="idm45442632374912" scope="col">Description</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm45442632376000">
							<p>
								<code class="literal">plans.forklift.konveyor.io-v1beta1-view</code>
							</p>
							</td><td align="left" valign="top" headers="idm45442632374912">
							<p>
								Can view migration plans but not to create, delete or modify them
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm45442632376000">
							<p>
								<code class="literal">plans.forklift.konveyor.io-v1beta1-edit</code>
							</p>
							</td><td align="left" valign="top" headers="idm45442632374912">
							<p>
								Can create, delete or modify (all parts of <code class="literal">edit</code> permissions) individual migration plans
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm45442632376000">
							<p>
								<code class="literal">plans.forklift.konveyor.io-v1beta1-admin</code>
							</p>
							</td><td align="left" valign="top" headers="idm45442632374912">
							<p>
								All <code class="literal">edit</code> privileges and the ability to delete the entire collection of migration plans
							</p>
							</td></tr></tbody></table></div></div><p>
				Note that pre-defined cluster roles include a resource (for example, <code class="literal">plans</code>), an API group (for example, <code class="literal">forklift.konveyor.io-v1beta1</code>) and an action (for example, <code class="literal">view</code>, <code class="literal">edit</code>).
			</p><p>
				As a more comprehensive example, you can grant non-administrators the following set of permissions per namespace:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						Create and modify storage maps, network maps, and migration plans for the namespaces they have access to
					</li><li class="listitem">
						Attach providers created by administrators to storage maps, network maps, and migration plans
					</li><li class="listitem">
						Not be able to create providers or to change system settings
					</li></ul></div><div class="table" id="idm45442636941680"><p class="title"><strong>Table 5.2. Example permissions required for non-adminstrators to work with migration plan components but not create providers</strong></p><div class="table-contents"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 33%; " class="col_1"/><col style="width: 33%; " class="col_2"/><col style="width: 33%; " class="col_3"/></colgroup><thead><tr><th align="left" valign="top" id="idm45442636935824" scope="col">Actions</th><th align="left" valign="top" id="idm45442636934736" scope="col">API group</th><th align="left" valign="top" id="idm45442636933648" scope="col">Resource</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm45442636935824">
							<p>
								<code class="literal">get</code>, <code class="literal">list</code>, <code class="literal">watch</code>, <code class="literal">create</code>, <code class="literal">update</code>, <code class="literal">patch</code>, <code class="literal">delete</code>
							</p>
							</td><td align="left" valign="top" headers="idm45442636934736">
							<p>
								<code class="literal">forklift.konveyor.io</code>
							</p>
							</td><td align="left" valign="top" headers="idm45442636933648">
							<p>
								<code class="literal">plans</code>
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm45442636935824">
							<p>
								<code class="literal">get</code>, <code class="literal">list</code>, <code class="literal">watch</code>, <code class="literal">create</code>, <code class="literal">update</code>, <code class="literal">patch</code>, <code class="literal">delete</code>
							</p>
							</td><td align="left" valign="top" headers="idm45442636934736">
							<p>
								<code class="literal">forklift.konveyor.io</code>
							</p>
							</td><td align="left" valign="top" headers="idm45442636933648">
							<p>
								<code class="literal">migrations</code>
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm45442636935824">
							<p>
								<code class="literal">get</code>, <code class="literal">list</code>, <code class="literal">watch</code>, <code class="literal">create</code>, <code class="literal">update</code>, <code class="literal">patch</code>, <code class="literal">delete</code>
							</p>
							</td><td align="left" valign="top" headers="idm45442636934736">
							<p>
								<code class="literal">forklift.konveyor.io</code>
							</p>
							</td><td align="left" valign="top" headers="idm45442636933648">
							<p>
								<code class="literal">hooks</code>
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm45442636935824">
							<p>
								<code class="literal">get</code>, <code class="literal">list</code>, <code class="literal">watch</code>
							</p>
							</td><td align="left" valign="top" headers="idm45442636934736">
							<p>
								<code class="literal">forklift.konveyor.io</code>
							</p>
							</td><td align="left" valign="top" headers="idm45442636933648">
							<p>
								<code class="literal">providers</code>
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm45442636935824">
							<p>
								<code class="literal">get</code>, <code class="literal">list</code>, <code class="literal">watch</code>, <code class="literal">create</code>, <code class="literal">update</code>, <code class="literal">patch</code>, <code class="literal">delete</code>
							</p>
							</td><td align="left" valign="top" headers="idm45442636934736">
							<p>
								<code class="literal">forklift.konveyor.io</code>
							</p>
							</td><td align="left" valign="top" headers="idm45442636933648">
							<p>
								<code class="literal">networkmaps</code>
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm45442636935824">
							<p>
								<code class="literal">get</code>, <code class="literal">list</code>, <code class="literal">watch</code>, <code class="literal">create</code>, <code class="literal">update</code>, <code class="literal">patch</code>, <code class="literal">delete</code>
							</p>
							</td><td align="left" valign="top" headers="idm45442636934736">
							<p>
								<code class="literal">forklift.konveyor.io</code>
							</p>
							</td><td align="left" valign="top" headers="idm45442636933648">
							<p>
								<code class="literal">storagemaps</code>
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm45442636935824">
							<p>
								<code class="literal">get</code>, <code class="literal">list</code>, <code class="literal">watch</code>
							</p>
							</td><td align="left" valign="top" headers="idm45442636934736">
							<p>
								<code class="literal">forklift.konveyor.io</code>
							</p>
							</td><td align="left" valign="top" headers="idm45442636933648">
							<p>
								<code class="literal">forkliftcontrollers</code>
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm45442636935824">
							<p>
								<code class="literal">create</code>, <code class="literal">patch</code>, <code class="literal">delete</code>
							</p>
							</td><td align="left" valign="top" headers="idm45442636934736">
							<p>
								Empty string
							</p>
							</td><td align="left" valign="top" headers="idm45442636933648">
							<p>
								<code class="literal">secrets</code>
							</p>
							</td></tr></tbody></table></div></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					Non-administrators need to have the <code class="literal">create</code> permissions that are part of <code class="literal">edit</code> roles for network maps and for storage maps to create migration plans, even when using a template for a network map or a storage map.
				</p></div></div></section><section class="section" id="retrieving-vmware-moref_mtv"><div class="titlepage"><div><div><h2 class="title">5.2. Retrieving a VMware vSphere moRef</h2></div></div></div><p>
				When you migrate VMs with a VMware vSphere source provider using Migration Toolkit for Virtualization (MTV) from the CLI, you need to know the managed object reference (moRef) of certain entities in vSphere, such as datastores, networks, and VMs.
			</p><p>
				You can retrieve the moRef of one or more vSphere entities from the Inventory service. You can then use each moRef as a reference for retrieving the moRef of another entity.
			</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Retrieve the routes for the project:
					</p><pre class="programlisting language-terminal">oc get route -n openshift-mtv</pre></li><li class="listitem"><p class="simpara">
						Retrieve the <code class="literal">Inventory</code> service route:
					</p><pre class="programlisting language-terminal">$ oc get route &lt;inventory_service&gt; -n openshift-mtv</pre></li><li class="listitem"><p class="simpara">
						Retrieve the access token:
					</p><pre class="programlisting language-terminal">$ TOKEN=$(oc whoami -t)</pre></li><li class="listitem"><p class="simpara">
						Retrieve the moRef of a VMware vSphere provider:
					</p><pre class="programlisting language-terminal">$ curl -H "Authorization: Bearer $TOKEN"  https://&lt;inventory_service_route&gt;/providers/vsphere -k</pre></li><li class="listitem"><p class="simpara">
						Retrieve the datastores of a VMware vSphere source provider:
					</p><pre class="programlisting language-terminal">$ curl -H "Authorization: Bearer $TOKEN"  https://&lt;inventory_service_route&gt;/providers/vsphere/&lt;provider id&gt;/datastores/ -k</pre><div class="formalpara"><p class="title"><strong>Example output</strong></p><p>
							
<pre class="programlisting language-terminal">[
  {
    "id": "datastore-11",
    "parent": {
      "kind": "Folder",
      "id": "group-s5"
    },
    "path": "/Datacenter/datastore/v2v_general_porpuse_ISCSI_DC",
    "revision": 46,
    "name": "v2v_general_porpuse_ISCSI_DC",
    "selfLink": "providers/vsphere/01278af6-e1e4-4799-b01b-d5ccc8dd0201/datastores/datastore-11"
  },
  {
    "id": "datastore-730",
    "parent": {
      "kind": "Folder",
      "id": "group-s5"
    },
    "path": "/Datacenter/datastore/f01-h27-640-SSD_2",
    "revision": 46,
    "name": "f01-h27-640-SSD_2",
    "selfLink": "providers/vsphere/01278af6-e1e4-4799-b01b-d5ccc8dd0201/datastores/datastore-730"
  },
 ...</pre>
						</p></div></li></ol></div><p>
				In this example, the moRef of the datastore <code class="literal">v2v_general_porpuse_ISCSI_DC</code> is <code class="literal">datastore-11</code> and the moRef of the datastore <code class="literal">f01-h27-640-SSD_2</code> is <code class="literal">datastore-730</code>.
			</p></section><section class="section" id="migrating-virtual-machines_mtv"><div class="titlepage"><div><div><h2 class="title">5.3. Migrating virtual machines</h2></div></div></div><p>
				You migrate virtual machines (VMs) from the command line (CLI) by creating MTV custom resources (CRs). The CRs and the migration procedure vary by source provider.
			</p><div class="admonition important"><div class="admonition_header">Important</div><div><p>
					You must specify a name for cluster-scoped CRs.
				</p><p>
					You must specify both a name and a namespace for namespace-scoped CRs.
				</p><p>
					To migrate to or from an OpenShift cluster that is different from the one the migration plan is defined on, you must have an OpenShift Virtualization service account token with <code class="literal">cluster-admin</code> privileges.
				</p></div></div><section class="section" id="new-migrating-virtual-machines-cli_vmware"><div class="titlepage"><div><div><h3 class="title">5.3.1. Migrating from a VMware vSphere source provider</h3></div></div></div><p>
					You can migrate from a VMware vSphere source provider by using the CLI.
				</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Create a <code class="literal">Secret</code> manifest for the source provider credentials:
						</p><pre class="programlisting language-yaml">$ cat &lt;&lt; EOF | oc apply -f -
apiVersion: v1
kind: Secret
metadata:
  name: &lt;secret&gt;
  namespace: &lt;namespace&gt;
  ownerReferences: <span id="CO2-1"/><span class="callout">1</span>
    - apiVersion: forklift.konveyor.io/v1beta1
      kind: Provider
      name: &lt;provider_name&gt;
      uid: &lt;provider_uid&gt;
  labels:
    createdForProviderType: vsphere
    createdForResourceType: providers
type: Opaque
stringData:
  user: &lt;user&gt; <span id="CO2-2"/><span class="callout">2</span>
  password: &lt;password&gt; <span id="CO2-3"/><span class="callout">3</span>
  insecureSkipVerify: &lt;"true"/"false"&gt; <span id="CO2-4"/><span class="callout">4</span>
  cacert: | <span id="CO2-5"/><span class="callout">5</span>
    &lt;ca_certificate&gt;
  url: &lt;api_end_point&gt; <span id="CO2-6"/><span class="callout">6</span>
EOF</pre><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO2-1"><span class="callout">1</span></a> </dt><dd><div class="para">
									The <code class="literal">ownerReferences</code> section is optional.
								</div></dd><dt><a href="#CO2-2"><span class="callout">2</span></a> </dt><dd><div class="para">
									Specify the vCenter user or the ESX/ESXi user.
								</div></dd><dt><a href="#CO2-3"><span class="callout">3</span></a> </dt><dd><div class="para">
									Specify the password of the vCenter user or the ESX/ESXi user.
								</div></dd><dt><a href="#CO2-4"><span class="callout">4</span></a> </dt><dd><div class="para">
									Specify <code class="literal">"true"</code> to skip certificate verification, specify <code class="literal">"false"</code> to verify the certificate. Defaults to <code class="literal">"false"</code> if not specified. Skipping certificate verification proceeds with an insecure migration and then the certificate is not required. Insecure migration means that the transferred data is sent over an insecure connection and potentially sensitive data could be exposed.
								</div></dd><dt><a href="#CO2-5"><span class="callout">5</span></a> </dt><dd><div class="para">
									When this field is not set and <span class="emphasis"><em>skip certificate verification</em></span> is disabled, MTV attempts to use the system CA.
								</div></dd><dt><a href="#CO2-6"><span class="callout">6</span></a> </dt><dd><div class="para">
									Specify the API endpoint URL of the vCenter or the ESX/ESXi, for example, <code class="literal">https://&lt;vCenter_host&gt;/sdk</code>.
								</div></dd></dl></div></li></ol></div><div class="orderedlist"><ol class="orderedlist" start="2" type="1"><li class="listitem"><p class="simpara">
							Create a <code class="literal">Provider</code> manifest for the source provider:
						</p><pre class="programlisting language-yaml">$ cat &lt;&lt; EOF | oc apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: Provider
metadata:
  name: &lt;source_provider&gt;
  namespace: &lt;namespace&gt;
spec:
  type: vsphere
  url: &lt;api_end_point&gt; <span id="CO3-1"/><span class="callout">1</span>
  settings:
    vddkInitImage: &lt;VDDK_image&gt; <span id="CO3-2"/><span class="callout">2</span>
    sdkEndpoint: vcenter <span id="CO3-3"/><span class="callout">3</span>
  secret:
    name: &lt;secret&gt; <span id="CO3-4"/><span class="callout">4</span>
    namespace: &lt;namespace&gt;
EOF</pre><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO3-1"><span class="callout">1</span></a> </dt><dd><div class="para">
									Specify the URL of the API endpoint, for example, <code class="literal">https://&lt;vCenter_host&gt;/sdk</code>.
								</div></dd><dt><a href="#CO3-2"><span class="callout">2</span></a> </dt><dd><div class="para">
									Optional, but it is strongly recommended to create a VDDK image to accelerate migrations. Follow OpenShift documentation to specify the VDDK image you created.
								</div></dd><dt><a href="#CO3-3"><span class="callout">3</span></a> </dt><dd><div class="para">
									Options: <code class="literal">vcenter</code> or <code class="literal">esxi</code>.
								</div></dd><dt><a href="#CO3-4"><span class="callout">4</span></a> </dt><dd><div class="para">
									Specify the name of the provider <code class="literal">Secret</code> CR.
								</div></dd></dl></div></li></ol></div><div class="orderedlist"><ol class="orderedlist" start="3" type="1"><li class="listitem"><p class="simpara">
							Create a <code class="literal">Host</code> manifest:
						</p><pre class="programlisting language-yaml">$ cat &lt;&lt; EOF | oc apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: Host
metadata:
  name: &lt;vmware_host&gt;
  namespace: &lt;namespace&gt;
spec:
  provider:
    namespace: &lt;namespace&gt;
    name: &lt;source_provider&gt; <span id="CO4-1"/><span class="callout">1</span>
  id: &lt;source_host_mor&gt; <span id="CO4-2"/><span class="callout">2</span>
  ipAddress: &lt;source_network_ip&gt; <span id="CO4-3"/><span class="callout">3</span>
EOF</pre><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO4-1"><span class="callout">1</span></a> </dt><dd><div class="para">
									Specify the name of the VMware vSphere <code class="literal">Provider</code> CR.
								</div></dd><dt><a href="#CO4-2"><span class="callout">2</span></a> </dt><dd><div class="para">
									Specify the Managed Object Reference (moRef) of the VMware vSphere host. To retrieve the moRef, see <a class="link" href="#retrieving-vmware-moref_mtv" title="5.2. Retrieving a VMware vSphere moRef">Retrieving a VMware vSphere moRef</a>.
								</div></dd><dt><a href="#CO4-3"><span class="callout">3</span></a> </dt><dd><div class="para">
									Specify the IP address of the VMware vSphere migration network.
								</div></dd></dl></div></li></ol></div><div class="orderedlist"><ol class="orderedlist" start="4" type="1"><li class="listitem"><p class="simpara">
							Create a <code class="literal">NetworkMap</code> manifest to map the source and destination networks:
						</p><pre class="programlisting language-yaml">$  cat &lt;&lt; EOF | oc apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: NetworkMap
metadata:
  name: &lt;network_map&gt;
  namespace: &lt;namespace&gt;
spec:
  map:
    - destination:
        name: &lt;network_name&gt;
        type: pod <span id="CO5-1"/><span class="callout">1</span>
      source: <span id="CO5-2"/><span class="callout">2</span>
        id: &lt;source_network_id&gt;
        name: &lt;source_network_name&gt;
    - destination:
        name: &lt;network_attachment_definition&gt; <span id="CO5-3"/><span class="callout">3</span>
        namespace: &lt;network_attachment_definition_namespace&gt; <span id="CO5-4"/><span class="callout">4</span>
        type: multus
      source:
        id: &lt;source_network_id&gt;
        name: &lt;source_network_name&gt;
  provider:
    source:
      name: &lt;source_provider&gt;
      namespace: &lt;namespace&gt;
    destination:
      name: &lt;destination_provider&gt;
      namespace: &lt;namespace&gt;
EOF</pre><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO5-1"><span class="callout">1</span></a> </dt><dd><div class="para">
									Allowed values are <code class="literal">pod</code> and <code class="literal">multus</code>.
								</div></dd><dt><a href="#CO5-2"><span class="callout">2</span></a> </dt><dd><div class="para">
									You can use either the <code class="literal">id</code> <span class="emphasis"><em>or</em></span> the <code class="literal">name</code> parameter to specify the source network. For <code class="literal">id</code>, specify the VMware vSphere network Managed Object Reference (moRef). To retrieve the moRef, see <a class="link" href="#retrieving-vmware-moref_mtv" title="5.2. Retrieving a VMware vSphere moRef">Retrieving a VMware vSphere moRef</a>.
								</div></dd><dt><a href="#CO5-3"><span class="callout">3</span></a> </dt><dd><div class="para">
									Specify a network attachment definition for each additional OpenShift Virtualization network.
								</div></dd><dt><a href="#CO5-4"><span class="callout">4</span></a> </dt><dd><div class="para">
									Required only when <code class="literal">type</code> is <code class="literal">multus</code>. Specify the namespace of the OpenShift Virtualization network attachment definition.
								</div></dd></dl></div></li></ol></div><div class="orderedlist"><ol class="orderedlist" start="5" type="1"><li class="listitem"><p class="simpara">
							Create a <code class="literal">StorageMap</code> manifest to map source and destination storage:
						</p><pre class="programlisting language-yaml">$ cat &lt;&lt; EOF | oc apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: StorageMap
metadata:
  name: &lt;storage_map&gt;
  namespace: &lt;namespace&gt;
spec:
  map:
    - destination:
        storageClass: &lt;storage_class&gt;
        accessMode: &lt;access_mode&gt; <span id="CO6-1"/><span class="callout">1</span>
      source:
        id: &lt;source_datastore&gt; <span id="CO6-2"/><span class="callout">2</span>
  provider:
    source:
      name: &lt;source_provider&gt;
      namespace: &lt;namespace&gt;
    destination:
      name: &lt;destination_provider&gt;
      namespace: &lt;namespace&gt;
EOF</pre><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO6-1"><span class="callout">1</span></a> </dt><dd><div class="para">
									Allowed values are <code class="literal">ReadWriteOnce</code> and <code class="literal">ReadWriteMany</code>.
								</div></dd><dt><a href="#CO6-2"><span class="callout">2</span></a> </dt><dd><div class="para">
									Specify the VMware vSphere datastore moRef. For example, <code class="literal">f2737930-b567-451a-9ceb-2887f6207009</code>. To retrieve the moRef, see <a class="link" href="#retrieving-vmware-moref_mtv" title="5.2. Retrieving a VMware vSphere moRef">Retrieving a VMware vSphere moRef</a>.
								</div></dd></dl></div></li><li class="listitem"><p class="simpara">
							Optional: Create a <code class="literal">Hook</code> manifest to run custom code on a VM during the phase specified in the <code class="literal">Plan</code> CR:
						</p><pre class="programlisting language-yaml">$  cat &lt;&lt; EOF | oc apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: Hook
metadata:
  name: &lt;hook&gt;
  namespace: &lt;namespace&gt;
spec:
  image: quay.io/konveyor/hook-runner
  playbook: |
    LS0tCi0gbmFtZTogTWFpbgogIGhvc3RzOiBsb2NhbGhvc3QKICB0YXNrczoKICAtIG5hbWU6IExv
    YWQgUGxhbgogICAgaW5jbHVkZV92YXJzOgogICAgICBmaWxlOiAiL3RtcC9ob29rL3BsYW4ueW1s
    IgogICAgICBuYW1lOiBwbGFuCiAgLSBuYW1lOiBMb2FkIFdvcmtsb2FkCiAgICBpbmNsdWRlX3Zh
    cnM6CiAgICAgIGZpbGU6ICIvdG1wL2hvb2svd29ya2xvYWQueW1sIgogICAgICBuYW1lOiB3b3Jr
    bG9hZAoK
EOF</pre><p class="simpara">
							where:
						</p><p class="simpara">
							<code class="literal">playbook</code> refers to an optional Base64-encoded Ansible Playbook. If you specify a playbook, the <code class="literal">image</code> must be <code class="literal">hook-runner</code>.
						</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
								You can use the default <code class="literal">hook-runner</code> image or specify a custom image. If you specify a custom image, you do not have to specify a playbook.
							</p></div></div></li></ol></div><div class="orderedlist"><ol class="orderedlist" start="7" type="1"><li class="listitem"><p class="simpara">
							Create a <code class="literal">Plan</code> manifest for the migration:
						</p><pre class="programlisting language-yaml">$ cat &lt;&lt; EOF | oc apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: Plan
metadata:
  name: &lt;plan&gt; <span id="CO7-1"/><span class="callout">1</span>
  namespace: &lt;namespace&gt;
spec:
  warm: false <span id="CO7-2"/><span class="callout">2</span>
  provider:
    source:
      name: &lt;source_provider&gt;
      namespace: &lt;namespace&gt;
    destination:
      name: &lt;destination_provider&gt;
      namespace: &lt;namespace&gt;
  map: <span id="CO7-3"/><span class="callout">3</span>
    network: <span id="CO7-4"/><span class="callout">4</span>
      name: &lt;network_map&gt; <span id="CO7-5"/><span class="callout">5</span>
      namespace: &lt;namespace&gt;
    storage: <span id="CO7-6"/><span class="callout">6</span>
      name: &lt;storage_map&gt; <span id="CO7-7"/><span class="callout">7</span>
      namespace: &lt;namespace&gt;
  targetNamespace: &lt;target_namespace&gt;
  vms: <span id="CO7-8"/><span class="callout">8</span>
    - id: &lt;source_vm&gt; <span id="CO7-9"/><span class="callout">9</span>
    - name: &lt;source_vm&gt;
      hooks: <span id="CO7-10"/><span class="callout">10</span>
        - hook:
            namespace: &lt;namespace&gt;
            name: &lt;hook&gt; <span id="CO7-11"/><span class="callout">11</span>
          step: &lt;step&gt; <span id="CO7-12"/><span class="callout">12</span>
EOF</pre><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO7-1"><span class="callout">1</span></a> </dt><dd><div class="para">
									Specify the name of the <code class="literal">Plan</code> CR.
								</div></dd><dt><a href="#CO7-2"><span class="callout">2</span></a> </dt><dd><div class="para">
									Specify whether the migration is warm - <code class="literal">true</code> - or cold - <code class="literal">false</code>. If you specify a warm migration without specifying a value for the <code class="literal">cutover</code> parameter in the <code class="literal">Migration</code> manifest, only the precopy stage will run.
								</div></dd><dt><a href="#CO7-3"><span class="callout">3</span></a> </dt><dd><div class="para">
									Specify only one network map and one storage map per plan.
								</div></dd><dt><a href="#CO7-4"><span class="callout">4</span></a> </dt><dd><div class="para">
									Specify a network mapping even if the VMs to be migrated are not assigned to a network. The mapping can be empty in this case.
								</div></dd><dt><a href="#CO7-5"><span class="callout">5</span></a> </dt><dd><div class="para">
									Specify the name of the <code class="literal">NetworkMap</code> CR.
								</div></dd><dt><a href="#CO7-6"><span class="callout">6</span></a> </dt><dd><div class="para">
									Specify a storage mapping even if the VMs to be migrated are not assigned with disk images. The mapping can be empty in this case.
								</div></dd><dt><a href="#CO7-7"><span class="callout">7</span></a> </dt><dd><div class="para">
									Specify the name of the <code class="literal">StorageMap</code> CR.
								</div></dd><dt><a href="#CO7-8"><span class="callout">8</span></a> </dt><dd><div class="para">
									You can use either the <code class="literal">id</code> <span class="emphasis"><em>or</em></span> the <code class="literal">name</code> parameter to specify the source VMs.<br/>
								</div></dd><dt><a href="#CO7-9"><span class="callout">9</span></a> </dt><dd><div class="para">
									Specify the VMware vSphere VM moRef. To retrieve the moRef, see <a class="link" href="#retrieving-vmware-moref_mtv" title="5.2. Retrieving a VMware vSphere moRef">Retrieving a VMware vSphere moRef</a>.
								</div></dd><dt><a href="#CO7-10"><span class="callout">10</span></a> </dt><dd><div class="para">
									Optional: You can specify up to two hooks for a VM. Each hook must run during a separate migration step.
								</div></dd><dt><a href="#CO7-11"><span class="callout">11</span></a> </dt><dd><div class="para">
									Specify the name of the <code class="literal">Hook</code> CR.
								</div></dd><dt><a href="#CO7-12"><span class="callout">12</span></a> </dt><dd><div class="para">
									Allowed values are <code class="literal">PreHook</code>, before the migration plan starts, or <code class="literal">PostHook</code>, after the migration is complete.
								</div></dd></dl></div></li><li class="listitem"><p class="simpara">
							Create a <code class="literal">Migration</code> manifest to run the <code class="literal">Plan</code> CR:
						</p><pre class="programlisting language-yaml">$ cat &lt;&lt; EOF | oc apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: Migration
metadata:
  name: &lt;name_of_migration_cr&gt;
  namespace: &lt;namespace&gt;
spec:
  plan:
    name: &lt;name_of_plan_cr&gt;
    namespace: &lt;namespace&gt;
  cutover: &lt;optional_cutover_time&gt;
EOF</pre><div class="admonition note"><div class="admonition_header">Note</div><div><p>
								If you specify a cutover time, use the ISO 8601 format with the UTC time offset, for example, <code class="literal">2024-04-04T01:23:45.678+09:00</code>.
							</p></div></div></li></ol></div></section><section class="section" id="new-migrating-virtual-machines-cli_rhv"><div class="titlepage"><div><div><h3 class="title">5.3.2. Migrating from a Red Hat Virtualization source provider</h3></div></div></div><p>
					You can migrate from a Red Hat Virtualization (RHV) source provider by using the CLI.
				</p><div class="formalpara"><p class="title"><strong>Prerequisites</strong></p><p>
						If you are migrating a virtual machine with a direct LUN disk, ensure that the nodes in the OpenShift Virtualization destination cluster that the VM is expected to run on can access the backend storage.
					</p></div><div class="admonition note"><div class="admonition_header">Note</div><div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								Unlike disk images that <span class="emphasis"><em>are copied</em></span> from a source provider to a target provider, LUNs are <span class="emphasis"><em>detached</em></span>, <span class="emphasis"><em>but not removed</em></span>, from virtual machines in the source provider and then attached to the virtual machines (VMs) that are created in the target provider.
							</li><li class="listitem">
								LUNs are not removed from the source provider during the migration in case fallback to the source provider is required. However, before re-attaching the LUNs to VMs in the source provider, ensure that the LUNs are not used by VMs on the target environment at the same time, which might lead to data corruption.
							</li></ul></div></div></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Create a <code class="literal">Secret</code> manifest for the source provider credentials:
						</p><pre class="programlisting language-yaml">$ cat &lt;&lt; EOF | oc apply -f -
apiVersion: v1
kind: Secret
metadata:
  name: &lt;secret&gt;
  namespace: &lt;namespace&gt;
  ownerReferences: <span id="CO8-1"/><span class="callout">1</span>
    - apiVersion: forklift.konveyor.io/v1beta1
      kind: Provider
      name: &lt;provider_name&gt;
      uid: &lt;provider_uid&gt;
  labels:
    createdForProviderType: ovirt
    createdForResourceType: providers
type: Opaque
stringData:
  user: &lt;user&gt; <span id="CO8-2"/><span class="callout">2</span>
  password: &lt;password&gt; <span id="CO8-3"/><span class="callout">3</span>
  insecureSkipVerify: &lt;"true"/"false"&gt; <span id="CO8-4"/><span class="callout">4</span>
  cacert: | <span id="CO8-5"/><span class="callout">5</span>
    &lt;ca_certificate&gt;
  url: &lt;api_end_point&gt; <span id="CO8-6"/><span class="callout">6</span>
EOF</pre><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO8-1"><span class="callout">1</span></a> </dt><dd><div class="para">
									The <code class="literal">ownerReferences</code> section is optional.
								</div></dd><dt><a href="#CO8-2"><span class="callout">2</span></a> </dt><dd><div class="para">
									Specify the RHV Manager user.
								</div></dd><dt><a href="#CO8-3"><span class="callout">3</span></a> </dt><dd><div class="para">
									Specify the user password.
								</div></dd><dt><a href="#CO8-4"><span class="callout">4</span></a> </dt><dd><div class="para">
									Specify <code class="literal">"true"</code> to skip certificate verification, specify <code class="literal">"false"</code> to verify the certificate. Defaults to <code class="literal">"false"</code> if not specified. Skipping certificate verification proceeds with an insecure migration and then the certificate is not required. Insecure migration means that the transferred data is sent over an insecure connection and potentially sensitive data could be exposed.
								</div></dd><dt><a href="#CO8-5"><span class="callout">5</span></a> </dt><dd><div class="para">
									Enter the Manager CA certificate, unless it was replaced by a third-party certificate, in which case, enter the Manager Apache CA certificate. You can retrieve the Manager CA certificate at <a class="link" href="https://&lt;engine_host&gt;/ovirt-engine/services/pki-resource?resource=ca-certificate&amp;format=X509-PEM-CA">https://&lt;engine_host&gt;/ovirt-engine/services/pki-resource?resource=ca-certificate&amp;format=X509-PEM-CA</a>.
								</div></dd><dt><a href="#CO8-6"><span class="callout">6</span></a> </dt><dd><div class="para">
									Specify the API endpoint URL, for example, <code class="literal">https://&lt;engine_host&gt;/ovirt-engine/api</code>.
								</div></dd></dl></div></li></ol></div><div class="orderedlist"><ol class="orderedlist" start="2" type="1"><li class="listitem"><p class="simpara">
							Create a <code class="literal">Provider</code> manifest for the source provider:
						</p><pre class="programlisting language-yaml">$ cat &lt;&lt; EOF | oc apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: Provider
metadata:
  name: &lt;source_provider&gt;
  namespace: &lt;namespace&gt;
spec:
  type: ovirt
  url: &lt;api_end_point&gt; <span id="CO9-1"/><span class="callout">1</span>
  secret:
    name: &lt;secret&gt; <span id="CO9-2"/><span class="callout">2</span>
    namespace: &lt;namespace&gt;
EOF</pre><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO9-1"><span class="callout">1</span></a> </dt><dd><div class="para">
									Specify the URL of the API endpoint, for example, <code class="literal">https://&lt;engine_host&gt;/ovirt-engine/api</code>.
								</div></dd><dt><a href="#CO9-2"><span class="callout">2</span></a> </dt><dd><div class="para">
									Specify the name of provider <code class="literal">Secret</code> CR.
								</div></dd></dl></div></li></ol></div><div class="orderedlist"><ol class="orderedlist" start="3" type="1"><li class="listitem"><p class="simpara">
							Create a <code class="literal">NetworkMap</code> manifest to map the source and destination networks:
						</p><pre class="programlisting language-yaml">$  cat &lt;&lt; EOF | oc apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: NetworkMap
metadata:
  name: &lt;network_map&gt;
  namespace: &lt;namespace&gt;
spec:
  map:
    - destination:
        name: &lt;network_name&gt;
        type: pod <span id="CO10-1"/><span class="callout">1</span>
      source: <span id="CO10-2"/><span class="callout">2</span>
        id: &lt;source_network_id&gt;
        name: &lt;source_network_name&gt;
    - destination:
        name: &lt;network_attachment_definition&gt; <span id="CO10-3"/><span class="callout">3</span>
        namespace: &lt;network_attachment_definition_namespace&gt; <span id="CO10-4"/><span class="callout">4</span>
        type: multus
      source:
        id: &lt;source_network_id&gt;
        name: &lt;source_network_name&gt;
  provider:
    source:
      name: &lt;source_provider&gt;
      namespace: &lt;namespace&gt;
    destination:
      name: &lt;destination_provider&gt;
      namespace: &lt;namespace&gt;
EOF</pre><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO10-1"><span class="callout">1</span></a> </dt><dd><div class="para">
									Allowed values are <code class="literal">pod</code> and <code class="literal">multus</code>.
								</div></dd><dt><a href="#CO10-2"><span class="callout">2</span></a> </dt><dd><div class="para">
									You can use either the <code class="literal">id</code> <span class="emphasis"><em>or</em></span> the <code class="literal">name</code> parameter to specify the source network. For <code class="literal">id</code>, specify the RHV network Universal Unique ID (UUID).
								</div></dd><dt><a href="#CO10-3"><span class="callout">3</span></a> </dt><dd><div class="para">
									Specify a network attachment definition for each additional OpenShift Virtualization network.
								</div></dd><dt><a href="#CO10-4"><span class="callout">4</span></a> </dt><dd><div class="para">
									Required only when <code class="literal">type</code> is <code class="literal">multus</code>. Specify the namespace of the OpenShift Virtualization network attachment definition.
								</div></dd></dl></div></li></ol></div><div class="orderedlist"><ol class="orderedlist" start="4" type="1"><li class="listitem"><p class="simpara">
							Create a <code class="literal">StorageMap</code> manifest to map source and destination storage:
						</p><pre class="programlisting language-yaml">$ cat &lt;&lt; EOF | oc apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: StorageMap
metadata:
  name: &lt;storage_map&gt;
  namespace: &lt;namespace&gt;
spec:
  map:
    - destination:
        storageClass: &lt;storage_class&gt;
        accessMode: &lt;access_mode&gt; <span id="CO11-1"/><span class="callout">1</span>
      source:
        id: &lt;source_storage_domain&gt; <span id="CO11-2"/><span class="callout">2</span>
  provider:
    source:
      name: &lt;source_provider&gt;
      namespace: &lt;namespace&gt;
    destination:
      name: &lt;destination_provider&gt;
      namespace: &lt;namespace&gt;
EOF</pre><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO11-1"><span class="callout">1</span></a> </dt><dd><div class="para">
									Allowed values are <code class="literal">ReadWriteOnce</code> and <code class="literal">ReadWriteMany</code>.
								</div></dd><dt><a href="#CO11-2"><span class="callout">2</span></a> </dt><dd><div class="para">
									Specify the RHV storage domain UUID. For example, <code class="literal">f2737930-b567-451a-9ceb-2887f6207009</code>.
								</div></dd></dl></div></li><li class="listitem"><p class="simpara">
							Optional: Create a <code class="literal">Hook</code> manifest to run custom code on a VM during the phase specified in the <code class="literal">Plan</code> CR:
						</p><pre class="programlisting language-yaml">$  cat &lt;&lt; EOF | oc apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: Hook
metadata:
  name: &lt;hook&gt;
  namespace: &lt;namespace&gt;
spec:
  image: quay.io/konveyor/hook-runner
  playbook: |
    LS0tCi0gbmFtZTogTWFpbgogIGhvc3RzOiBsb2NhbGhvc3QKICB0YXNrczoKICAtIG5hbWU6IExv
    YWQgUGxhbgogICAgaW5jbHVkZV92YXJzOgogICAgICBmaWxlOiAiL3RtcC9ob29rL3BsYW4ueW1s
    IgogICAgICBuYW1lOiBwbGFuCiAgLSBuYW1lOiBMb2FkIFdvcmtsb2FkCiAgICBpbmNsdWRlX3Zh
    cnM6CiAgICAgIGZpbGU6ICIvdG1wL2hvb2svd29ya2xvYWQueW1sIgogICAgICBuYW1lOiB3b3Jr
    bG9hZAoK
EOF</pre><p class="simpara">
							where:
						</p><p class="simpara">
							<code class="literal">playbook</code> refers to an optional Base64-encoded Ansible Playbook. If you specify a playbook, the <code class="literal">image</code> must be <code class="literal">hook-runner</code>.
						</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
								You can use the default <code class="literal">hook-runner</code> image or specify a custom image. If you specify a custom image, you do not have to specify a playbook.
							</p></div></div></li></ol></div><div class="orderedlist"><ol class="orderedlist" start="6" type="1"><li class="listitem"><p class="simpara">
							Create a <code class="literal">Plan</code> manifest for the migration:
						</p><pre class="programlisting language-yaml">$ cat &lt;&lt; EOF | oc apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: Plan
metadata:
  name: &lt;plan&gt; <span id="CO12-1"/><span class="callout">1</span>
  namespace: &lt;namespace&gt;
  preserveClusterCpuModel: true <span id="CO12-2"/><span class="callout">2</span>
spec:
  warm: false <span id="CO12-3"/><span class="callout">3</span>
  provider:
    source:
      name: &lt;source_provider&gt;
      namespace: &lt;namespace&gt;
    destination:
      name: &lt;destination_provider&gt;
      namespace: &lt;namespace&gt;
  map: <span id="CO12-4"/><span class="callout">4</span>
    network: <span id="CO12-5"/><span class="callout">5</span>
      name: &lt;network_map&gt; <span id="CO12-6"/><span class="callout">6</span>
      namespace: &lt;namespace&gt;
    storage: <span id="CO12-7"/><span class="callout">7</span>
      name: &lt;storage_map&gt; <span id="CO12-8"/><span class="callout">8</span>
      namespace: &lt;namespace&gt;
  targetNamespace: &lt;target_namespace&gt;
  vms: <span id="CO12-9"/><span class="callout">9</span>
    - id: &lt;source_vm&gt; <span id="CO12-10"/><span class="callout">10</span>
    - name: &lt;source_vm&gt;
      hooks: <span id="CO12-11"/><span class="callout">11</span>
        - hook:
            namespace: &lt;namespace&gt;
            name: &lt;hook&gt; <span id="CO12-12"/><span class="callout">12</span>
          step: &lt;step&gt; <span id="CO12-13"/><span class="callout">13</span>
EOF</pre><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO12-1"><span class="callout">1</span></a> </dt><dd><div class="para">
									Specify the name of the <code class="literal">Plan</code> CR.
								</div></dd><dt><a href="#CO12-2"><span class="callout">2</span></a> </dt><dd><div class="para">
									See note below.
								</div></dd><dt><a href="#CO12-3"><span class="callout">3</span></a> </dt><dd><div class="para">
									Specify whether the migration is warm or cold. If you specify a warm migration without specifying a value for the <code class="literal">cutover</code> parameter in the <code class="literal">Migration</code> manifest, only the precopy stage will run.
								</div></dd><dt><a href="#CO12-4"><span class="callout">4</span></a> </dt><dd><div class="para">
									Specify only one network map and one storage map per plan.
								</div></dd><dt><a href="#CO12-5"><span class="callout">5</span></a> </dt><dd><div class="para">
									Specify a network mapping even if the VMs to be migrated are not assigned to a network. The mapping can be empty in this case.
								</div></dd><dt><a href="#CO12-6"><span class="callout">6</span></a> </dt><dd><div class="para">
									Specify the name of the <code class="literal">NetworkMap</code> CR.
								</div></dd><dt><a href="#CO12-7"><span class="callout">7</span></a> </dt><dd><div class="para">
									Specify a storage mapping even if the VMs to be migrated are not assigned with disk images. The mapping can be empty in this case.
								</div></dd><dt><a href="#CO12-8"><span class="callout">8</span></a> </dt><dd><div class="para">
									Specify the name of the <code class="literal">StorageMap</code> CR.
								</div></dd><dt><a href="#CO12-9"><span class="callout">9</span></a> </dt><dd><div class="para">
									You can use either the <code class="literal">id</code> <span class="emphasis"><em>or</em></span> the <code class="literal">name</code> parameter to specify the source VMs.
								</div></dd><dt><a href="#CO12-10"><span class="callout">10</span></a> </dt><dd><div class="para">
									Specify the RHV VM UUID.
								</div></dd><dt><a href="#CO12-11"><span class="callout">11</span></a> </dt><dd><div class="para">
									Optional: You can specify up to two hooks for a VM. Each hook must run during a separate migration step.
								</div></dd><dt><a href="#CO12-12"><span class="callout">12</span></a> </dt><dd><div class="para">
									Specify the name of the <code class="literal">Hook</code> CR.
								</div></dd><dt><a href="#CO12-13"><span class="callout">13</span></a> </dt><dd><div class="para">
									Allowed values are <code class="literal">PreHook</code>, before the migration plan starts, or <code class="literal">PostHook</code>, after the migration is complete.
								</div></dd></dl></div><div class="admonition note"><div class="admonition_header">Note</div><div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
										If the migrated machines is set with a custom CPU model, it will be set with that CPU model in the destination cluster, regardless of the setting of <code class="literal">preserveClusterCpuModel</code>.
									</li><li class="listitem"><p class="simpara">
										If the migrated machine is <span class="emphasis"><em>not</em></span> set with a custom CPU model:
									</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
												If <code class="literal">preserveClusterCpuModel</code> is set to 'true`, MTV checks the CPU model of the VM when it runs in RHV, based on the cluster’s configuration, and then sets the migrated VM with that CPU model.
											</li><li class="listitem">
												If <code class="literal">preserveClusterCpuModel</code> is set to 'false`, MTV does not set a CPU type and the VM is set with the default CPU model of the destination cluster.
											</li></ul></div></li></ul></div></div></div></li><li class="listitem"><p class="simpara">
							Create a <code class="literal">Migration</code> manifest to run the <code class="literal">Plan</code> CR:
						</p><pre class="programlisting language-yaml">$ cat &lt;&lt; EOF | oc apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: Migration
metadata:
  name: &lt;name_of_migration_cr&gt;
  namespace: &lt;namespace&gt;
spec:
  plan:
    name: &lt;name_of_plan_cr&gt;
    namespace: &lt;namespace&gt;
  cutover: &lt;optional_cutover_time&gt;
EOF</pre><div class="admonition note"><div class="admonition_header">Note</div><div><p>
								If you specify a cutover time, use the ISO 8601 format with the UTC time offset, for example, <code class="literal">2024-04-04T01:23:45.678+09:00</code>.
							</p></div></div></li></ol></div></section><section class="section" id="new-migrating-virtual-machines-cli_ostack"><div class="titlepage"><div><div><h3 class="title">5.3.3. Migrating from an OpenStack source provider</h3></div></div></div><p>
					You can migrate from an OpenStack source provider by using the CLI.
				</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Create a <code class="literal">Secret</code> manifest for the source provider credentials:
						</p><pre class="programlisting language-yaml">$ cat &lt;&lt; EOF | oc apply -f -
apiVersion: v1
kind: Secret
metadata:
  name: &lt;secret&gt;
  namespace: &lt;namespace&gt;
  ownerReferences: <span id="CO13-1"/><span class="callout">1</span>
    - apiVersion: forklift.konveyor.io/v1beta1
      kind: Provider
      name: &lt;provider_name&gt;
      uid: &lt;provider_uid&gt;
  labels:
    createdForProviderType: openstack
    createdForResourceType: providers
type: Opaque
stringData:
  user: &lt;user&gt; <span id="CO13-2"/><span class="callout">2</span>
  password: &lt;password&gt; <span id="CO13-3"/><span class="callout">3</span>
  insecureSkipVerify: &lt;"true"/"false"&gt; <span id="CO13-4"/><span class="callout">4</span>
  domainName: &lt;domain_name&gt;
  projectName: &lt;project_name&gt;
  regionName: &lt;region_name&gt;
  cacert: | <span id="CO13-5"/><span class="callout">5</span>
    &lt;ca_certificate&gt;
  url: &lt;api_end_point&gt; <span id="CO13-6"/><span class="callout">6</span>
EOF</pre><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO13-1"><span class="callout">1</span></a> </dt><dd><div class="para">
									The <code class="literal">ownerReferences</code> section is optional.
								</div></dd><dt><a href="#CO13-2"><span class="callout">2</span></a> </dt><dd><div class="para">
									Specify the OpenStack user.
								</div></dd><dt><a href="#CO13-3"><span class="callout">3</span></a> </dt><dd><div class="para">
									Specify the user OpenStack password.
								</div></dd><dt><a href="#CO13-4"><span class="callout">4</span></a> </dt><dd><div class="para">
									Specify <code class="literal">"true"</code> to skip certificate verification, specify <code class="literal">"false"</code> to verify the certificate. Defaults to <code class="literal">"false"</code> if not specified. Skipping certificate verification proceeds with an insecure migration and then the certificate is not required. Insecure migration means that the transferred data is sent over an insecure connection and potentially sensitive data could be exposed.
								</div></dd><dt><a href="#CO13-5"><span class="callout">5</span></a> </dt><dd><div class="para">
									When this field is not set and <span class="emphasis"><em>skip certificate verification</em></span> is disabled, MTV attempts to use the system CA.
								</div></dd><dt><a href="#CO13-6"><span class="callout">6</span></a> </dt><dd><div class="para">
									Specify the API endpoint URL, for example, <code class="literal">https://&lt;identity_service&gt;/v3</code>.
								</div></dd></dl></div></li></ol></div><div class="orderedlist"><ol class="orderedlist" start="2" type="1"><li class="listitem"><p class="simpara">
							Create a <code class="literal">Provider</code> manifest for the source provider:
						</p><pre class="programlisting language-yaml">$ cat &lt;&lt; EOF | oc apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: Provider
metadata:
  name: &lt;source_provider&gt;
  namespace: &lt;namespace&gt;
spec:
  type: openstack
  url: &lt;api_end_point&gt; <span id="CO14-1"/><span class="callout">1</span>
  secret:
    name: &lt;secret&gt; <span id="CO14-2"/><span class="callout">2</span>
    namespace: &lt;namespace&gt;
EOF</pre><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO14-1"><span class="callout">1</span></a> </dt><dd><div class="para">
									Specify the URL of the API endpoint.
								</div></dd><dt><a href="#CO14-2"><span class="callout">2</span></a> </dt><dd><div class="para">
									Specify the name of provider <code class="literal">Secret</code> CR.
								</div></dd></dl></div></li></ol></div><div class="orderedlist"><ol class="orderedlist" start="3" type="1"><li class="listitem"><p class="simpara">
							Create a <code class="literal">NetworkMap</code> manifest to map the source and destination networks:
						</p><pre class="programlisting language-yaml">$  cat &lt;&lt; EOF | oc apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: NetworkMap
metadata:
  name: &lt;network_map&gt;
  namespace: &lt;namespace&gt;
spec:
  map:
    - destination:
        name: &lt;network_name&gt;
        type: pod <span id="CO15-1"/><span class="callout">1</span>
      source:<span id="CO15-2"/><span class="callout">2</span>
        id: &lt;source_network_id&gt;
        name: &lt;source_network_name&gt;
    - destination:
        name: &lt;network_attachment_definition&gt; <span id="CO15-3"/><span class="callout">3</span>
        namespace: &lt;network_attachment_definition_namespace&gt; <span id="CO15-4"/><span class="callout">4</span>
        type: multus
      source:
        id: &lt;source_network_id&gt;
        name: &lt;source_network_name&gt;
  provider:
    source:
      name: &lt;source_provider&gt;
      namespace: &lt;namespace&gt;
    destination:
      name: &lt;destination_provider&gt;
      namespace: &lt;namespace&gt;
EOF</pre><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO15-1"><span class="callout">1</span></a> </dt><dd><div class="para">
									Allowed values are <code class="literal">pod</code> and <code class="literal">multus</code>.
								</div></dd><dt><a href="#CO15-2"><span class="callout">2</span></a> </dt><dd><div class="para">
									You can use either the <code class="literal">id</code> <span class="emphasis"><em>or</em></span> the <code class="literal">name</code> parameter to specify the source network. For <code class="literal">id</code>, specify the OpenStack network UUID.
								</div></dd><dt><a href="#CO15-3"><span class="callout">3</span></a> </dt><dd><div class="para">
									Specify a network attachment definition for each additional OpenShift Virtualization network.
								</div></dd><dt><a href="#CO15-4"><span class="callout">4</span></a> </dt><dd><div class="para">
									Required only when <code class="literal">type</code> is <code class="literal">multus</code>. Specify the namespace of the OpenShift Virtualization network attachment definition.
								</div></dd></dl></div></li></ol></div><div class="orderedlist"><ol class="orderedlist" start="4" type="1"><li class="listitem"><p class="simpara">
							Create a <code class="literal">StorageMap</code> manifest to map source and destination storage:
						</p><pre class="programlisting language-yaml">$ cat &lt;&lt; EOF | oc apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: StorageMap
metadata:
  name: &lt;storage_map&gt;
  namespace: &lt;namespace&gt;
spec:
  map:
    - destination:
        storageClass: &lt;storage_class&gt;
        accessMode: &lt;access_mode&gt; <span id="CO16-1"/><span class="callout">1</span>
      source:
        id: &lt;source_volume_type&gt; <span id="CO16-2"/><span class="callout">2</span>
  provider:
    source:
      name: &lt;source_provider&gt;
      namespace: &lt;namespace&gt;
    destination:
      name: &lt;destination_provider&gt;
      namespace: &lt;namespace&gt;
EOF</pre><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO16-1"><span class="callout">1</span></a> </dt><dd><div class="para">
									Allowed values are <code class="literal">ReadWriteOnce</code> and <code class="literal">ReadWriteMany</code>.
								</div></dd><dt><a href="#CO16-2"><span class="callout">2</span></a> </dt><dd><div class="para">
									Specify the OpenStack <code class="literal">volume_type</code> UUID. For example, <code class="literal">f2737930-b567-451a-9ceb-2887f6207009</code>.
								</div></dd></dl></div></li><li class="listitem"><p class="simpara">
							Optional: Create a <code class="literal">Hook</code> manifest to run custom code on a VM during the phase specified in the <code class="literal">Plan</code> CR:
						</p><pre class="programlisting language-yaml">$  cat &lt;&lt; EOF | oc apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: Hook
metadata:
  name: &lt;hook&gt;
  namespace: &lt;namespace&gt;
spec:
  image: quay.io/konveyor/hook-runner
  playbook: |
    LS0tCi0gbmFtZTogTWFpbgogIGhvc3RzOiBsb2NhbGhvc3QKICB0YXNrczoKICAtIG5hbWU6IExv
    YWQgUGxhbgogICAgaW5jbHVkZV92YXJzOgogICAgICBmaWxlOiAiL3RtcC9ob29rL3BsYW4ueW1s
    IgogICAgICBuYW1lOiBwbGFuCiAgLSBuYW1lOiBMb2FkIFdvcmtsb2FkCiAgICBpbmNsdWRlX3Zh
    cnM6CiAgICAgIGZpbGU6ICIvdG1wL2hvb2svd29ya2xvYWQueW1sIgogICAgICBuYW1lOiB3b3Jr
    bG9hZAoK
EOF</pre><p class="simpara">
							where:
						</p><p class="simpara">
							<code class="literal">playbook</code> refers to an optional Base64-encoded Ansible Playbook. If you specify a playbook, the <code class="literal">image</code> must be <code class="literal">hook-runner</code>.
						</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
								You can use the default <code class="literal">hook-runner</code> image or specify a custom image. If you specify a custom image, you do not have to specify a playbook.
							</p></div></div></li></ol></div><div class="orderedlist"><ol class="orderedlist" start="6" type="1"><li class="listitem"><p class="simpara">
							Create a <code class="literal">Plan</code> manifest for the migration:
						</p><pre class="programlisting language-yaml">$ cat &lt;&lt; EOF | oc apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: Plan
metadata:
  name: &lt;plan&gt; <span id="CO17-1"/><span class="callout">1</span>
  namespace: &lt;namespace&gt;
spec:
  provider:
    source:
      name: &lt;source_provider&gt;
      namespace: &lt;namespace&gt;
    destination:
      name: &lt;destination_provider&gt;
      namespace: &lt;namespace&gt;
  map: <span id="CO17-2"/><span class="callout">2</span>
    network: <span id="CO17-3"/><span class="callout">3</span>
      name: &lt;network_map&gt; <span id="CO17-4"/><span class="callout">4</span>
      namespace: &lt;namespace&gt;
    storage: <span id="CO17-5"/><span class="callout">5</span>
      name: &lt;storage_map&gt; <span id="CO17-6"/><span class="callout">6</span>
      namespace: &lt;namespace&gt;
  targetNamespace: &lt;target_namespace&gt;
  vms: <span id="CO17-7"/><span class="callout">7</span>
    - id: &lt;source_vm&gt; <span id="CO17-8"/><span class="callout">8</span>
    - name: &lt;source_vm&gt;
      hooks: <span id="CO17-9"/><span class="callout">9</span>
        - hook:
            namespace: &lt;namespace&gt;
            name: &lt;hook&gt; <span id="CO17-10"/><span class="callout">10</span>
          step: &lt;step&gt; <span id="CO17-11"/><span class="callout">11</span>
EOF</pre><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO17-1"><span class="callout">1</span></a> </dt><dd><div class="para">
									Specify the name of the <code class="literal">Plan</code> CR.
								</div></dd><dt><a href="#CO17-2"><span class="callout">2</span></a> </dt><dd><div class="para">
									Specify only one network map and one storage map per plan.
								</div></dd><dt><a href="#CO17-3"><span class="callout">3</span></a> </dt><dd><div class="para">
									Specify a network mapping, even if the VMs to be migrated are not assigned to a network. The mapping can be empty in this case.
								</div></dd><dt><a href="#CO17-4"><span class="callout">4</span></a> </dt><dd><div class="para">
									Specify the name of the <code class="literal">NetworkMap</code> CR.
								</div></dd><dt><a href="#CO17-5"><span class="callout">5</span></a> </dt><dd><div class="para">
									Specify a storage mapping, even if the VMs to be migrated are not assigned with disk images. The mapping can be empty in this case.
								</div></dd><dt><a href="#CO17-6"><span class="callout">6</span></a> </dt><dd><div class="para">
									Specify the name of the <code class="literal">StorageMap</code> CR.
								</div></dd><dt><a href="#CO17-7"><span class="callout">7</span></a> </dt><dd><div class="para">
									You can use either the <code class="literal">id</code> <span class="emphasis"><em>or</em></span> the <code class="literal">name</code> parameter to specify the source VMs.
								</div></dd><dt><a href="#CO17-8"><span class="callout">8</span></a> </dt><dd><div class="para">
									Specify the OpenStack VM UUID.
								</div></dd><dt><a href="#CO17-9"><span class="callout">9</span></a> </dt><dd><div class="para">
									Optional: You can specify up to two hooks for a VM. Each hook must run during a separate migration step.
								</div></dd><dt><a href="#CO17-10"><span class="callout">10</span></a> </dt><dd><div class="para">
									Specify the name of the <code class="literal">Hook</code> CR.
								</div></dd><dt><a href="#CO17-11"><span class="callout">11</span></a> </dt><dd><div class="para">
									Allowed values are <code class="literal">PreHook</code>, before the migration plan starts, or <code class="literal">PostHook</code>, after the migration is complete.
								</div></dd></dl></div></li><li class="listitem"><p class="simpara">
							Create a <code class="literal">Migration</code> manifest to run the <code class="literal">Plan</code> CR:
						</p><pre class="programlisting language-yaml">$ cat &lt;&lt; EOF | oc apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: Migration
metadata:
  name: &lt;name_of_migration_cr&gt;
  namespace: &lt;namespace&gt;
spec:
  plan:
    name: &lt;name_of_plan_cr&gt;
    namespace: &lt;namespace&gt;
  cutover: &lt;optional_cutover_time&gt;
EOF</pre><div class="admonition note"><div class="admonition_header">Note</div><div><p>
								If you specify a cutover time, use the ISO 8601 format with the UTC time offset, for example, <code class="literal">2024-04-04T01:23:45.678+09:00</code>.
							</p></div></div></li></ol></div></section><section class="section" id="new-migrating-virtual-machines-cli_ova"><div class="titlepage"><div><div><h3 class="title">5.3.4. Migrating from an Open Virtual Appliance (OVA) source provider</h3></div></div></div><p>
					You can migrate from Open Virtual Appliance (OVA) files that were created by VMware vSphere as a source provider by using the CLI.
				</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Create a <code class="literal">Secret</code> manifest for the source provider credentials:
						</p><pre class="programlisting language-yaml">$ cat &lt;&lt; EOF | oc apply -f -
apiVersion: v1
kind: Secret
metadata:
  name: &lt;secret&gt;
  namespace: &lt;namespace&gt;
  ownerReferences: <span id="CO18-1"/><span class="callout">1</span>
    - apiVersion: forklift.konveyor.io/v1beta1
      kind: Provider
      name: &lt;provider_name&gt;
      uid: &lt;provider_uid&gt;
  labels:
    createdForProviderType: ova
    createdForResourceType: providers
type: Opaque
stringData:
  url: &lt;nfs_server:/nfs_path&gt; <span id="CO18-2"/><span class="callout">2</span>
EOF</pre><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO18-1"><span class="callout">1</span></a> </dt><dd><div class="para">
									The <code class="literal">ownerReferences</code> section is optional.
								</div></dd><dt><a href="#CO18-2"><span class="callout">2</span></a> </dt><dd><div class="para">
									where: <code class="literal">nfs_server</code> is an IP or hostname of the server where the share was created and <code class="literal">nfs_path</code> is the path on the server where the OVA files are stored.
								</div></dd></dl></div></li></ol></div><div class="orderedlist"><ol class="orderedlist" start="2" type="1"><li class="listitem"><p class="simpara">
							Create a <code class="literal">Provider</code> manifest for the source provider:
						</p><pre class="programlisting language-yaml">$ cat &lt;&lt; EOF | oc apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: Provider
metadata:
  name: &lt;source_provider&gt;
  namespace: &lt;namespace&gt;
spec:
  type: ova
  url:  &lt;nfs_server:/nfs_path&gt; <span id="CO19-1"/><span class="callout">1</span>
  secret:
    name: &lt;secret&gt; <span id="CO19-2"/><span class="callout">2</span>
    namespace: &lt;namespace&gt;
EOF</pre><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO19-1"><span class="callout">1</span></a> </dt><dd><div class="para">
									where: <code class="literal">nfs_server</code> is an IP or hostname of the server where the share was created and <code class="literal">nfs_path</code> is the path on the server where the OVA files are stored.
								</div></dd><dt><a href="#CO19-2"><span class="callout">2</span></a> </dt><dd><div class="para">
									Specify the name of provider <code class="literal">Secret</code> CR.
								</div></dd></dl></div></li></ol></div><div class="orderedlist"><ol class="orderedlist" start="3" type="1"><li class="listitem"><p class="simpara">
							Create a <code class="literal">NetworkMap</code> manifest to map the source and destination networks:
						</p><pre class="programlisting language-yaml">$  cat &lt;&lt; EOF | oc apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: NetworkMap
metadata:
  name: &lt;network_map&gt;
  namespace: &lt;namespace&gt;
spec:
  map:
    - destination:
        name: &lt;network_name&gt;
        type: pod <span id="CO20-1"/><span class="callout">1</span>
      source:
        id: &lt;source_network_id&gt; <span id="CO20-2"/><span class="callout">2</span>
    - destination:
        name: &lt;network_attachment_definition&gt; <span id="CO20-3"/><span class="callout">3</span>
        namespace: &lt;network_attachment_definition_namespace&gt; <span id="CO20-4"/><span class="callout">4</span>
        type: multus
      source:
        id: &lt;source_network_id&gt;
  provider:
    source:
      name: &lt;source_provider&gt;
      namespace: &lt;namespace&gt;
    destination:
      name: &lt;destination_provider&gt;
      namespace: &lt;namespace&gt;
EOF</pre><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO20-1"><span class="callout">1</span></a> </dt><dd><div class="para">
									Allowed values are <code class="literal">pod</code> and <code class="literal">multus</code>.
								</div></dd><dt><a href="#CO20-2"><span class="callout">2</span></a> </dt><dd><div class="para">
									Specify the OVA network Universal Unique ID (UUID).
								</div></dd><dt><a href="#CO20-3"><span class="callout">3</span></a> </dt><dd><div class="para">
									Specify a network attachment definition for each additional OpenShift Virtualization network.
								</div></dd><dt><a href="#CO20-4"><span class="callout">4</span></a> </dt><dd><div class="para">
									Required only when <code class="literal">type</code> is <code class="literal">multus</code>. Specify the namespace of the OpenShift Virtualization network attachment definition.
								</div></dd></dl></div></li></ol></div><div class="orderedlist"><ol class="orderedlist" start="4" type="1"><li class="listitem"><p class="simpara">
							Create a <code class="literal">StorageMap</code> manifest to map source and destination storage:
						</p><pre class="programlisting language-yaml">$ cat &lt;&lt; EOF | oc apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: StorageMap
metadata:
  name: &lt;storage_map&gt;
  namespace: &lt;namespace&gt;
spec:
  map:
    - destination:
        storageClass: &lt;storage_class&gt;
        accessMode: &lt;access_mode&gt; <span id="CO21-1"/><span class="callout">1</span>
      source:
        name:  Dummy storage for source provider &lt;provider_name&gt; <span id="CO21-2"/><span class="callout">2</span>
  provider:
    source:
      name: &lt;source_provider&gt;
      namespace: &lt;namespace&gt;
    destination:
      name: &lt;destination_provider&gt;
      namespace: &lt;namespace&gt;
EOF</pre><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO21-1"><span class="callout">1</span></a> </dt><dd><div class="para">
									Allowed values are <code class="literal">ReadWriteOnce</code> and <code class="literal">ReadWriteMany</code>.
								</div></dd><dt><a href="#CO21-2"><span class="callout">2</span></a> </dt><dd><div class="para">
									For OVA, the <code class="literal">StorageMap</code> can map only a single storage, which all the disks from the OVA are associated with, to a storage class at the destination. For this reason, the storage is referred to in the UI as "Dummy storage for source provider &lt;provider_name&gt;". In the YAML, write the phrase as it appears above, without the quotation marks and replacing &lt;provider_name&gt; with the actual name of the provider.
								</div></dd></dl></div></li><li class="listitem"><p class="simpara">
							Optional: Create a <code class="literal">Hook</code> manifest to run custom code on a VM during the phase specified in the <code class="literal">Plan</code> CR:
						</p><pre class="programlisting language-yaml">$  cat &lt;&lt; EOF | oc apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: Hook
metadata:
  name: &lt;hook&gt;
  namespace: &lt;namespace&gt;
spec:
  image: quay.io/konveyor/hook-runner
  playbook: |
    LS0tCi0gbmFtZTogTWFpbgogIGhvc3RzOiBsb2NhbGhvc3QKICB0YXNrczoKICAtIG5hbWU6IExv
    YWQgUGxhbgogICAgaW5jbHVkZV92YXJzOgogICAgICBmaWxlOiAiL3RtcC9ob29rL3BsYW4ueW1s
    IgogICAgICBuYW1lOiBwbGFuCiAgLSBuYW1lOiBMb2FkIFdvcmtsb2FkCiAgICBpbmNsdWRlX3Zh
    cnM6CiAgICAgIGZpbGU6ICIvdG1wL2hvb2svd29ya2xvYWQueW1sIgogICAgICBuYW1lOiB3b3Jr
    bG9hZAoK
EOF</pre><p class="simpara">
							where:
						</p><p class="simpara">
							<code class="literal">playbook</code> refers to an optional Base64-encoded Ansible Playbook. If you specify a playbook, the <code class="literal">image</code> must be <code class="literal">hook-runner</code>.
						</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
								You can use the default <code class="literal">hook-runner</code> image or specify a custom image. If you specify a custom image, you do not have to specify a playbook.
							</p></div></div></li></ol></div><div class="orderedlist"><ol class="orderedlist" start="6" type="1"><li class="listitem"><p class="simpara">
							Create a <code class="literal">Plan</code> manifest for the migration:
						</p><pre class="programlisting language-yaml">$ cat &lt;&lt; EOF | oc apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: Plan
metadata:
  name: &lt;plan&gt; <span id="CO22-1"/><span class="callout">1</span>
  namespace: &lt;namespace&gt;
spec:
  provider:
    source:
      name: &lt;source_provider&gt;
      namespace: &lt;namespace&gt;
    destination:
      name: &lt;destination_provider&gt;
      namespace: &lt;namespace&gt;
  map: <span id="CO22-2"/><span class="callout">2</span>
    network: <span id="CO22-3"/><span class="callout">3</span>
      name: &lt;network_map&gt; <span id="CO22-4"/><span class="callout">4</span>
      namespace: &lt;namespace&gt;
    storage: <span id="CO22-5"/><span class="callout">5</span>
      name: &lt;storage_map&gt; <span id="CO22-6"/><span class="callout">6</span>
      namespace: &lt;namespace&gt;
  targetNamespace: &lt;target_namespace&gt;
  vms: <span id="CO22-7"/><span class="callout">7</span>
    - id: &lt;source_vm&gt; <span id="CO22-8"/><span class="callout">8</span>
    - name: &lt;source_vm&gt;
      hooks: <span id="CO22-9"/><span class="callout">9</span>
        - hook:
            namespace: &lt;namespace&gt;
            name: &lt;hook&gt; <span id="CO22-10"/><span class="callout">10</span>
          step: &lt;step&gt; <span id="CO22-11"/><span class="callout">11</span>
EOF</pre><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO22-1"><span class="callout">1</span></a> </dt><dd><div class="para">
									Specify the name of the <code class="literal">Plan</code> CR.
								</div></dd><dt><a href="#CO22-2"><span class="callout">2</span></a> </dt><dd><div class="para">
									Specify only one network map and one storage map per plan.
								</div></dd><dt><a href="#CO22-3"><span class="callout">3</span></a> </dt><dd><div class="para">
									Specify a network mapping, even if the VMs to be migrated are not assigned to a network. The mapping can be empty in this case.
								</div></dd><dt><a href="#CO22-4"><span class="callout">4</span></a> </dt><dd><div class="para">
									Specify the name of the <code class="literal">NetworkMap</code> CR.
								</div></dd><dt><a href="#CO22-5"><span class="callout">5</span></a> </dt><dd><div class="para">
									Specify a storage mapping even if the VMs to be migrated are not assigned with disk images. The mapping can be empty in this case.
								</div></dd><dt><a href="#CO22-6"><span class="callout">6</span></a> </dt><dd><div class="para">
									Specify the name of the <code class="literal">StorageMap</code> CR.
								</div></dd><dt><a href="#CO22-7"><span class="callout">7</span></a> </dt><dd><div class="para">
									You can use either the <code class="literal">id</code> <span class="emphasis"><em>or</em></span> the <code class="literal">name</code> parameter to specify the source VMs.
								</div></dd><dt><a href="#CO22-8"><span class="callout">8</span></a> </dt><dd><div class="para">
									Specify the OVA VM UUID.
								</div></dd><dt><a href="#CO22-9"><span class="callout">9</span></a> </dt><dd><div class="para">
									Optional: You can specify up to two hooks for a VM. Each hook must run during a separate migration step.
								</div></dd><dt><a href="#CO22-10"><span class="callout">10</span></a> </dt><dd><div class="para">
									Specify the name of the <code class="literal">Hook</code> CR.
								</div></dd><dt><a href="#CO22-11"><span class="callout">11</span></a> </dt><dd><div class="para">
									Allowed values are <code class="literal">PreHook</code>, before the migration plan starts, or <code class="literal">PostHook</code>, after the migration is complete.
								</div></dd></dl></div></li><li class="listitem"><p class="simpara">
							Create a <code class="literal">Migration</code> manifest to run the <code class="literal">Plan</code> CR:
						</p><pre class="programlisting language-yaml">$ cat &lt;&lt; EOF | oc apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: Migration
metadata:
  name: &lt;name_of_migration_cr&gt;
  namespace: &lt;namespace&gt;
spec:
  plan:
    name: &lt;name_of_plan_cr&gt;
    namespace: &lt;namespace&gt;
  cutover: &lt;optional_cutover_time&gt;
EOF</pre><div class="admonition note"><div class="admonition_header">Note</div><div><p>
								If you specify a cutover time, use the ISO 8601 format with the UTC time offset, for example, <code class="literal">2024-04-04T01:23:45.678+09:00</code>.
							</p></div></div></li></ol></div></section><section class="section" id="new-migrating-virtual-machines-cli_cnv"><div class="titlepage"><div><div><h3 class="title">5.3.5. Migrating from a Red Hat OpenShift Virtualization source provider</h3></div></div></div><p>
					You can use a Red Hat OpenShift Virtualization provider as either a source provider or as a destination provider.
				</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Create a <code class="literal">Secret</code> manifest for the source provider credentials:
						</p><pre class="programlisting language-yaml">$ cat &lt;&lt; EOF | oc apply -f -
apiVersion: v1
kind: Secret
metadata:
  name: &lt;secret&gt;
  namespace: &lt;namespace&gt;
  ownerReferences: <span id="CO23-1"/><span class="callout">1</span>
    - apiVersion: forklift.konveyor.io/v1beta1
      kind: Provider
      name: &lt;provider_name&gt;
      uid: &lt;provider_uid&gt;
  labels:
    createdForProviderType: openshift
    createdForResourceType: providers
type: Opaque
stringData:
  token: &lt;token&gt; <span id="CO23-2"/><span class="callout">2</span>
  password: &lt;password&gt; <span id="CO23-3"/><span class="callout">3</span>
  insecureSkipVerify: &lt;"true"/"false"&gt; <span id="CO23-4"/><span class="callout">4</span>
  cacert: | <span id="CO23-5"/><span class="callout">5</span>
    &lt;ca_certificate&gt;
  url: &lt;api_end_point&gt; <span id="CO23-6"/><span class="callout">6</span>
EOF</pre><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO23-1"><span class="callout">1</span></a> </dt><dd><div class="para">
									The <code class="literal">ownerReferences</code> section is optional.
								</div></dd><dt><a href="#CO23-2"><span class="callout">2</span></a> </dt><dd><div class="para">
									Specify a token for a service account with <code class="literal">cluster-admin</code> privileges. If both <code class="literal">token</code> and <code class="literal">url</code> are left blank, the local OpenShift cluster is used.
								</div></dd><dt><a href="#CO23-3"><span class="callout">3</span></a> </dt><dd><div class="para">
									Specify the user password.
								</div></dd><dt><a href="#CO23-4"><span class="callout">4</span></a> </dt><dd><div class="para">
									Specify <code class="literal">"true"</code> to skip certificate verification, specify <code class="literal">"false"</code> to verify the certificate. Defaults to <code class="literal">"false"</code> if not specified. Skipping certificate verification proceeds with an insecure migration and then the certificate is not required. Insecure migration means that the transferred data is sent over an insecure connection and potentially sensitive data could be exposed.
								</div></dd><dt><a href="#CO23-5"><span class="callout">5</span></a> </dt><dd><div class="para">
									When this field is not set and <span class="emphasis"><em>skip certificate verification</em></span> is disabled, MTV attempts to use the system CA.
								</div></dd><dt><a href="#CO23-6"><span class="callout">6</span></a> </dt><dd><div class="para">
									Specify the URL of the endpoint of the API server.
								</div></dd></dl></div></li></ol></div><div class="orderedlist"><ol class="orderedlist" start="2" type="1"><li class="listitem"><p class="simpara">
							Create a <code class="literal">Provider</code> manifest for the source provider:
						</p><pre class="programlisting language-yaml">$ cat &lt;&lt; EOF | oc apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: Provider
metadata:
  name: &lt;source_provider&gt;
  namespace: &lt;namespace&gt;
spec:
  type: openshift
  url: &lt;api_end_point&gt; <span id="CO24-1"/><span class="callout">1</span>
  secret:
    name: &lt;secret&gt; <span id="CO24-2"/><span class="callout">2</span>
    namespace: &lt;namespace&gt;
EOF</pre><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO24-1"><span class="callout">1</span></a> </dt><dd><div class="para">
									Specify the URL of the endpoint of the API server.
								</div></dd><dt><a href="#CO24-2"><span class="callout">2</span></a> </dt><dd><div class="para">
									Specify the name of provider <code class="literal">Secret</code> CR.
								</div></dd></dl></div></li></ol></div><div class="orderedlist"><ol class="orderedlist" start="3" type="1"><li class="listitem"><p class="simpara">
							Create a <code class="literal">NetworkMap</code> manifest to map the source and destination networks:
						</p><pre class="programlisting language-yaml">$  cat &lt;&lt; EOF | oc apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: NetworkMap
metadata:
  name: &lt;network_map&gt;
  namespace: &lt;namespace&gt;
spec:
  map:
    - destination:
        name: &lt;network_name&gt;
        type: pod <span id="CO25-1"/><span class="callout">1</span>
      source:
        name: &lt;network_name&gt;
        type: pod
    - destination:
        name: &lt;network_attachment_definition&gt; <span id="CO25-2"/><span class="callout">2</span>
        namespace: &lt;network_attachment_definition_namespace&gt; <span id="CO25-3"/><span class="callout">3</span>
        type: multus
      source:
        name: &lt;network_attachment_definition&gt;
        namespace: &lt;network_attachment_definition_namespace&gt;
        type: multus
  provider:
    source:
      name: &lt;source_provider&gt;
      namespace: &lt;namespace&gt;
    destination:
      name: &lt;destination_provider&gt;
      namespace: &lt;namespace&gt;
EOF</pre><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO25-1"><span class="callout">1</span></a> </dt><dd><div class="para">
									Allowed values are <code class="literal">pod</code> and <code class="literal">multus</code>.
								</div></dd><dt><a href="#CO25-2"><span class="callout">2</span></a> </dt><dd><div class="para">
									Specify a network attachment definition for each additional OpenShift Virtualization network. Specify the <code class="literal">namespace</code> either by using the <code class="literal">namespace property</code> or with a name built as follows: <code class="literal">&lt;network_namespace&gt;/&lt;network_name&gt;</code>.
								</div></dd><dt><a href="#CO25-3"><span class="callout">3</span></a> </dt><dd><div class="para">
									Required only when <code class="literal">type</code> is <code class="literal">multus</code>. Specify the namespace of the OpenShift Virtualization network attachment definition.
								</div></dd></dl></div></li></ol></div><div class="orderedlist"><ol class="orderedlist" start="4" type="1"><li class="listitem"><p class="simpara">
							Create a <code class="literal">StorageMap</code> manifest to map source and destination storage:
						</p><pre class="programlisting language-yaml">$ cat &lt;&lt; EOF | oc apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: StorageMap
metadata:
  name: &lt;storage_map&gt;
  namespace: &lt;namespace&gt;
spec:
  map:
    - destination:
        storageClass: &lt;storage_class&gt;
        accessMode: &lt;access_mode&gt; <span id="CO26-1"/><span class="callout">1</span>
      source:
        name: &lt;storage_class&gt;
  provider:
    source:
      name: &lt;source_provider&gt;
      namespace: &lt;namespace&gt;
    destination:
      name: &lt;destination_provider&gt;
      namespace: &lt;namespace&gt;
EOF</pre><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO26-1"><span class="callout">1</span></a> </dt><dd><div class="para">
									Allowed values are <code class="literal">ReadWriteOnce</code> and <code class="literal">ReadWriteMany</code>.
								</div></dd></dl></div></li><li class="listitem"><p class="simpara">
							Optional: Create a <code class="literal">Hook</code> manifest to run custom code on a VM during the phase specified in the <code class="literal">Plan</code> CR:
						</p><pre class="programlisting language-yaml">$  cat &lt;&lt; EOF | oc apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: Hook
metadata:
  name: &lt;hook&gt;
  namespace: &lt;namespace&gt;
spec:
  image: quay.io/konveyor/hook-runner
  playbook: |
    LS0tCi0gbmFtZTogTWFpbgogIGhvc3RzOiBsb2NhbGhvc3QKICB0YXNrczoKICAtIG5hbWU6IExv
    YWQgUGxhbgogICAgaW5jbHVkZV92YXJzOgogICAgICBmaWxlOiAiL3RtcC9ob29rL3BsYW4ueW1s
    IgogICAgICBuYW1lOiBwbGFuCiAgLSBuYW1lOiBMb2FkIFdvcmtsb2FkCiAgICBpbmNsdWRlX3Zh
    cnM6CiAgICAgIGZpbGU6ICIvdG1wL2hvb2svd29ya2xvYWQueW1sIgogICAgICBuYW1lOiB3b3Jr
    bG9hZAoK
EOF</pre><p class="simpara">
							where:
						</p><p class="simpara">
							<code class="literal">playbook</code> refers to an optional Base64-encoded Ansible Playbook. If you specify a playbook, the <code class="literal">image</code> must be <code class="literal">hook-runner</code>.
						</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
								You can use the default <code class="literal">hook-runner</code> image or specify a custom image. If you specify a custom image, you do not have to specify a playbook.
							</p></div></div></li></ol></div><div class="orderedlist"><ol class="orderedlist" start="6" type="1"><li class="listitem"><p class="simpara">
							Create a <code class="literal">Plan</code> manifest for the migration:
						</p><pre class="programlisting language-yaml">$ cat &lt;&lt; EOF | oc apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: Plan
metadata:
  name: &lt;plan&gt; <span id="CO27-1"/><span class="callout">1</span>
  namespace: &lt;namespace&gt;
spec:
  provider:
    source:
      name: &lt;source_provider&gt;
      namespace: &lt;namespace&gt;
    destination:
      name: &lt;destination_provider&gt;
      namespace: &lt;namespace&gt;
  map: <span id="CO27-2"/><span class="callout">2</span>
    network: <span id="CO27-3"/><span class="callout">3</span>
      name: &lt;network_map&gt; <span id="CO27-4"/><span class="callout">4</span>
      namespace: &lt;namespace&gt;
    storage: <span id="CO27-5"/><span class="callout">5</span>
      name: &lt;storage_map&gt; <span id="CO27-6"/><span class="callout">6</span>
      namespace: &lt;namespace&gt;
  targetNamespace: &lt;target_namespace&gt;
  vms:
    - name: &lt;source_vm&gt;
      namespace: &lt;namespace&gt;
      hooks: <span id="CO27-7"/><span class="callout">7</span>
        - hook:
            namespace: &lt;namespace&gt;
            name: &lt;hook&gt; <span id="CO27-8"/><span class="callout">8</span>
          step: &lt;step&gt; <span id="CO27-9"/><span class="callout">9</span>
EOF</pre><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO27-1"><span class="callout">1</span></a> </dt><dd><div class="para">
									Specify the name of the <code class="literal">Plan</code> CR.
								</div></dd><dt><a href="#CO27-2"><span class="callout">2</span></a> </dt><dd><div class="para">
									Specify only one network map and one storage map per plan.
								</div></dd><dt><a href="#CO27-3"><span class="callout">3</span></a> </dt><dd><div class="para">
									Specify a network mapping, even if the VMs to be migrated are not assigned to a network. The mapping can be empty in this case.
								</div></dd><dt><a href="#CO27-4"><span class="callout">4</span></a> </dt><dd><div class="para">
									Specify the name of the <code class="literal">NetworkMap</code> CR.
								</div></dd><dt><a href="#CO27-5"><span class="callout">5</span></a> </dt><dd><div class="para">
									Specify a storage mapping, even if the VMs to be migrated are not assigned with disk images. The mapping can be empty in this case.
								</div></dd><dt><a href="#CO27-6"><span class="callout">6</span></a> </dt><dd><div class="para">
									Specify the name of the <code class="literal">StorageMap</code> CR.
								</div></dd><dt><a href="#CO27-7"><span class="callout">7</span></a> </dt><dd><div class="para">
									Optional: You can specify up to two hooks for a VM. Each hook must run during a separate migration step.
								</div></dd><dt><a href="#CO27-8"><span class="callout">8</span></a> </dt><dd><div class="para">
									Specify the name of the <code class="literal">Hook</code> CR.
								</div></dd><dt><a href="#CO27-9"><span class="callout">9</span></a> </dt><dd><div class="para">
									Allowed values are <code class="literal">PreHook</code>, before the migration plan starts, or <code class="literal">PostHook</code>, after the migration is complete.
								</div></dd></dl></div></li><li class="listitem"><p class="simpara">
							Create a <code class="literal">Migration</code> manifest to run the <code class="literal">Plan</code> CR:
						</p><pre class="programlisting language-yaml">$ cat &lt;&lt; EOF | oc apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: Migration
metadata:
  name: &lt;name_of_migration_cr&gt;
  namespace: &lt;namespace&gt;
spec:
  plan:
    name: &lt;name_of_plan_cr&gt;
    namespace: &lt;namespace&gt;
  cutover: &lt;optional_cutover_time&gt;
EOF</pre><div class="admonition note"><div class="admonition_header">Note</div><div><p>
								If you specify a cutover time, use the ISO 8601 format with the UTC time offset, for example, <code class="literal">2024-04-04T01:23:45.678+09:00</code>.
							</p></div></div></li></ol></div></section></section><section class="section" id="canceling-migration-cli_mtv"><div class="titlepage"><div><div><h2 class="title">5.4. Canceling a migration</h2></div></div></div><p>
				You can cancel an entire migration or individual virtual machines (VMs) while a migration is in progress from the command line interface (CLI).
			</p><div class="itemizedlist"><p class="title"><strong>Canceling an entire migration</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						Delete the <code class="literal">Migration</code> CR:
					</p><pre class="programlisting language-terminal">$ oc delete migration &lt;migration&gt; -n &lt;namespace&gt; <span id="CO28-1"/><span class="callout">1</span></pre><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO28-1"><span class="callout">1</span></a> </dt><dd><div class="para">
								Specify the name of the <code class="literal">Migration</code> CR.
							</div></dd></dl></div></li></ul></div><div class="orderedlist"><p class="title"><strong>Canceling the migration of individual VMs</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Add the individual VMs to the <code class="literal">spec.cancel</code> block of the <code class="literal">Migration</code> manifest:
					</p><pre class="programlisting language-yaml">$ cat &lt;&lt; EOF | oc apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: Migration
metadata:
  name: &lt;migration&gt;
  namespace: &lt;namespace&gt;
...
spec:
  cancel:
  - id: vm-102 <span id="CO29-1"/><span class="callout">1</span>
  - id: vm-203
  - name: rhel8-vm
EOF</pre><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO29-1"><span class="callout">1</span></a> </dt><dd><div class="para">
								You can specify a VM by using the <code class="literal">id</code> key or the <code class="literal">name</code> key.
							</div></dd></dl></div><p class="simpara">
						The value of the <code class="literal">id</code> key is the <span class="emphasis"><em>managed object reference</em></span>, for a VMware VM, or the <span class="emphasis"><em>VM UUID</em></span>, for a RHV VM.
					</p></li><li class="listitem"><p class="simpara">
						Retrieve the <code class="literal">Migration</code> CR to monitor the progress of the remaining VMs:
					</p><pre class="programlisting language-terminal">$ oc get migration/&lt;migration&gt; -n &lt;namespace&gt; -o yaml</pre></li></ol></div></section></section><section class="chapter" id="advanced-migration-options_mtv"><div class="titlepage"><div><div><h1 class="title">Chapter 6. Advanced migration options</h1></div></div></div><section class="section" id="changing-precopy-intervals_mtv"><div class="titlepage"><div><div><h2 class="title">6.1. Changing precopy intervals for warm migration</h2></div></div></div><p>
				You can change the snapshot interval by patching the <code class="literal">ForkliftController</code> custom resource (CR).
			</p><div class="itemizedlist"><p class="title"><strong>Procedure</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						Patch the <code class="literal">ForkliftController</code> CR:
					</p><pre class="programlisting language-terminal">$ oc patch forkliftcontroller/&lt;forklift-controller&gt; -n openshift-mtv -p '{"spec": {"controller_precopy_interval": &lt;60&gt;}}' --type=merge <span id="CO30-1"/><span class="callout">1</span></pre><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO30-1"><span class="callout">1</span></a> </dt><dd><div class="para">
								Specify the precopy interval in minutes. The default value is <code class="literal">60</code>.
							</div></dd></dl></div><p class="simpara">
						You do not need to restart the <code class="literal">forklift-controller</code> pod.
					</p></li></ul></div></section><section class="section" id="creating-custom-rules-for-validation-service"><div class="titlepage"><div><div><h2 class="title">6.2. Creating custom rules for the Validation service</h2></div></div></div><p>
				The <code class="literal">Validation</code> service uses Open Policy Agent (OPA) policy rules to check the suitability of each virtual machine (VM) for migration. The <code class="literal">Validation</code> service generates a list of <span class="emphasis"><em>concerns</em></span> for each VM, which are stored in the <code class="literal">Provider Inventory</code> service as VM attributes. The web console displays the concerns for each VM in the provider inventory.
			</p><p>
				You can create custom rules to extend the default ruleset of the <code class="literal">Validation</code> service. For example, you can create a rule that checks whether a VM has multiple disks.
			</p><section class="section" id="about-rego-files_mtv"><div class="titlepage"><div><div><h3 class="title">6.2.1. About Rego files</h3></div></div></div><p>
					Validation rules are written in <a class="link" href="https://www.openpolicyagent.org/docs/latest/policy-language/">Rego</a>, the Open Policy Agent (OPA) native query language. The rules are stored as <code class="literal">.rego</code> files in the <code class="literal">/usr/share/opa/policies/io/konveyor/forklift/&lt;provider&gt;</code> directory of the <code class="literal">Validation</code> pod.
				</p><p>
					Each validation rule is defined in a separate <code class="literal">.rego</code> file and tests for a specific condition. If the condition evaluates as <code class="literal">true</code>, the rule adds a <code class="literal">{“category”, “label”, “assessment”}</code> hash to the <code class="literal">concerns</code>. The <code class="literal">concerns</code> content is added to the <code class="literal">concerns</code> key in the inventory record of the VM. The web console displays the content of the <code class="literal">concerns</code> key for each VM in the provider inventory.
				</p><p>
					The following <code class="literal">.rego</code> file example checks for distributed resource scheduling enabled in the cluster of a VMware VM:
				</p><div class="formalpara"><p class="title"><strong>drs_enabled.rego example</strong></p><p>
						
<pre class="programlisting language-terminal">package io.konveyor.forklift.vmware <span id="CO31-1"/><span class="callout">1</span>

has_drs_enabled {
    input.host.cluster.drsEnabled <span id="CO31-2"/><span class="callout">2</span>
}

concerns[flag] {
    has_drs_enabled
    flag := {
        "category": "Information",
        "label": "VM running in a DRS-enabled cluster",
        "assessment": "Distributed resource scheduling is not currently supported by OpenShift Virtualization. The VM can be migrated but it will not have this feature in the target environment."
    }
}</pre>
					</p></div><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO31-1"><span class="callout">1</span></a> </dt><dd><div class="para">
							Each validation rule is defined within a package. The package namespaces are <code class="literal">io.konveyor.forklift.vmware</code> for VMware and <code class="literal">io.konveyor.forklift.ovirt</code> for Red Hat Virtualization.
						</div></dd><dt><a href="#CO31-2"><span class="callout">2</span></a> </dt><dd><div class="para">
							Query parameters are based on the <code class="literal">input</code> key of the <code class="literal">Validation</code> service JSON.
						</div></dd></dl></div></section><section class="section" id="accessing-default-validation-rules_mtv"><div class="titlepage"><div><div><h3 class="title">6.2.2. Checking the default validation rules</h3></div></div></div><p>
					Before you create a custom rule, you must check the default rules of the <code class="literal">Validation</code> service to ensure that you do not create a rule that redefines an existing default value.
				</p><p>
					Example: If a default rule contains the line <code class="literal">default valid_input = false</code> and you create a custom rule that contains the line <code class="literal">default valid_input = true</code>, the <code class="literal">Validation</code> service will not start.
				</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Connect to the terminal of the <code class="literal">Validation</code> pod:
						</p><pre class="programlisting language-terminal">$ oc rsh &lt;validation_pod&gt;</pre></li><li class="listitem"><p class="simpara">
							Go to the OPA policies directory for your provider:
						</p><pre class="programlisting language-terminal">$ cd /usr/share/opa/policies/io/konveyor/forklift/&lt;provider&gt; <span id="CO32-1"/><span class="callout">1</span></pre><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO32-1"><span class="callout">1</span></a> </dt><dd><div class="para">
									Specify <code class="literal">vmware</code> or <code class="literal">ovirt</code>.
								</div></dd></dl></div></li><li class="listitem"><p class="simpara">
							Search for the default policies:
						</p><pre class="programlisting language-terminal">$ grep -R "default" *</pre></li></ol></div></section><section class="section" id="creating-validation-rule_mtv"><div class="titlepage"><div><div><h3 class="title">6.2.3. Creating a validation rule</h3></div></div></div><p>
					You create a validation rule by applying a config map custom resource (CR) containing the rule to the <code class="literal">Validation</code> service.
				</p><div class="admonition important"><div class="admonition_header">Important</div><div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								If you create a rule with the same <span class="emphasis"><em>name</em></span> as an existing rule, the <code class="literal">Validation</code> service performs an <code class="literal">OR</code> operation with the rules.
							</li><li class="listitem">
								If you create a rule that contradicts a default rule, the <code class="literal">Validation</code> service will not start.
							</li></ul></div></div></div><div class="formalpara"><p class="title"><strong>Validation rule example</strong></p><p>
						Validation rules are based on virtual machine (VM) attributes collected by the <code class="literal">Provider Inventory</code> service.
					</p></div><p>
					For example, the VMware API uses this path to check whether a VMware VM has NUMA node affinity configured: <code class="literal">MOR:VirtualMachine.config.extraConfig["numa.nodeAffinity"]</code>.
				</p><p>
					The <code class="literal">Provider Inventory</code> service simplifies this configuration and returns a testable attribute with a list value:
				</p><pre class="programlisting language-terminal">"numaNodeAffinity": [
    "0",
    "1"
],</pre><p>
					You create a <a class="link" href="https://www.openpolicyagent.org/docs/latest/policy-language/">Rego</a> query, based on this attribute, and add it to the <code class="literal">forklift-validation-config</code> config map:
				</p><pre class="programlisting language-terminal">`count(input.numaNodeAffinity) != 0`</pre><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Create a config map CR according to the following example:
						</p><pre class="programlisting language-yaml">$ cat &lt;&lt; EOF | oc apply -f -
apiVersion: v1
kind: ConfigMap
metadata:
  name: &lt;forklift-validation-config&gt;
  namespace: openshift-mtv
data:
  vmware_multiple_disks.rego: |-
    package &lt;provider_package&gt; <span id="CO33-1"/><span class="callout">1</span>

    has_multiple_disks { <span id="CO33-2"/><span class="callout">2</span>
      count(input.disks) &gt; 1
    }

    concerns[flag] {
      has_multiple_disks <span id="CO33-3"/><span class="callout">3</span>
        flag := {
          "category": "&lt;Information&gt;", <span id="CO33-4"/><span class="callout">4</span>
          "label": "Multiple disks detected",
          "assessment": "Multiple disks detected on this VM."
        }
    }
EOF</pre><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO33-1"><span class="callout">1</span></a> </dt><dd><div class="para">
									Specify the provider package name. Allowed values are <code class="literal">io.konveyor.forklift.vmware</code> for VMware and <code class="literal">io.konveyor.forklift.ovirt</code> for Red Hat Virtualization.
								</div></dd><dt><a href="#CO33-2"><span class="callout">2</span></a> </dt><dd><div class="para">
									Specify the <code class="literal">concerns</code> name and Rego query.
								</div></dd><dt><a href="#CO33-3"><span class="callout">3</span></a> </dt><dd><div class="para">
									Specify the <code class="literal">concerns</code> name and <code class="literal">flag</code> parameter values.
								</div></dd><dt><a href="#CO33-4"><span class="callout">4</span></a> </dt><dd><div class="para">
									Allowed values are <code class="literal">Critical</code>, <code class="literal">Warning</code>, and <code class="literal">Information</code>.
								</div></dd></dl></div></li><li class="listitem"><p class="simpara">
							Stop the <code class="literal">Validation</code> pod by scaling the <code class="literal">forklift-controller</code> deployment to <code class="literal">0</code>:
						</p><pre class="programlisting language-terminal">$ oc scale -n openshift-mtv --replicas=0 deployment/forklift-controller</pre></li><li class="listitem"><p class="simpara">
							Start the <code class="literal">Validation</code> pod by scaling the <code class="literal">forklift-controller</code> deployment to <code class="literal">1</code>:
						</p><pre class="programlisting language-terminal">$ oc scale -n openshift-mtv --replicas=1 deployment/forklift-controller</pre></li><li class="listitem"><p class="simpara">
							Check the <code class="literal">Validation</code> pod log to verify that the pod started:
						</p><pre class="programlisting language-terminal">$ oc logs -f &lt;validation_pod&gt;</pre><p class="simpara">
							If the custom rule conflicts with a default rule, the <code class="literal">Validation</code> pod will not start.
						</p></li><li class="listitem"><p class="simpara">
							Remove the source provider:
						</p><pre class="programlisting language-terminal">$ oc delete provider &lt;provider&gt; -n openshift-mtv</pre></li><li class="listitem"><p class="simpara">
							Add the source provider to apply the new rule:
						</p><pre class="programlisting language-yaml">$ cat &lt;&lt; EOF | oc apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: Provider
metadata:
  name: &lt;provider&gt;
  namespace: openshift-mtv
spec:
  type: &lt;provider_type&gt; <span id="CO34-1"/><span class="callout">1</span>
  url: &lt;api_end_point&gt; <span id="CO34-2"/><span class="callout">2</span>
  secret:
    name: &lt;secret&gt; <span id="CO34-3"/><span class="callout">3</span>
    namespace: openshift-mtv
EOF</pre><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO34-1"><span class="callout">1</span></a> </dt><dd><div class="para">
									Allowed values are <code class="literal">ovirt</code>, <code class="literal">vsphere</code>, and <code class="literal">openstack</code>.
								</div></dd><dt><a href="#CO34-2"><span class="callout">2</span></a> </dt><dd><div class="para">
									Specify the API end point URL, for example, <code class="literal">https://&lt;vCenter_host&gt;/sdk</code> for vSphere, <code class="literal">https://&lt;engine_host&gt;/ovirt-engine/api</code> for RHV, or <code class="literal">https://&lt;identity_service&gt;/v3</code> for OpenStack.
								</div></dd><dt><a href="#CO34-3"><span class="callout">3</span></a> </dt><dd><div class="para">
									Specify the name of the provider <code class="literal">Secret</code> CR.
								</div></dd></dl></div></li></ol></div><p>
					You must update the rules version after creating a custom rule so that the <code class="literal">Inventory</code> service detects the changes and validates the VMs.
				</p></section><section class="section" id="updating-inventory-rules-version_mtv"><div class="titlepage"><div><div><h3 class="title">6.2.4. Updating the inventory rules version</h3></div></div></div><p>
					You must update the inventory rules version each time you update the rules so that the <code class="literal">Provider Inventory</code> service detects the changes and triggers the <code class="literal">Validation</code> service.
				</p><p>
					The rules version is recorded in a <code class="literal">rules_version.rego</code> file for each provider.
				</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Retrieve the current rules version:
						</p><pre class="programlisting language-terminal">$ GET https://forklift-validation/v1/data/io/konveyor/forklift/&lt;provider&gt;/rules_version <span id="CO35-1"/><span class="callout">1</span></pre><div class="formalpara"><p class="title"><strong>Example output</strong></p><p>
								
<pre class="programlisting language-json">{
   "result": {
       "rules_version": 5
   }
}</pre>
							</p></div></li><li class="listitem"><p class="simpara">
							Connect to the terminal of the <code class="literal">Validation</code> pod:
						</p><pre class="programlisting language-terminal">$ oc rsh &lt;validation_pod&gt;</pre></li><li class="listitem">
							Update the rules version in the <code class="literal">/usr/share/opa/policies/io/konveyor/forklift/&lt;provider&gt;/rules_version.rego</code> file.
						</li><li class="listitem">
							Log out of the <code class="literal">Validation</code> pod terminal.
						</li><li class="listitem"><p class="simpara">
							Verify the updated rules version:
						</p><pre class="programlisting language-terminal">$ GET https://forklift-validation/v1/data/io/konveyor/forklift/&lt;provider&gt;/rules_version <span id="CO35-2"/><span class="callout">1</span></pre><div class="formalpara"><p class="title"><strong>Example output</strong></p><p>
								
<pre class="programlisting language-json">{
   "result": {
       "rules_version": 6
   }
}</pre>
							</p></div></li></ol></div></section></section><section class="section" id="retrieving-validation-service-json_mtv"><div class="titlepage"><div><div><h2 class="title">6.3. Retrieving the Inventory service JSON</h2></div></div></div><p>
				You retrieve the <code class="literal">Inventory</code> service JSON by sending an <code class="literal">Inventory</code> service query to a virtual machine (VM). The output contains an <code class="literal">"input"</code> key, which contains the inventory attributes that are queried by the <code class="literal">Validation</code> service rules.
			</p><p>
				You can create a validation rule based on any attribute in the <code class="literal">"input"</code> key, for example, <code class="literal">input.snapshot.kind</code>.
			</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Retrieve the routes for the project:
					</p><pre class="programlisting language-terminal">oc get route -n openshift-mtv</pre></li><li class="listitem"><p class="simpara">
						Retrieve the <code class="literal">Inventory</code> service route:
					</p><pre class="programlisting language-terminal">$ oc get route &lt;inventory_service&gt; -n openshift-mtv</pre></li><li class="listitem"><p class="simpara">
						Retrieve the access token:
					</p><pre class="programlisting language-terminal">$ TOKEN=$(oc whoami -t)</pre></li><li class="listitem"><p class="simpara">
						Trigger an HTTP GET request (for example, using Curl):
					</p><pre class="programlisting language-terminal">$ curl -H "Authorization: Bearer $TOKEN" https://&lt;inventory_service_route&gt;/providers -k</pre></li><li class="listitem"><p class="simpara">
						Retrieve the <code class="literal">UUID</code> of a provider:
					</p><pre class="programlisting language-terminal">$ curl -H "Authorization: Bearer $TOKEN"  https://&lt;inventory_service_route&gt;/providers/&lt;provider&gt; -k <span id="CO35-3"/><span class="callout">1</span></pre><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO35-1"><span class="callout">1</span></a> <a href="#CO35-2"><span class="callout">1</span></a> <a href="#CO35-3"><span class="callout">1</span></a> </dt><dd><div class="para">
								Allowed values for the provider are <code class="literal">vsphere</code>, <code class="literal">ovirt</code>, and <code class="literal">openstack</code>.
							</div></dd></dl></div></li><li class="listitem"><p class="simpara">
						Retrieve the VMs of a provider:
					</p><pre class="programlisting language-terminal">$ curl -H "Authorization: Bearer $TOKEN"  https://&lt;inventory_service_route&gt;/providers/&lt;provider&gt;/&lt;UUID&gt;/vms -k</pre></li><li class="listitem"><p class="simpara">
						Retrieve the details of a VM:
					</p><pre class="programlisting language-terminal">$ curl -H "Authorization: Bearer $TOKEN"  https://&lt;inventory_service_route&gt;/providers/&lt;provider&gt;/&lt;UUID&gt;/workloads/&lt;vm&gt; -k</pre><div class="formalpara"><p class="title"><strong>Example output</strong></p><p>
							
<pre class="programlisting language-yaml">{
    "input": {
        "selfLink": "providers/vsphere/c872d364-d62b-46f0-bd42-16799f40324e/workloads/vm-431",
        "id": "vm-431",
        "parent": {
            "kind": "Folder",
            "id": "group-v22"
        },
        "revision": 1,
        "name": "iscsi-target",
        "revisionValidated": 1,
        "isTemplate": false,
        "networks": [
            {
                "kind": "Network",
                "id": "network-31"
            },
            {
                "kind": "Network",
                "id": "network-33"
            }
        ],
        "disks": [
            {
                "key": 2000,
                "file": "[iSCSI_Datastore] iscsi-target/iscsi-target-000001.vmdk",
                "datastore": {
                    "kind": "Datastore",
                    "id": "datastore-63"
                },
                "capacity": 17179869184,
                "shared": false,
                "rdm": false
            },
            {
                "key": 2001,
                "file": "[iSCSI_Datastore] iscsi-target/iscsi-target_1-000001.vmdk",
                "datastore": {
                    "kind": "Datastore",
                    "id": "datastore-63"
                },
                "capacity": 10737418240,
                "shared": false,
                "rdm": false
            }
        ],
        "concerns": [],
        "policyVersion": 5,
        "uuid": "42256329-8c3a-2a82-54fd-01d845a8bf49",
        "firmware": "bios",
        "powerState": "poweredOn",
        "connectionState": "connected",
        "snapshot": {
            "kind": "VirtualMachineSnapshot",
            "id": "snapshot-3034"
        },
        "changeTrackingEnabled": false,
        "cpuAffinity": [
            0,
            2
        ],
        "cpuHotAddEnabled": true,
        "cpuHotRemoveEnabled": false,
        "memoryHotAddEnabled": false,
        "faultToleranceEnabled": false,
        "cpuCount": 2,
        "coresPerSocket": 1,
        "memoryMB": 2048,
        "guestName": "Red Hat Enterprise Linux 7 (64-bit)",
        "balloonedMemory": 0,
        "ipAddress": "10.19.2.96",
        "storageUsed": 30436770129,
        "numaNodeAffinity": [
            "0",
            "1"
        ],
        "devices": [
            {
                "kind": "RealUSBController"
            }
        ],
        "host": {
            "id": "host-29",
            "parent": {
                "kind": "Cluster",
                "id": "domain-c26"
            },
            "revision": 1,
            "name": "IP address or host name of the vCenter host or RHV Engine host",
            "selfLink": "providers/vsphere/c872d364-d62b-46f0-bd42-16799f40324e/hosts/host-29",
            "status": "green",
            "inMaintenance": false,
            "managementServerIp": "10.19.2.96",
            "thumbprint": &lt;thumbprint&gt;,
            "timezone": "UTC",
            "cpuSockets": 2,
            "cpuCores": 16,
            "productName": "VMware ESXi",
            "productVersion": "6.5.0",
            "networking": {
                "pNICs": [
                    {
                        "key": "key-vim.host.PhysicalNic-vmnic0",
                        "linkSpeed": 10000
                    },
                    {
                        "key": "key-vim.host.PhysicalNic-vmnic1",
                        "linkSpeed": 10000
                    },
                    {
                        "key": "key-vim.host.PhysicalNic-vmnic2",
                        "linkSpeed": 10000
                    },
                    {
                        "key": "key-vim.host.PhysicalNic-vmnic3",
                        "linkSpeed": 10000
                    }
                ],
                "vNICs": [
                    {
                        "key": "key-vim.host.VirtualNic-vmk2",
                        "portGroup": "VM_Migration",
                        "dPortGroup": "",
                        "ipAddress": "192.168.79.13",
                        "subnetMask": "255.255.255.0",
                        "mtu": 9000
                    },
                    {
                        "key": "key-vim.host.VirtualNic-vmk0",
                        "portGroup": "Management Network",
                        "dPortGroup": "",
                        "ipAddress": "10.19.2.13",
                        "subnetMask": "255.255.255.128",
                        "mtu": 1500
                    },
                    {
                        "key": "key-vim.host.VirtualNic-vmk1",
                        "portGroup": "Storage Network",
                        "dPortGroup": "",
                        "ipAddress": "172.31.2.13",
                        "subnetMask": "255.255.0.0",
                        "mtu": 1500
                    },
                    {
                        "key": "key-vim.host.VirtualNic-vmk3",
                        "portGroup": "",
                        "dPortGroup": "dvportgroup-48",
                        "ipAddress": "192.168.61.13",
                        "subnetMask": "255.255.255.0",
                        "mtu": 1500
                    },
                    {
                        "key": "key-vim.host.VirtualNic-vmk4",
                        "portGroup": "VM_DHCP_Network",
                        "dPortGroup": "",
                        "ipAddress": "10.19.2.231",
                        "subnetMask": "255.255.255.128",
                        "mtu": 1500
                    }
                ],
                "portGroups": [
                    {
                        "key": "key-vim.host.PortGroup-VM Network",
                        "name": "VM Network",
                        "vSwitch": "key-vim.host.VirtualSwitch-vSwitch0"
                    },
                    {
                        "key": "key-vim.host.PortGroup-Management Network",
                        "name": "Management Network",
                        "vSwitch": "key-vim.host.VirtualSwitch-vSwitch0"
                    },
                    {
                        "key": "key-vim.host.PortGroup-VM_10G_Network",
                        "name": "VM_10G_Network",
                        "vSwitch": "key-vim.host.VirtualSwitch-vSwitch1"
                    },
                    {
                        "key": "key-vim.host.PortGroup-VM_Storage",
                        "name": "VM_Storage",
                        "vSwitch": "key-vim.host.VirtualSwitch-vSwitch1"
                    },
                    {
                        "key": "key-vim.host.PortGroup-VM_DHCP_Network",
                        "name": "VM_DHCP_Network",
                        "vSwitch": "key-vim.host.VirtualSwitch-vSwitch1"
                    },
                    {
                        "key": "key-vim.host.PortGroup-Storage Network",
                        "name": "Storage Network",
                        "vSwitch": "key-vim.host.VirtualSwitch-vSwitch1"
                    },
                    {
                        "key": "key-vim.host.PortGroup-VM_Isolated_67",
                        "name": "VM_Isolated_67",
                        "vSwitch": "key-vim.host.VirtualSwitch-vSwitch2"
                    },
                    {
                        "key": "key-vim.host.PortGroup-VM_Migration",
                        "name": "VM_Migration",
                        "vSwitch": "key-vim.host.VirtualSwitch-vSwitch2"
                    }
                ],
                "switches": [
                    {
                        "key": "key-vim.host.VirtualSwitch-vSwitch0",
                        "name": "vSwitch0",
                        "portGroups": [
                            "key-vim.host.PortGroup-VM Network",
                            "key-vim.host.PortGroup-Management Network"
                        ],
                        "pNICs": [
                            "key-vim.host.PhysicalNic-vmnic4"
                        ]
                    },
                    {
                        "key": "key-vim.host.VirtualSwitch-vSwitch1",
                        "name": "vSwitch1",
                        "portGroups": [
                            "key-vim.host.PortGroup-VM_10G_Network",
                            "key-vim.host.PortGroup-VM_Storage",
                            "key-vim.host.PortGroup-VM_DHCP_Network",
                            "key-vim.host.PortGroup-Storage Network"
                        ],
                        "pNICs": [
                            "key-vim.host.PhysicalNic-vmnic2",
                            "key-vim.host.PhysicalNic-vmnic0"
                        ]
                    },
                    {
                        "key": "key-vim.host.VirtualSwitch-vSwitch2",
                        "name": "vSwitch2",
                        "portGroups": [
                            "key-vim.host.PortGroup-VM_Isolated_67",
                            "key-vim.host.PortGroup-VM_Migration"
                        ],
                        "pNICs": [
                            "key-vim.host.PhysicalNic-vmnic3",
                            "key-vim.host.PhysicalNic-vmnic1"
                        ]
                    }
                ]
            },
            "networks": [
                {
                    "kind": "Network",
                    "id": "network-31"
                },
                {
                    "kind": "Network",
                    "id": "network-34"
                },
                {
                    "kind": "Network",
                    "id": "network-57"
                },
                {
                    "kind": "Network",
                    "id": "network-33"
                },
                {
                    "kind": "Network",
                    "id": "dvportgroup-47"
                }
            ],
            "datastores": [
                {
                    "kind": "Datastore",
                    "id": "datastore-35"
                },
                {
                    "kind": "Datastore",
                    "id": "datastore-63"
                }
            ],
            "vms": null,
            "networkAdapters": [],
            "cluster": {
                "id": "domain-c26",
                "parent": {
                    "kind": "Folder",
                    "id": "group-h23"
                },
                "revision": 1,
                "name": "mycluster",
                "selfLink": "providers/vsphere/c872d364-d62b-46f0-bd42-16799f40324e/clusters/domain-c26",
                "folder": "group-h23",
                "networks": [
                    {
                        "kind": "Network",
                        "id": "network-31"
                    },
                    {
                        "kind": "Network",
                        "id": "network-34"
                    },
                    {
                        "kind": "Network",
                        "id": "network-57"
                    },
                    {
                        "kind": "Network",
                        "id": "network-33"
                    },
                    {
                        "kind": "Network",
                        "id": "dvportgroup-47"
                    }
                ],
                "datastores": [
                    {
                        "kind": "Datastore",
                        "id": "datastore-35"
                    },
                    {
                        "kind": "Datastore",
                        "id": "datastore-63"
                    }
                ],
                "hosts": [
                    {
                        "kind": "Host",
                        "id": "host-44"
                    },
                    {
                        "kind": "Host",
                        "id": "host-29"
                    }
                ],
                "dasEnabled": false,
                "dasVms": [],
                "drsEnabled": true,
                "drsBehavior": "fullyAutomated",
                "drsVms": [],
                "datacenter": null
            }
        }
    }
}</pre>
						</p></div></li></ol></div></section><section class="section" id="adding-hooks-migration-plan-using-api"><div class="titlepage"><div><div><h2 class="title">6.4. Adding hooks to a migration plan</h2></div></div></div><p>
				You can add hooks a migration plan from the command line by using the Migration Toolkit for Virtualization API.
			</p><section class="section" id="about-api-hooks-in-migration-plans_mtv"><div class="titlepage"><div><div><h3 class="title">6.4.1. API-based hooks for MTV migration plans</h3></div></div></div><p>
					You can add hooks to a migration plan from the command line by using the Migration Toolkit for Virtualization API.
				</p><h5 id="default_hook_image">Default hook image</h5><p>
					The default hook image for an MTV hook is <code class="literal">registry.redhat.io/rhmtc/openshift-migration-hook-runner-rhel8:v1.8.2-2</code>. The image is based on the Ansible Runner image with the addition of <code class="literal">python-openshift</code> to provide Ansible Kubernetes resources and a recent <code class="literal">oc</code> binary.
				</p><h5 id="hook_execution">Hook execution</h5><p>
					An Ansible playbook that is provided as part of a migration hook is mounted into the hook container as a <code class="literal">ConfigMap</code>. The hook container is run as a job on the desired cluster, using the default <code class="literal">ServiceAccount</code> in the <code class="literal">konveyor-forklift</code> namespace.
				</p><h5 id="prehooks_and_posthooks">PreHooks and PostHooks</h5><p>
					You specify hooks per VM and you can run each as a <span class="emphasis"><em>PreHook</em></span> or a <span class="emphasis"><em>PostHook</em></span>. In this context, a PreHook is a hook that is run before a migration and a PostHook is a hook that is run after a migration.
				</p><p>
					When you add a hook, you must specify the namespace where the hook CR is located, the name of the hook, and specify whether the hook is a PreHook or PostHook.
				</p><div class="admonition important"><div class="admonition_header">Important</div><div><p>
						In order for a PreHook to run on a VM, the VM must be started and available via SSH.
					</p></div></div><div class="formalpara"><p class="title"><strong>Example PreHook:</strong></p><p>
						
<pre class="programlisting language-yaml">kind: Plan
apiVersion: forklift.konveyor.io/v1beta1
metadata:
  name: test
  namespace: konveyor-forklift
spec:
  vms:
    - id: vm-2861
      hooks:
        - hook:
            namespace: konveyor-forklift
            name: playbook
          step: PreHook</pre>
					</p></div></section><section class="section" id="adding-hook-crs-migration-plans-api_mtv"><div class="titlepage"><div><div><h3 class="title">6.4.2. Adding Hook CRs to a VM migration by using the MTV API</h3></div></div></div><p>
					You can add a <code class="literal">PreHook</code> or a <code class="literal">PostHook</code> Hook CR when you migrate a virtual machine from the command line by using the Migration Toolkit for Virtualization API. A <code class="literal">PreHook</code> runs before a migration, a <code class="literal">PostHook</code>, after.
				</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
						You can retrieve additional information stored in a secret or in a <code class="literal">configMap</code> by using a <code class="literal">k8s</code> module.
					</p></div></div><p>
					For example, you can create a hook CR to install <code class="literal">cloud-init</code> on a VM and write a file before migration.
				</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							If needed, create a secret with an SSH private key for the VM. You can either use an existing key or generate a key pair, install the public key on the VM, and base64 encode the private key in the secret.
						</p><pre class="programlisting language-yaml">apiVersion: v1
data:
  key: VGhpcyB3YXMgZ2VuZXJhdGVkIHdpdGggc3NoLWtleWdlbiBwdXJlbHkgZm9yIHRoaXMgZXhhbXBsZS4KSXQgaXMgbm90IHVzZWQgYW55d2hlcmUuCi0tLS0tQkVHSU4gT1BFTlNTSCBQUklWQVRFIEtFWS0tLS0tCmIzQmxibk56YUMxclpYa3RkakVBQUFBQUJHNXZibVVBQUFBRWJtOXVaUUFBQUFBQUFBQUJBQUFCbHdBQUFBZHpjMmd0Y24KTmhBQUFBQXdFQUFRQUFBWUVBMzVTTFRReDBFVjdPTWJQR0FqcEsxK2JhQURTTVFuK1NBU2pyTGZLNWM5NGpHdzhDbnA4LwovRHErZHFBR1pxQkg2ZnAxYmVJM1BZZzVWVDk0RVdWQ2RrTjgwY3dEcEo0Z1R0NHFUQ1gzZUYvY2x5VXQyUC9zaTNjcnQ0CjBQdi9wVnZXU1U2TlhHaDJIZC93V0MwcGh5Z0RQOVc5SHRQSUF0OFpnZmV2ZnUwZHpraVl6OHNVaElWU2ZsRGpaNUFqcUcKUjV2TVVUaGlrczEvZVlCeTdiMkFFSEdzYU8xN3NFbWNiYUlHUHZuUFVwWmQrdjkyYU1JdWZoYjhLZkFSbzZ3Ty9ISW1VbQovdDdHWFBJUmxBMUhSV0p1U05odTQzZS9DY3ZYd3Z6RnZrdE9kYXlEQzBMTklHMkpVaURlNWd0UUQ1WHZXc1p3MHQvbEs1CklacjFrZXZRNUJsYWNISmViV1ZNYUQvdllpdFdhSFo4OEF1Y0czaGh2bjkrOGNSTGhNVExiVlFSMWh2UVpBL1JtQXN3eE0KT3VJSmRaUmtxTThLZlF4Z28zQThRNGJhQW1VbnpvM3Zwa0FWdC9uaGtIOTRaRE5rV2U2RlRhdThONStyYTJCZkdjZVA4VApvbjFEeTBLRlpaUlpCREVVRVc0eHdTYUVOYXQ3c2RDNnhpL1d5OURaQUFBRm1NRFBXeDdBejFzZUFBQUFCM056YUMxeWMyCkVBQUFHQkFOK1VpMDBNZEJGZXpqR3p4Z0k2U3RmbTJnQTBqRUova2dFbzZ5M3l1WFBlSXhzUEFwNmZQL3c2dm5hZ0JtYWcKUituNmRXM2lOejJJT1ZVL2VCRmxRblpEZk5ITUE2U2VJRTdlS2t3bDkzaGYzSmNsTGRqLzdJdDNLN2VORDcvNlZiMWtsTwpqVnhvZGgzZjhGZ3RLWWNvQXovVnZSN1R5QUxmR1lIM3IzN3RIYzVJbU0vTEZJU0ZVbjVRNDJlUUk2aGtlYnpGRTRZcExOCmYzbUFjdTI5Z0JCeHJHanRlN0JKbkcyaUJqNzV6MUtXWGZyL2RtakNMbjRXL0Nud0VhT3NEdnh5SmxKdjdleGx6eUVaUU4KUjBWaWJrallidU4zdnduTDE4TDh4YjVMVG5Xc2d3dEN6U0J0aVZJZzN1WUxVQStWNzFyR2NOTGY1U3VTR2E5WkhyME9RWgpXbkJ5WG0xbFRHZy83MklyVm1oMmZQQUxuQnQ0WWI1L2Z2SEVTNFRFeTIxVUVkWWIwR1FQMFpnTE1NVERyaUNYV1VaS2pQCkNuME1ZS053UEVPRzJnSmxKODZONzZaQUZiZjU0WkIvZUdRelpGbnVoVTJydkRlZnEydGdYeG5Iai9FNko5UTh0Q2hXV1UKV1FReEZCRnVNY0VtaERXcmU3SFF1c1l2MXN2UTJRQUFBQU1CQUFFQUFBR0JBSlZtZklNNjdDQmpXcU9KdnFua2EvakRrUwo4TDdpSE5mekg1TnRZWVdPWmRMTlk2L0lRa1pDeFcwTWtSKzlUK0M3QUZKZzBNV2Q5ck5PeUxJZDkxNjZoOVJsNG0xdFJjCnViZ1o2dWZCZ3hGVDlXS21mSEdCNm4zelh5b2pQOEFJTnR6ODVpaUVHVXFFRWtVRVdMd0RGSmdvcFllQ3l1VmZ2ZE92MUgKRm1WWmEwNVo0b3NQNkNENXVmc2djQ1RYQTR6VnZ5ZHVCYkxqdHN5RjdYZjNUdjZUQ1QxU0swZHErQk1OOXRvb0RZaXpwagpzbDh6NzlybXp3eUFyWFlVcnFUUkpsNmpwRkNrWHJLcy9LeG96MHhhbXlMY2RORk9hWE51LzlnTkpjRERsV2hPcFRqNHk4CkpkNXBuV1Jueis1RHJLRFdhY0loUW1CMUxVd2ZLWmQwbVFxaUpzMUMxcXZVUmlKOGExaThKUTI4bHFuWTFRRk9wbk13emcKWEpla2FndThpT1ExRFJlQkhaM0NkcVJUYnY3bVJZSGxramx0dXJmZGc4M3hvM0ErZ1JSR001eUVOcW5xSkplQjhJQVB5UwptMFp0dGdqbHNqNTJ2K1B1NmExMHoxZndKK1VML2N6dTRKeEpOYlp6WTFIMnpLODJBaVI1T3JYNmx2aUEvSWFSRVcwUUFBCkFNQndVeUJpcUc5bEZCUnltL2UvU1VORVMzdHpicUZNdTdIcy84WTV5SnAxKzR6OXUxNGtJR2ttV0Y5eE5HT3hrY3V0cWwKeHVUcndMbjFUaFNQTHQrTjUwTGhVdzR4ZjBhNUxqemdPbklPU0FRbm5HY1Nxa0dTRDlMR21obGE2WmpydFBHY29lQ3JHdAo5M1Vvcmx5YkxNRzFFRFAxWmpKS1RaZzl6OUMwdDlTTGd3ei9DbFhydW9UNXNQVUdKWnUrbHlIZXpSTDRtcHl6OEZMcnlOCkdNci9leVM5bWdISjNVVkZEYjNIZ3BaK1E1SUdBRU5rZVZEcHIwMGhCZXZndGd6YWtBQUFEQkFQVXQ1RitoMnBVby94V1YKenRkcVQvMzA4dFB5MXVMMU1lWFoydEJPQmRwSDJyd0JzdWt0aTIySGtWZUZXQjJFdUlFUXppMzY3MGc1UGdxR1p4Vng4dQpobEE0Rkg4ZXN1NTNQckZqVW9EeFJhb3d3WXBFcFh5Y2pnNUE1MStwR1VQcWljWjB0YjliaWlhc3BWWXZhWW5sdGlnVG5iClN0UExMY29nemNiL0dGcVYyaXlzc3lwTlMwKzBNRTUxcEtxWGNaS2swbi8vVHpZWWs4TW8vZzRsQ3pmUEZQUlZrVVM5blIKWU1pQzRlcEk0TERmbVdnM0xLQ2N1Zk85all3aWgwYlFBQUFNRUE2WEtldDhEMHNvc0puZVh5WFZGd0dyVyszNlhBVGRQTwpMWDdjaStjYzFoOGV1eHdYQWx3aTJJNFhxSmJBVjBsVEhuVGEycXN3Uy9RQlpJUUJWSkZlVjVyS1daZTc4R2F3d1pWTFZNCldETmNwdFFyRTFaM2pGNS9TdUVzdlVxSDE0Tkc5RUFXWG1iUkNzelE0Vlk3NzQrSi9sTFkvMnlDT1diNzlLYTJ5OGxvYUoKVXczWWVtSld3blp2R3hKNldsL3BmQ2xYN3lEVXlXUktLdGl0cWNjbmpCWVkyRE1tZURwdURDYy9ZdDZDc3dLRmRkMkJ1UwpGZGt5cDlZY3VMaDlLZEFBQUFIR3BoYzI5dVFFRlVMVGd3TWxVdWJXOXVkR3hsYjI0dWFXNTBjbUVCQWdNRUJRWT0KLS0tLS1FTkQgT1BFTlNTSCBQUklWQVRFIEtFWS0tLS0tCgo=
kind: Secret
metadata:
  name: ssh-credentials
  namespace: konveyor-forklift
type: Opaque</pre></li><li class="listitem"><p class="simpara">
							Encode your playbook by conncatenating a file and piping it for base64, for example:
						</p><pre class="programlisting language-shell">$ cat playbook.yml | base64 -w0</pre><div class="admonition note"><div class="admonition_header">Note</div><div><p>
								You can also use a here document to encode a playbook:
							</p><pre class="programlisting language-shell">$ cat &lt;&lt; EOF | base64 -w0
- hosts: localhost
  tasks:
  - debug:
      msg: test
EOF</pre></div></div></li><li class="listitem"><p class="simpara">
							Create a Hook CR:
						</p><pre class="programlisting language-yaml">apiVersion: forklift.konveyor.io/v1beta1
kind: Hook
metadata:
  name: playbook
  namespace: konveyor-forklift
spec:
  image: registry.redhat.io/rhmtc/openshift-migration-hook-runner-rhel8:v1.8.2-2
  playbook: LSBuYW1lOiBNYWluCiAgaG9zdHM6IGxvY2FsaG9zdAogIHRhc2tzOgogIC0gbmFtZTogTG9hZCBQbGFuCiAgICBpbmNsdWRlX3ZhcnM6CiAgICAgIGZpbGU6IHBsYW4ueW1sCiAgICAgIG5hbWU6IHBsYW4KCiAgLSBuYW1lOiBMb2FkIFdvcmtsb2FkCiAgICBpbmNsdWRlX3ZhcnM6CiAgICAgIGZpbGU6IHdvcmtsb2FkLnltbAogICAgICBuYW1lOiB3b3JrbG9hZAoKICAtIG5hbWU6IAogICAgZ2V0ZW50OgogICAgICBkYXRhYmFzZTogcGFzc3dkCiAgICAgIGtleTogInt7IGFuc2libGVfdXNlcl9pZCB9fSIKICAgICAgc3BsaXQ6ICc6JwoKICAtIG5hbWU6IEVuc3VyZSBTU0ggZGlyZWN0b3J5IGV4aXN0cwogICAgZmlsZToKICAgICAgcGF0aDogfi8uc3NoCiAgICAgIHN0YXRlOiBkaXJlY3RvcnkKICAgICAgbW9kZTogMDc1MAogICAgZW52aXJvbm1lbnQ6CiAgICAgIEhPTUU6ICJ7eyBhbnNpYmxlX2ZhY3RzLmdldGVudF9wYXNzd2RbYW5zaWJsZV91c2VyX2lkXVs0XSB9fSIKCiAgLSBrOHNfaW5mbzoKICAgICAgYXBpX3ZlcnNpb246IHYxCiAgICAgIGtpbmQ6IFNlY3JldAogICAgICBuYW1lOiBzc2gtY3JlZGVudGlhbHMKICAgICAgbmFtZXNwYWNlOiBrb252ZXlvci1mb3JrbGlmdAogICAgcmVnaXN0ZXI6IHNzaF9jcmVkZW50aWFscwoKICAtIG5hbWU6IENyZWF0ZSBTU0gga2V5CiAgICBjb3B5OgogICAgICBkZXN0OiB+Ly5zc2gvaWRfcnNhCiAgICAgIGNvbnRlbnQ6ICJ7eyBzc2hfY3JlZGVudGlhbHMucmVzb3VyY2VzWzBdLmRhdGEua2V5IHwgYjY0ZGVjb2RlIH19IgogICAgICBtb2RlOiAwNjAwCgogIC0gYWRkX2hvc3Q6CiAgICAgIG5hbWU6ICJ7eyB3b3JrbG9hZC52bS5pcGFkZHJlc3MgfX0iCiAgICAgIGFuc2libGVfdXNlcjogcm9vdAogICAgICBncm91cHM6IHZtcwoKLSBob3N0czogdm1zCiAgdGFza3M6CiAgLSBuYW1lOiBJbnN0YWxsIGNsb3VkLWluaXQKICAgIGRuZjoKICAgICAgbmFtZToKICAgICAgLSBjbG91ZC1pbml0CiAgICAgIHN0YXRlOiBsYXRlc3QKCiAgLSBuYW1lOiBDcmVhdGUgVGVzdCBGaWxlCiAgICBjb3B5OgogICAgICBkZXN0OiAvdGVzdC50eHQKICAgICAgY29udGVudDogIkhlbGxvIFdvcmxkIgogICAgICBtb2RlOiAwNjQ0Cg==
  serviceAccount: forklift-controller <span id="CO36-1"/><span class="callout">1</span></pre><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO36-1"><span class="callout">1</span></a> </dt><dd><div class="para">
									Specify a <code class="literal">serviceAccount</code> to run the hook with in order to control access to resources on the cluster.
								</div></dd></dl></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
								To decode an attached playbook retrieve the resource with custom output and pipe it to base64. For example:
							</p><pre class="programlisting language-shell"> oc get -n konveyor-forklift hook playbook -o \
   go-template='{{ .spec.playbook }}' | base64 -d</pre></div></div><p class="simpara">
							The playbook encoded here runs the following:
						</p><pre class="programlisting language-yaml">- name: Main
  hosts: localhost
  tasks:
  - name: Load Plan
    include_vars:
      file: plan.yml
      name: plan

  - name: Load Workload
    include_vars:
      file: workload.yml
      name: workload

  - name:
    getent:
      database: passwd
      key: "{{ ansible_user_id }}"
      split: ':'

  - name: Ensure SSH directory exists
    file:
      path: ~/.ssh
      state: directory
      mode: 0750
    environment:
      HOME: "{{ ansible_facts.getent_passwd[ansible_user_id][4] }}"

  - k8s_info:
      api_version: v1
      kind: Secret
      name: ssh-credentials
      namespace: konveyor-forklift
    register: ssh_credentials

  - name: Create SSH key
    copy:
      dest: ~/.ssh/id_rsa
      content: "{{ ssh_credentials.resources[0].data.key | b64decode }}"
      mode: 0600

  - add_host:
      name: "{{ workload.vm.ipaddress }}"
      ansible_user: root
      groups: vms

- hosts: vms
  tasks:
  - name: Install cloud-init
    dnf:
      name:
      - cloud-init
      state: latest

  - name: Create Test File
    copy:
      dest: /test.txt
      content: "Hello World"
      mode: 0644</pre></li><li class="listitem"><p class="simpara">
							Create a Plan CR using the hook:
						</p><pre class="programlisting language-yaml">kind: Plan
apiVersion: forklift.konveyor.io/v1beta1
metadata:
  name: test
  namespace: konveyor-forklift
spec:
  map:
    network:
      namespace: "konveyor-forklift"
      name: "network"
    storage:
      namespace: "konveyor-forklift"
      name: "storage"
  provider:
    source:
      namespace: "konveyor-forklift"
      name: "boston"
    destination:
      namespace: "konveyor-forklift"
      name: host
  targetNamespace: "konveyor-forklift"
  vms:
    - id: vm-2861
      hooks:
        - hook:
            namespace: konveyor-forklift
            name: playbook
          step: PreHook <span id="CO37-1"/><span class="callout">1</span></pre><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO37-1"><span class="callout">1</span></a> </dt><dd><div class="para">
									Options are <code class="literal">PreHook</code>, to run the hook before the migration, and <code class="literal">PostHook</code>, to run the hook after the migration.
								</div></dd></dl></div></li></ol></div><div class="admonition important"><div class="admonition_header">Important</div><div><p>
						In order for a PreHook to run on a VM, the VM must be started and available via SSH.
					</p></div></div></section></section></section><section class="chapter" id="upgrading-mtv-ui_mtv"><div class="titlepage"><div><div><h1 class="title">Chapter 7. Upgrading the Migration Toolkit for Virtualization</h1></div></div></div><p>
			You can upgrade the MTV Operator by using the Red Hat OpenShift web console to install the new version.
		</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
					In the Red Hat OpenShift web console, click <span class="strong strong"><strong>Operators</strong></span> → <span class="strong strong"><strong>Installed Operators</strong></span> → <span class="strong strong"><strong>Migration Toolkit for Virtualization Operator</strong></span> → <span class="strong strong"><strong>Subscription</strong></span>.
				</li><li class="listitem"><p class="simpara">
					Change the update channel to the correct release.
				</p><p class="simpara">
					See <a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.14/html/operators/administrator-tasks#olm-changing-update-channel_olm-upgrading-operators">Changing update channel</a> in the Red Hat OpenShift documentation.
				</p></li><li class="listitem"><p class="simpara">
					Confirm that <span class="strong strong"><strong>Upgrade status</strong></span> changes from <span class="strong strong"><strong>Up to date</strong></span> to <span class="strong strong"><strong>Upgrade available</strong></span>. If it does not, restart the <code class="literal">CatalogSource</code> pod:
				</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
							Note the catalog source, for example, <code class="literal">redhat-operators</code>.
						</li><li class="listitem"><p class="simpara">
							From the command line, retrieve the catalog source pod:
						</p><pre class="programlisting language-terminal">$ oc get pod -n openshift-marketplace | grep &lt;catalog_source&gt;</pre></li><li class="listitem"><p class="simpara">
							Delete the pod:
						</p><pre class="programlisting language-terminal">$ oc delete pod -n openshift-marketplace &lt;catalog_source_pod&gt;</pre><p class="simpara">
							<span class="strong strong"><strong>Upgrade status</strong></span> changes from <span class="strong strong"><strong>Up to date</strong></span> to <span class="strong strong"><strong>Upgrade available</strong></span>.
						</p><p class="simpara">
							If you set <span class="strong strong"><strong>Update approval</strong></span> on the <span class="strong strong"><strong>Subscriptions</strong></span> tab to <span class="strong strong"><strong>Automatic</strong></span>, the upgrade starts automatically.
						</p></li></ol></div></li><li class="listitem"><p class="simpara">
					If you set <span class="strong strong"><strong>Update approval</strong></span> on the <span class="strong strong"><strong>Subscriptions</strong></span> tab to <span class="strong strong"><strong>Manual</strong></span>, approve the upgrade.
				</p><p class="simpara">
					See <a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.14/html/operators/administrator-tasks#olm-approving-pending-upgrade_olm-upgrading-operators">Manually approving a pending upgrade</a> in the Red Hat OpenShift documentation.
				</p></li><li class="listitem">
					If you are upgrading from MTV 2.2 and have defined VMware source providers, edit the VMware provider by adding a VDDK <code class="literal">init</code> image. Otherwise, the update will change the state of any VMware providers to <code class="literal">Critical</code>. For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/migration_toolkit_for_virtualization/2.4/html/installing_and_using_the_migration_toolkit_for_virtualization/migrating-vms-web-console#adding-source-provider_vmware">Adding a VMSphere source provider</a>.
				</li><li class="listitem">
					If you mapped to NFS on the Red Hat OpenShift destination provider in MTV 2.2, edit the <code class="literal">AccessModes</code> and <code class="literal">VolumeMode</code> parameters in the NFS storage profile. Otherwise, the upgrade will invalidate the NFS mapping. For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.9/html-single/virtualization/index#virt-customizing-storage-profile_virt-creating-data-volumes">Customizing the storage profile</a>.
				</li></ol></div></section><section class="chapter" id="uninstalling-mtv_mtv"><div class="titlepage"><div><div><h1 class="title">Chapter 8. Uninstalling the Migration Toolkit for Virtualization</h1></div></div></div><p>
			You can uninstall the Migration Toolkit for Virtualization (MTV) by using the Red Hat OpenShift web console or the command line interface (CLI).
		</p><section class="section" id="uninstalling-mtv-ui_mtv"><div class="titlepage"><div><div><h2 class="title">8.1. Uninstalling MTV by using the Red Hat OpenShift web console</h2></div></div></div><p>
				You can uninstall Migration Toolkit for Virtualization (MTV) by using the Red Hat OpenShift web console to delete the <code class="literal">openshift-mtv</code> project and custom resource definitions (CRDs).
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						You must be logged in as a user with <code class="literal">cluster-admin</code> privileges.
					</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
						Click <span class="strong strong"><strong>Home</strong></span> → <span class="strong strong"><strong>Projects</strong></span>.
					</li><li class="listitem">
						Locate the <span class="strong strong"><strong>openshift-mtv</strong></span> project.
					</li><li class="listitem">
						On the right side of the project, select <span class="strong strong"><strong>Delete Project</strong></span> from the Options menu 
						<span class="inlinemediaobject"><img src="images/modules/images/kebab.png" height="20" alt="kebab"/></span>
						.
					</li><li class="listitem">
						In the <span class="strong strong"><strong>Delete Project</strong></span> pane, enter the project name and click <span class="strong strong"><strong>Delete</strong></span>.
					</li><li class="listitem">
						Click <span class="strong strong"><strong>Administration</strong></span> → <span class="strong strong"><strong>CustomResourceDefinitions</strong></span>.
					</li><li class="listitem">
						Enter <code class="literal">forklift</code> in the <span class="strong strong"><strong>Search</strong></span> field to locate the CRDs in the <code class="literal">forklift.konveyor.io</code> group.
					</li><li class="listitem">
						On the right side of each CRD, select <span class="strong strong"><strong>Delete CustomResourceDefinition</strong></span> from the Options menu 
						<span class="inlinemediaobject"><img src="images/modules/images/kebab.png" height="20" alt="kebab"/></span>
						.
					</li></ol></div></section><section class="section" id="uninstalling-mtv-cli_mtv"><div class="titlepage"><div><div><h2 class="title">8.2. Uninstalling MTV from the command line interface</h2></div></div></div><p>
				You can uninstall Migration Toolkit for Virtualization (MTV) from the command line interface (CLI) by deleting the <code class="literal">openshift-mtv</code> project and the <code class="literal">forklift.konveyor.io</code> custom resource definitions (CRDs).
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						You must be logged in as a user with <code class="literal">cluster-admin</code> privileges.
					</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Delete the project:
					</p><pre class="programlisting language-terminal">$ oc delete project openshift-mtv</pre></li><li class="listitem"><p class="simpara">
						Delete the CRDs:
					</p><pre class="programlisting language-terminal">$ oc get crd -o name | grep 'forklift' | xargs oc delete</pre></li><li class="listitem"><p class="simpara">
						Delete the OAuthClient:
					</p><pre class="programlisting language-terminal">$ oc delete oauthclient/forklift-ui</pre></li></ol></div></section></section><section class="chapter" id="troubleshooting_mtv"><div class="titlepage"><div><div><h1 class="title">Chapter 9. Troubleshooting</h1></div></div></div><p>
			This section provides information for troubleshooting common migration issues.
		</p><section class="section" id="error-messages_mtv"><div class="titlepage"><div><div><h2 class="title">9.1. Error messages</h2></div></div></div><p>
				This section describes error messages and how to resolve them.
			</p><div class="formalpara"><p class="title"><strong>warm import retry limit reached</strong></p><p>
					The <code class="literal">warm import retry limit reached</code> error message is displayed during a warm migration if a VMware virtual machine (VM) has reached the maximum number (28) of changed block tracking (CBT) snapshots during the precopy stage.
				</p></div><p>
				To resolve this problem, delete some of the CBT snapshots from the VM and restart the migration plan.
			</p><div class="formalpara"><p class="title"><strong>Unable to resize disk image to required size</strong></p><p>
					The <code class="literal">Unable to resize disk image to required size</code> error message is displayed when migration fails because a virtual machine on the target provider uses persistent volumes with an EXT4 file system on block storage. The problem occurs because the default overhead that is assumed by CDI does not completely include the reserved place for the root partition.
				</p></div><p>
				To resolve this problem, increase the file system overhead in CDI to more than 10%.
			</p></section><section class="section" id="using-must-gather_mtv"><div class="titlepage"><div><div><h2 class="title">9.2. Using the must-gather tool</h2></div></div></div><p>
				You can collect logs and information about MTV custom resources (CRs) by using the <code class="literal">must-gather</code> tool. You must attach a <code class="literal">must-gather</code> data file to all customer cases.
			</p><p>
				You can gather data for a specific namespace, migration plan, or virtual machine (VM) by using the filtering options.
			</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					If you specify a non-existent resource in the filtered <code class="literal">must-gather</code> command, no archive file is created.
				</p></div></div><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						You must be logged in to the OpenShift Virtualization cluster as a user with the <code class="literal">cluster-admin</code> role.
					</li><li class="listitem">
						You must have the <a class="link" href="https://docs.openshift.com/container-platform/4.14/cli_reference/openshift_cli/getting-started-cli.html">Red Hat OpenShift CLI (<code class="literal">oc</code>)</a> installed.
					</li></ul></div><div class="orderedlist"><p class="title"><strong>Collecting logs and CR information</strong></p><ol class="orderedlist" type="1"><li class="listitem">
						Navigate to the directory where you want to store the <code class="literal">must-gather</code> data.
					</li><li class="listitem"><p class="simpara">
						Run the <code class="literal">oc adm must-gather</code> command:
					</p><pre class="programlisting language-terminal">$ oc adm must-gather --image=registry.redhat.io/migration-toolkit-virtualization/mtv-must-gather-rhel8:2.7.0</pre><p class="simpara">
						The data is saved as <code class="literal">/must-gather/must-gather.tar.gz</code>. You can upload this file to a support case on the <a class="link" href="https://access.redhat.com/">Red Hat Customer Portal</a>.
					</p></li><li class="listitem"><p class="simpara">
						Optional: Run the <code class="literal">oc adm must-gather</code> command with the following options to gather filtered data:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
								Namespace:
							</p><pre class="programlisting language-terminal">$ oc adm must-gather --image=registry.redhat.io/migration-toolkit-virtualization/mtv-must-gather-rhel8:2.7.0 \
  -- NS=&lt;namespace&gt; /usr/bin/targeted</pre></li><li class="listitem"><p class="simpara">
								Migration plan:
							</p><pre class="programlisting language-terminal">$ oc adm must-gather --image=registry.redhat.io/migration-toolkit-virtualization/mtv-must-gather-rhel8:2.7.0 \
  -- PLAN=&lt;migration_plan&gt; /usr/bin/targeted</pre></li><li class="listitem"><p class="simpara">
								Virtual machine:
							</p><pre class="programlisting language-terminal">$ oc adm must-gather --image=registry.redhat.io/migration-toolkit-virtualization/mtv-must-gather-rhel8:2.7.0 \
  -- VM=&lt;vm_id&gt; NS=&lt;namespace&gt; /usr/bin/targeted <span id="CO38-1"/><span class="callout">1</span></pre><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO38-1"><span class="callout">1</span></a> </dt><dd><div class="para">
										Specify the VM <span class="emphasis"><em>ID</em></span> as it appears in the <code class="literal">Plan</code> CR.
									</div></dd></dl></div></li></ul></div></li></ol></div></section><section class="section" id="architecture_mtv"><div class="titlepage"><div><div><h2 class="title">9.3. Architecture</h2></div></div></div><p>
				This section describes MTV custom resources, services, and workflows.
			</p><section class="section" id="mtv-resources-and-services_mtv"><div class="titlepage"><div><div><h3 class="title">9.3.1. MTV custom resources and services</h3></div></div></div><p>
					The Migration Toolkit for Virtualization (MTV) is provided as an Red Hat OpenShift Operator. It creates and manages the following custom resources (CRs) and services.
				</p><div class="itemizedlist"><p class="title"><strong>MTV custom resources</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
							<code class="literal">Provider</code> CR stores attributes that enable MTV to connect to and interact with the source and target providers.
						</li><li class="listitem">
							<code class="literal">NetworkMapping</code> CR maps the networks of the source and target providers.
						</li><li class="listitem">
							<code class="literal">StorageMapping</code> CR maps the storage of the source and target providers.
						</li><li class="listitem">
							<code class="literal">Plan</code> CR contains a list of VMs with the same migration parameters and associated network and storage mappings.
						</li><li class="listitem"><p class="simpara">
							<code class="literal">Migration</code> CR runs a migration plan.
						</p><p class="simpara">
							Only one <code class="literal">Migration</code> CR per migration plan can run at a given time. You can create multiple <code class="literal">Migration</code> CRs for a single <code class="literal">Plan</code> CR.
						</p></li></ul></div><div class="itemizedlist"><p class="title"><strong>MTV services</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
							The <code class="literal">Inventory</code> service performs the following actions:
						</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
									Connects to the source and target providers.
								</li><li class="listitem">
									Maintains a local inventory for mappings and plans.
								</li><li class="listitem">
									Stores VM configurations.
								</li><li class="listitem">
									Runs the <code class="literal">Validation</code> service if a VM configuration change is detected.
								</li></ul></div></li><li class="listitem">
							The <code class="literal">Validation</code> service checks the suitability of a VM for migration by applying rules.
						</li><li class="listitem"><p class="simpara">
							The <code class="literal">Migration Controller</code> service orchestrates migrations.
						</p><p class="simpara">
							When you create a migration plan, the <code class="literal">Migration Controller</code> service validates the plan and adds a status label. If the plan fails validation, the plan status is <code class="literal">Not ready</code> and the plan cannot be used to perform a migration. If the plan passes validation, the plan status is <code class="literal">Ready</code> and it can be used to perform a migration. After a successful migration, the <code class="literal">Migration Controller</code> service changes the plan status to <code class="literal">Completed</code>.
						</p></li><li class="listitem">
							The <code class="literal">Populator Controller</code> service orchestrates disk transfers using Volume Populators.
						</li><li class="listitem">
							The <code class="literal">Kubevirt Controller</code> and <code class="literal">Containerized Data Import (CDI) Controller</code> services handle most technical operations.
						</li></ul></div></section><section class="section" id="mtv-workflow_mtv"><div class="titlepage"><div><div><h3 class="title">9.3.2. High-level migration workflow</h3></div></div></div><p>
					The high-level workflow shows the migration process from the point of view of the user:
				</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
							You create a source provider, a target provider, a network mapping, and a storage mapping.
						</li><li class="listitem"><p class="simpara">
							You create a <code class="literal">Plan</code> custom resource (CR) that includes the following resources:
						</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
									Source provider
								</li><li class="listitem">
									Target provider, if MTV is not installed on the target cluster
								</li><li class="listitem">
									Network mapping
								</li><li class="listitem">
									Storage mapping
								</li><li class="listitem">
									One or more virtual machines (VMs)
								</li></ul></div></li><li class="listitem"><p class="simpara">
							You run a migration plan by creating a <code class="literal">Migration</code> CR that references the <code class="literal">Plan</code> CR.
						</p><p class="simpara">
							If you cannot migrate all the VMs for any reason, you can create multiple <code class="literal">Migration</code> CRs for the same <code class="literal">Plan</code> CR until all VMs are migrated.
						</p></li><li class="listitem">
							For each VM in the <code class="literal">Plan</code> CR, the <code class="literal">Migration Controller</code> service records the VM migration progress in the <code class="literal">Migration</code> CR.
						</li><li class="listitem"><p class="simpara">
							Once the data transfer for each VM in the <code class="literal">Plan</code> CR completes, the <code class="literal">Migration Controller</code> service creates a <code class="literal">VirtualMachine</code> CR.
						</p><p class="simpara">
							When all VMs have been migrated, the <code class="literal">Migration Controller</code> service updates the status of the <code class="literal">Plan</code> CR to <code class="literal">Completed</code>. The power state of each source VM is maintained after migration.
						</p></li></ol></div></section><section class="section" id="virt-migration-workflow_mtv"><div class="titlepage"><div><div><h3 class="title">9.3.3. Detailed migration workflow</h3></div></div></div><p>
					You can use the detailed migration workflow to troubleshoot a failed migration.
				</p><p>
					The workflow describes the following steps:
				</p><p>
					<span class="strong strong"><strong>Warm Migration or migration to a remote OpenShift cluster:</strong></span>
				</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							When you create the <code class="literal">Migration</code> custom resource (CR) to run a migration plan, the <code class="literal">Migration Controller</code> service creates a <code class="literal">DataVolume</code> CR for each source VM disk.
						</p><p class="simpara">
							<span class="strong strong"><strong>For each VM disk:</strong></span>
						</p></li><li class="listitem">
							The <code class="literal">Containerized Data Importer (CDI) Controller</code> service creates a persistent volume claim (PVC) based on the parameters specified in the <code class="literal">DataVolume</code> CR.  
						</li><li class="listitem">
							If the <code class="literal">StorageClass</code> has a dynamic provisioner, the persistent volume (PV) is dynamically provisioned by the <code class="literal">StorageClass</code> provisioner.
						</li><li class="listitem">
							The <code class="literal">CDI Controller</code> service creates an <code class="literal">importer</code> pod.
						</li><li class="listitem"><p class="simpara">
							The <code class="literal">importer</code> pod streams the VM disk to the PV.
						</p><p class="simpara">
							<span class="strong strong"><strong>After the VM disks are transferred:</strong></span>
						</p></li><li class="listitem"><p class="simpara">
							The <code class="literal">Migration Controller</code> service creates a <code class="literal">conversion</code> pod with the PVCs attached to it when importing from VMWare.
						</p><p class="simpara">
							The <code class="literal">conversion</code> pod runs <code class="literal">virt-v2v</code>, which installs and configures device drivers on the PVCs of the target VM.
						</p></li><li class="listitem">
							The <code class="literal">Migration Controller</code> service creates a <code class="literal">VirtualMachine</code> CR for each source virtual machine (VM), connected to the PVCs.
						</li><li class="listitem"><p class="simpara">
							If the VM ran on the source environment, the <code class="literal">Migration Controller</code> powers on the VM, the <code class="literal">KubeVirt Controller</code> service creates a <code class="literal">virt-launcher</code> pod and a <code class="literal">VirtualMachineInstance</code> CR.
						</p><p class="simpara">
							The <code class="literal">virt-launcher</code> pod runs <code class="literal">QEMU-KVM</code> with the PVCs attached as VM disks.
						</p></li></ol></div><p>
					<span class="strong strong"><strong>Cold migration from RHV or OpenStack to the local OpenShift cluster:</strong></span>
				</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							When you create a <code class="literal">Migration</code> custom resource (CR) to run a migration plan, the <code class="literal">Migration Controller</code> service creates for each source VM disk a <code class="literal">PersistentVolumeClaim</code> CR, and an <code class="literal">OvirtVolumePopulator</code> when the source is RHV, or an <code class="literal">OpenstackVolumePopulator</code> CR when the source is OpenStack.
						</p><p class="simpara">
							<span class="strong strong"><strong>For each VM disk:</strong></span>
						</p></li><li class="listitem">
							The <code class="literal">Populator Controller</code> service creates a temporarily persistent volume claim (PVC).
						</li><li class="listitem"><p class="simpara">
							If the <code class="literal">StorageClass</code> has a dynamic provisioner, the persistent volume (PV) is dynamically provisioned by the <code class="literal">StorageClass</code> provisioner.
						</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
									The <code class="literal">Migration Controller</code> service creates a dummy pod to bind <span class="strong strong"><strong>all PVCs</strong></span>. The name of the pod contains <code class="literal">pvcinit</code>.
								</li></ul></div></li><li class="listitem">
							The <code class="literal">Populator Controller</code> service creates a <code class="literal">populator</code> pod.
						</li><li class="listitem"><p class="simpara">
							The <code class="literal">populator</code> pod transfers the disk data to the PV.
						</p><p class="simpara">
							<span class="strong strong"><strong>After the VM disks are transferred:</strong></span>
						</p></li><li class="listitem">
							The temporary PVC is deleted, and the initial PVC points to the PV with the data.
						</li><li class="listitem">
							The <code class="literal">Migration Controller</code> service creates a <code class="literal">VirtualMachine</code> CR for each source virtual machine (VM), connected to the PVCs.
						</li><li class="listitem"><p class="simpara">
							If the VM ran on the source environment, the <code class="literal">Migration Controller</code> powers on the VM, the <code class="literal">KubeVirt Controller</code> service creates a <code class="literal">virt-launcher</code> pod and a <code class="literal">VirtualMachineInstance</code> CR.
						</p><p class="simpara">
							The <code class="literal">virt-launcher</code> pod runs <code class="literal">QEMU-KVM</code> with the PVCs attached as VM disks.
						</p></li></ol></div><p>
					<span class="strong strong"><strong>Cold migration from VMWare to the local OpenShift cluster:</strong></span>
				</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							When you create a <code class="literal">Migration</code> custom resource (CR) to run a migration plan, the <code class="literal">Migration Controller</code> service creates a <code class="literal">DataVolume</code> CR for each source VM disk.
						</p><p class="simpara">
							<span class="strong strong"><strong>For each VM disk:</strong></span>
						</p></li><li class="listitem">
							The <code class="literal">Containerized Data Importer (CDI) Controller</code> service creates a blank persistent volume claim (PVC) based on the parameters specified in the <code class="literal">DataVolume</code> CR.  
						</li><li class="listitem">
							If the <code class="literal">StorageClass</code> has a dynamic provisioner, the persistent volume (PV) is dynamically provisioned by the <code class="literal">StorageClass</code> provisioner.
						</li></ol></div><p>
					<span class="strong strong"><strong>For all VM disks:</strong></span>
				</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
							The <code class="literal">Migration Controller</code> service creates a dummy pod to bind <span class="strong strong"><strong>all PVCs</strong></span>. The name of the pod contains <code class="literal">pvcinit</code>.
						</li><li class="listitem">
							The <code class="literal">Migration Controller</code> service creates a <code class="literal">conversion</code> pod for all PVCs.
						</li><li class="listitem"><p class="simpara">
							The <code class="literal">conversion</code> pod runs <code class="literal">virt-v2v</code>, which converts the VM to the KVM hypervisor and transfers the disks' data to their corresponding PVs.
						</p><p class="simpara">
							<span class="strong strong"><strong>After the VM disks are transferred:</strong></span>
						</p></li><li class="listitem">
							The <code class="literal">Migration Controller</code> service creates a <code class="literal">VirtualMachine</code> CR for each source virtual machine (VM), connected to the PVCs.
						</li><li class="listitem"><p class="simpara">
							If the VM ran on the source environment, the <code class="literal">Migration Controller</code> powers on the VM, the <code class="literal">KubeVirt Controller</code> service creates a <code class="literal">virt-launcher</code> pod and a <code class="literal">VirtualMachineInstance</code> CR.
						</p><p class="simpara">
							The <code class="literal">virt-launcher</code> pod runs <code class="literal">QEMU-KVM</code> with the PVCs attached as VM disks.
						</p></li></ol></div></section></section><section class="section" id="logs-and-crs_mtv"><div class="titlepage"><div><div><h2 class="title">9.4. Logs and custom resources</h2></div></div></div><p>
				You can download logs and custom resource (CR) information for troubleshooting. For more information, see the <a class="link" href="#virt-migration-workflow_mtv" title="9.3.3. Detailed migration workflow">detailed migration workflow</a>.
			</p><section class="section" id="collected-logs-cr-info_mtv"><div class="titlepage"><div><div><h3 class="title">9.4.1. Collected logs and custom resource information</h3></div></div></div><p>
					You can download logs and custom resource (CR) <code class="literal">yaml</code> files for the following targets by using the Red Hat OpenShift web console or the command line interface (CLI):
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							Migration plan: Web console or CLI.
						</li><li class="listitem">
							Virtual machine: Web console or CLI.
						</li><li class="listitem">
							Namespace: CLI only.
						</li></ul></div><p>
					The <code class="literal">must-gather</code> tool collects the following logs and CR files in an archive file:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
							CRs:
						</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
									<code class="literal">DataVolume</code> CR: Represents a disk mounted on a migrated VM.
								</li><li class="listitem">
									<code class="literal">VirtualMachine</code> CR: Represents a migrated VM.
								</li><li class="listitem">
									<code class="literal">Plan</code> CR: Defines the VMs and storage and network mapping.
								</li><li class="listitem">
									<code class="literal">Job</code> CR: Optional: Represents a pre-migration hook, a post-migration hook, or both.
								</li></ul></div></li><li class="listitem"><p class="simpara">
							Logs:
						</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
									<code class="literal">importer</code> pod: Disk-to-data-volume conversion log. The <code class="literal">importer</code> pod naming convention is <code class="literal">importer-&lt;migration_plan&gt;-&lt;vm_id&gt;&lt;5_char_id&gt;</code>, for example, <code class="literal">importer-mig-plan-ed90dfc6-9a17-4a8btnfh</code>, where <code class="literal">ed90dfc6-9a17-4a8</code> is a truncated RHV VM ID and <code class="literal">btnfh</code> is the generated 5-character ID.
								</li><li class="listitem">
									<code class="literal">conversion</code> pod: VM conversion log. The <code class="literal">conversion</code> pod runs <code class="literal">virt-v2v</code>, which installs and configures device drivers on the PVCs of the VM. The <code class="literal">conversion</code> pod naming convention is <code class="literal">&lt;migration_plan&gt;-&lt;vm_id&gt;&lt;5_char_id&gt;</code>.
								</li><li class="listitem">
									<code class="literal">virt-launcher</code> pod: VM launcher log. When a migrated VM is powered on, the <code class="literal">virt-launcher</code> pod runs <code class="literal">QEMU-KVM</code> with the PVCs attached as VM disks.
								</li><li class="listitem">
									<code class="literal">forklift-controller</code> pod: The log is filtered for the migration plan, virtual machine, or namespace specified by the <code class="literal">must-gather</code> command.
								</li><li class="listitem">
									<code class="literal">forklift-must-gather-api</code> pod: The log is filtered for the migration plan, virtual machine, or namespace specified by the <code class="literal">must-gather</code> command.
								</li><li class="listitem"><p class="simpara">
									<code class="literal">hook-job</code> pod: The log is filtered for hook jobs. The <code class="literal">hook-job</code> naming convention is <code class="literal">&lt;migration_plan&gt;-&lt;vm_id&gt;&lt;5_char_id&gt;</code>, for example, <code class="literal">plan2j-vm-3696-posthook-4mx85</code> or <code class="literal">plan2j-vm-3696-prehook-mwqnl</code>.
								</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
										Empty or excluded log files are not included in the <code class="literal">must-gather</code> archive file.
									</p></div></div></li></ul></div></li></ul></div><div class="formalpara"><p class="title"><strong>Example must-gather archive structure for a VMware migration plan</strong></p><p>
						
<pre class="screen">must-gather
└── namespaces
    ├── target-vm-ns
    │   ├── crs
    │   │   ├── datavolume
    │   │   │   ├── mig-plan-vm-7595-tkhdz.yaml
    │   │   │   ├── mig-plan-vm-7595-5qvqp.yaml
    │   │   │   └── mig-plan-vm-8325-xccfw.yaml
    │   │   └── virtualmachine
    │   │       ├── test-test-rhel8-2disks2nics.yaml
    │   │       └── test-x2019.yaml
    │   └── logs
    │       ├── importer-mig-plan-vm-7595-tkhdz
    │       │   └── current.log
    │       ├── importer-mig-plan-vm-7595-5qvqp
    │       │   └── current.log
    │       ├── importer-mig-plan-vm-8325-xccfw
    │       │   └── current.log
    │       ├── mig-plan-vm-7595-4glzd
    │       │   └── current.log
    │       └── mig-plan-vm-8325-4zw49
    │           └── current.log
    └── openshift-mtv
        ├── crs
        │   └── plan
        │       └── mig-plan-cold.yaml
        └── logs
            ├── forklift-controller-67656d574-w74md
            │   └── current.log
            └── forklift-must-gather-api-89fc7f4b6-hlwb6
                └── current.log</pre>
					</p></div></section><section class="section" id="accessing-logs-ui_mtv"><div class="titlepage"><div><div><h3 class="title">9.4.2. Downloading logs and custom resource information from the web console</h3></div></div></div><p>
					You can download logs and information about custom resources (CRs) for a completed, failed, or canceled migration plan or for migrated virtual machines (VMs) by using the Red Hat OpenShift web console.
				</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
							In the Red Hat OpenShift web console, click <span class="strong strong"><strong>Migration</strong></span> → <span class="strong strong"><strong>Plans for virtualization</strong></span>.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Get logs</strong></span> beside a migration plan name.
						</li><li class="listitem"><p class="simpara">
							In the <span class="strong strong"><strong>Get logs</strong></span> window, click <span class="strong strong"><strong>Get logs</strong></span>.
						</p><p class="simpara">
							The logs are collected. A <code class="literal">Log collection complete</code> message is displayed.
						</p></li><li class="listitem">
							Click <span class="strong strong"><strong>Download logs</strong></span> to download the archive file.
						</li><li class="listitem">
							To download logs for a migrated VM, click a migration plan name and then click <span class="strong strong"><strong>Get logs</strong></span> beside the VM.
						</li></ol></div></section><section class="section" id="accessing-logs-cli_mtv"><div class="titlepage"><div><div><h3 class="title">9.4.3. Accessing logs and custom resource information from the command line interface</h3></div></div></div><p>
					You can access logs and information about custom resources (CRs) from the command line interface by using the <code class="literal">must-gather</code> tool. You must attach a <code class="literal">must-gather</code> data file to all customer cases.
				</p><p>
					You can gather data for a specific namespace, a completed, failed, or canceled migration plan, or a migrated virtual machine (VM) by using the filtering options.
				</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
						If you specify a non-existent resource in the filtered <code class="literal">must-gather</code> command, no archive file is created.
					</p></div></div><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
							You must be logged in to the OpenShift Virtualization cluster as a user with the <code class="literal">cluster-admin</code> role.
						</li><li class="listitem">
							You must have the <a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.14/html/cli_tools/openshift-cli-oc#cli-getting-started">Red Hat OpenShift CLI (<code class="literal">oc</code>)</a> installed.
						</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
							Navigate to the directory where you want to store the <code class="literal">must-gather</code> data.
						</li><li class="listitem"><p class="simpara">
							Run the <code class="literal">oc adm must-gather</code> command:
						</p><pre class="programlisting language-terminal">$ oc adm must-gather --image=registry.redhat.io/migration-toolkit-virtualization/mtv-must-gather-rhel8:2.7.0</pre><p class="simpara">
							The data is saved as <code class="literal">/must-gather/must-gather.tar.gz</code>. You can upload this file to a support case on the <a class="link" href="https://access.redhat.com/">Red Hat Customer Portal</a>.
						</p></li><li class="listitem"><p class="simpara">
							Optional: Run the <code class="literal">oc adm must-gather</code> command with the following options to gather filtered data:
						</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
									Namespace:
								</p><pre class="programlisting language-terminal">$ oc adm must-gather --image=registry.redhat.io/migration-toolkit-virtualization/mtv-must-gather-rhel8:2.7.0 \
  -- NS=&lt;namespace&gt; /usr/bin/targeted</pre></li><li class="listitem"><p class="simpara">
									Migration plan:
								</p><pre class="programlisting language-terminal">$ oc adm must-gather --image=registry.redhat.io/migration-toolkit-virtualization/mtv-must-gather-rhel8:2.7.0 \
  -- PLAN=&lt;migration_plan&gt; /usr/bin/targeted</pre></li><li class="listitem"><p class="simpara">
									Virtual machine:
								</p><pre class="programlisting language-terminal">$ oc adm must-gather --image=registry.redhat.io/migration-toolkit-virtualization/mtv-must-gather-rhel8:2.7.0 \
  -- VM=&lt;vm_name&gt; NS=&lt;namespace&gt; /usr/bin/targeted <span id="CO39-1"/><span class="callout">1</span></pre><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO39-1"><span class="callout">1</span></a> </dt><dd><div class="para">
											You must specify the VM <span class="emphasis"><em>name</em></span>, not the VM ID, as it appears in the <code class="literal">Plan</code> CR.
										</div></dd></dl></div></li></ul></div></li></ol></div></section></section></section><div><div xml:lang="en-US" class="legalnotice" id="idm45442632070384"><h1 class="legalnotice">Legal Notice</h1><div class="para">
		Copyright <span class="trademark"/>© 2024 Red Hat, Inc.
	</div><div class="para">
		The text of and illustrations in this document are licensed by Red Hat under a Creative Commons Attribution–Share Alike 3.0 Unported license ("CC-BY-SA"). An explanation of CC-BY-SA is available at <a class="uri" href="http://creativecommons.org/licenses/by-sa/3.0/">http://creativecommons.org/licenses/by-sa/3.0/</a>. In accordance with CC-BY-SA, if you distribute this document or an adaptation of it, you must provide the URL for the original version.
	</div><div class="para">
		Red Hat, as the licensor of this document, waives the right to enforce, and agrees not to assert, Section 4d of CC-BY-SA to the fullest extent permitted by applicable law.
	</div><div class="para">
		Red Hat, Red Hat Enterprise Linux, the Shadowman logo, the Red Hat logo, JBoss, OpenShift, Fedora, the Infinity logo, and RHCE are trademarks of Red Hat, Inc., registered in the United States and other countries.
	</div><div class="para">
		<span class="trademark">Linux</span>® is the registered trademark of Linus Torvalds in the United States and other countries.
	</div><div class="para">
		<span class="trademark">Java</span>® is a registered trademark of Oracle and/or its affiliates.
	</div><div class="para">
		<span class="trademark">XFS</span>® is a trademark of Silicon Graphics International Corp. or its subsidiaries in the United States and/or other countries.
	</div><div class="para">
		<span class="trademark">MySQL</span>® is a registered trademark of MySQL AB in the United States, the European Union and other countries.
	</div><div class="para">
		<span class="trademark">Node.js</span>® is an official trademark of Joyent. Red Hat is not formally related to or endorsed by the official Joyent Node.js open source or commercial project.
	</div><div class="para">
		The <span class="trademark">OpenStack</span>® Word Mark and OpenStack logo are either registered trademarks/service marks or trademarks/service marks of the OpenStack Foundation, in the United States and other countries and are used with the OpenStack Foundation's permission. We are not affiliated with, endorsed or sponsored by the OpenStack Foundation, or the OpenStack community.
	</div><div class="para">
		All other trademarks are the property of their respective owners.
	</div></div></div></div></div></div><script type="text/javascript">
                        jQuery(document).ready(function() {
                            initSwitchery();
                            jQuery('pre[class*="language-"]').each(function(i, block){hljs.highlightBlock(block);});
                        });
                    </script></body></html>